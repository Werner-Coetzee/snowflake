
CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGESTORE()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '

BEGIN
    -- Merge staging data into silver dimension table
    MERGE INTO FCO.SILVER.DIMSTORE AS target
    USING (
        SELECT 
            COMPANYNAME,
            SYSTEMROWVERSION,
            NO_,
            RESPONSIBILITY_CENTER,
            NAME,
            ADDRESS,
            ADDRESS_2,
            CITY,
            POST_CODE,
            STORE_MANAGER_ID,
            STORE_MANAGER_NAME,
            DB_DISTRIBUTION,
            PHONE_NO_,
            COUNTRY_CODE,
            GLOBAL_DIMENSION_1_CODE,
            LOCATION_CODE,
            CURRENCY_CODE,
            GLOBAL_DIMENSION_2_CODE,
            STORE_TYPE,
            LAST_DATE_MODIFIED,
            FUNCTIONALITY_PROFILE,
            MENU_PROFILE,
            INTERFACE_PROFILE,
            FRAUD_SORT_FIELD,
            STYLE_PROFILE,
            HARDWARE_PROFILE,
            ECOMMERCE_PROFILE_CODE,
            LANGUAGE_PROFILE_ID,
            SSK_PROFILE_ID,
            NO_SERIES,
            STATEMENT_NOS_,
            POSTED_STATEM_NOS_,
            ONE_STATEMENT_PER_DAY,
            AUTO_CALCULATE_STATEMENT,
            GROUP_BY_STAFF_POS,
            STATEMENT_METHOD,
            CLOSING_METHOD,
            ROUNDING_ACC_NAME,
            ROUNDING_ACCOUNT,
            MAX_DIFF_TO_ALLOW_POST,
            MAX_ROUND_IN_STMT_,
            MAX_DIFF_FROM_SHIFT_DATE,
            ALLOWED_DIFF_IN_TRANS_,
            PAYM_COMPR_IN_STATEM_POST_,
            TEND_DECL_CALCULATION,
            ADVANCED_SHIFT_METHOD,
            ADVANCED_SHIFT_NOS_,
            DEFAULT_COMMISSION_GROUP,
            CAMPAIGN_NOS_,
            PROMOTION_NOS_,
            PERIODIC_DISCOUNT_NOS_,
            PUBLISHED_OFFER_NOS_,
            MEMBER_NOTIFICATION_NOS_,
            FBP_NOS_,
            POS_TERMINAL_NOS_,
            STAFF_ID_NOS_,
            COUPON_NOS_,
            ITEM_NOS_,
            DATA_ACCESS_CONTROL,
            STORE_VAT_BUS_POST_GR_,
            STORE_GEN_BUS_POST_GR_,
            GEN_BUS_POST_GR_,
            LANGUAGE_CODE,
            POS_INVENTORY_LOOKUP,
            POS_WARMUP_ACTIVE,
            CLICK_AND_COLLECT,
            PRINT_RECEIPT_LOGO,
            PRINT_RECEIPT_BITMAP_NO_,
            RCPT_TEXT_MAX_LENGTH,
            NO_OF_TOP_BOTTOM_LINES,
            ITEM_NO_ON_RECEIPT,
            LAST_ACTION_FOR_LABEL_UPD,
            LAST_ACTION_FOR_ITEM_LABEL_UPD,
            NO_SHELF_LABEL_PRINTING,
            NO_ITEM_LABEL_PRINTING,
            SERVICE_CHARGE_,
            SERV_CHARGE_INC_EXP_ACC,
            SAFE_MGNT_IN_USE,
            LATITUDE,
            LONGITUDE,
            COUNTY,
            PICTURE,
            PICTURE_MEDIA,
            POS_CHECK_Z_REPORT,
            STORE_SIZE_SQUARE_METERS,
            LOADING_CARD_NOS_,
            RECEIVING_NOS_,
            POSTED_RECEIVING_NOS_,
            GIFT_REGISTRATION_NOS_,
            USE_BATCH_POSTING_FOR_STATEM_,
            ONLY_ACCEPT_STATEMENT,
            MAX_DIFF_TO_ALLOW_ACCEPT,
            CURRENT_HOSP_PRINTING_ROUTE,
            POS_START_AMOUNT_METHOD,
            POS_POST_SAFE_LEDGER,
            DINING_RESERVATION_NOS_,
            DINING_WAITING_LIST_NOS_,
            DINING_WALK_IN_NOS_,
            KDS_BACKUP_PRINTING,
            ACTIVE_KDS_LOAD_CONFIG_,
            DEFAULT_DELIVERY_TYPE,
            DISPLAY_DEL_TYPE_POP_UP,
            ORDERING_STATUS,
            DELIVERY_TAKEOUT_CHANGE,
            REST_ORDERS_IN_PROGRESS,
            REST_ESTIM_PROD_TIME_MIN_,
            KITCHEN_PROD_SYSTEM_IN_USE,
            NORMAL_ORDER_TIMING,
            MAX_ORDER_TIMING_MIN_,
            TIME_ROUNDING_PRECISION,
            ALLOW_MEMBER_SCANNING_IN_KIOSK,
            CURRENCY_CODE_IN_KIOSK,
            DISPLAY_ITEM_HTML_IN_KIOSK,
            LOCATION_PROFILE,
            LOCATION_URL,
            LOCATIONURLEXISTS,
            LOCATIONQRCODE,
            STORE_SALES_TYPE_FILTER,
            SHOW_AVAILAB_ON_POS_BUTTON,
            LAST_ZREPORT,
            LAST_YREPORT,
            ATTRIB_1_CODE,
            ATTRIB_2_CODE,
            ATTRIB_3_CODE,
            ATTRIB_4_CODE,
            ATTRIB_5_CODE,
            IN_TRANSIT_CODE,
            WEB_STORE,
            WEB_STORE_POS_TERMINAL,
            WEB_STORE_STAFF_ID,
            WEB_STORE_CUSTOMER_NO_,
            WEB_STORE_SHIPPING_COST_ITEM,
            LOYALTY,
            MOBILE,
            PLU_MENU_PROFILE,
            PLU_MENU_ID,
            LAST_ACTION_ENTRY_NO_,
            PREPAY_CUSTOMER_ORDER,
            CUSTOMER_ORDER_INC_EXPENSE_ACC,
            CUSTOMER_ORDER_REFUND_ACC,
            CUST_ORD_REFUND_TENDER_TYPE,
            USE_SHELF_POSITION,
            CO_TO_PICK_INDICATION,
            CO_TO_PICK_INTERVAL,
            INCLUDE_SPG_IN_COLLECT_PANEL,
            CALC_INV_FOR_SOURCING_LOCATION,
            CREATE_CLE_FOR_WEB_CUSTOMER,
            SKIP_PRINTING_TEND_DECL_COPY,
            CUSTOMER_ORDER_PREPAYMENT_ACC,
            TAX_AREA_CODE,
            TAX_LIABLE,
            USE_F_B_ORDER_STRUCTURE,
            LS_RECOMMEND_BATCH_NO_,
            RECOMMENDATION_API_URL,
            PLB_STORE,
            TAX_GROUP_CODE_LIMITATION,
            VAT_PROD_POST_GRP_LIMITATION,
            SPLIT_ORDER_ON_LOAD_BALANCING,
            SYSTEMID,
            SYSTEMCREATEDAT,
            SYSTEMCREATEDBY,
            SYSTEMMODIFIEDAT,
            SYSTEMMODIFIEDBY,
            BRAND_FILTER_BTR,
            QRCODE_TEXT_BTR,
            QRCODE_DESCRIPTION_BTR,
            PRINT_QRCODE_BTR,
            PRINT_RECEIPT_NO_BTR,
            QRCODE_HEIGHT_BTR,
            QRCODE_WIDTH_BTR,
            CLOSED_BTR,
            STORE_XREF_NO_BTR,
            STORE_DIM_CREATED_BTR,
            NUMBER_OF_POS_TERMINALS
        FROM FCO.STAGING.STGSTORE
    ) AS source
    ON target.COMPANYNAME = source.COMPANYNAME 
       AND target.NO_ = source.NO_
    
    WHEN MATCHED AND (
        target.SYSTEMROWVERSION != source.SYSTEMROWVERSION OR
        target.SYSTEMMODIFIEDAT != source.SYSTEMMODIFIEDAT OR
        NVL(target.NAME, '''') != NVL(source.NAME, '''') OR
        NVL(target.ADDRESS, '''') != NVL(source.ADDRESS, '''') OR
        NVL(target.CITY, '''') != NVL(source.CITY, '''') OR
        NVL(target.STORE_MANAGER_ID, '''') != NVL(source.STORE_MANAGER_ID, '''') OR
        NVL(target.STORE_MANAGER_NAME, '''') != NVL(source.STORE_MANAGER_NAME, '''') OR
        NVL(target.PHONE_NO_, '''') != NVL(source.PHONE_NO_, '''') OR
        NVL(target.STORE_TYPE, '''') != NVL(source.STORE_TYPE, '''')
    ) THEN UPDATE SET
        SYSTEMROWVERSION = source.SYSTEMROWVERSION,
        RESPONSIBILITY_CENTER = source.RESPONSIBILITY_CENTER,
        NAME = source.NAME,
        ADDRESS = source.ADDRESS,
        ADDRESS_2 = source.ADDRESS_2,
        CITY = source.CITY,
        POST_CODE = source.POST_CODE,
        STORE_MANAGER_ID = source.STORE_MANAGER_ID,
        STORE_MANAGER_NAME = source.STORE_MANAGER_NAME,
        DB_DISTRIBUTION = source.DB_DISTRIBUTION,
        PHONE_NO_ = source.PHONE_NO_,
        COUNTRY_CODE = source.COUNTRY_CODE,
        GLOBAL_DIMENSION_1_CODE = source.GLOBAL_DIMENSION_1_CODE,
        LOCATION_CODE = source.LOCATION_CODE,
        CURRENCY_CODE = source.CURRENCY_CODE,
        GLOBAL_DIMENSION_2_CODE = source.GLOBAL_DIMENSION_2_CODE,
        STORE_TYPE = source.STORE_TYPE,
        LAST_DATE_MODIFIED = source.LAST_DATE_MODIFIED,
        FUNCTIONALITY_PROFILE = source.FUNCTIONALITY_PROFILE,
        MENU_PROFILE = source.MENU_PROFILE,
        INTERFACE_PROFILE = source.INTERFACE_PROFILE,
        FRAUD_SORT_FIELD = source.FRAUD_SORT_FIELD,
        STYLE_PROFILE = source.STYLE_PROFILE,
        HARDWARE_PROFILE = source.HARDWARE_PROFILE,
        ECOMMERCE_PROFILE_CODE = source.ECOMMERCE_PROFILE_CODE,
        LANGUAGE_PROFILE_ID = source.LANGUAGE_PROFILE_ID,
        SSK_PROFILE_ID = source.SSK_PROFILE_ID,
        NO_SERIES = source.NO_SERIES,
        STATEMENT_NOS_ = source.STATEMENT_NOS_,
        POSTED_STATEM_NOS_ = source.POSTED_STATEM_NOS_,
        ONE_STATEMENT_PER_DAY = source.ONE_STATEMENT_PER_DAY,
        AUTO_CALCULATE_STATEMENT = source.AUTO_CALCULATE_STATEMENT,
        GROUP_BY_STAFF_POS = source.GROUP_BY_STAFF_POS,
        STATEMENT_METHOD = source.STATEMENT_METHOD,
        CLOSING_METHOD = source.CLOSING_METHOD,
        ROUNDING_ACC_NAME = source.ROUNDING_ACC_NAME,
        ROUNDING_ACCOUNT = source.ROUNDING_ACCOUNT,
        MAX_DIFF_TO_ALLOW_POST = source.MAX_DIFF_TO_ALLOW_POST,
        MAX_ROUND_IN_STMT_ = source.MAX_ROUND_IN_STMT_,
        MAX_DIFF_FROM_SHIFT_DATE = source.MAX_DIFF_FROM_SHIFT_DATE,
        ALLOWED_DIFF_IN_TRANS_ = source.ALLOWED_DIFF_IN_TRANS_,
        PAYM_COMPR_IN_STATEM_POST_ = source.PAYM_COMPR_IN_STATEM_POST_,
        TEND_DECL_CALCULATION = source.TEND_DECL_CALCULATION,
        ADVANCED_SHIFT_METHOD = source.ADVANCED_SHIFT_METHOD,
        ADVANCED_SHIFT_NOS_ = source.ADVANCED_SHIFT_NOS_,
        DEFAULT_COMMISSION_GROUP = source.DEFAULT_COMMISSION_GROUP,
        CAMPAIGN_NOS_ = source.CAMPAIGN_NOS_,
        PROMOTION_NOS_ = source.PROMOTION_NOS_,
        PERIODIC_DISCOUNT_NOS_ = source.PERIODIC_DISCOUNT_NOS_,
        PUBLISHED_OFFER_NOS_ = source.PUBLISHED_OFFER_NOS_,
        MEMBER_NOTIFICATION_NOS_ = source.MEMBER_NOTIFICATION_NOS_,
        FBP_NOS_ = source.FBP_NOS_,
        POS_TERMINAL_NOS_ = source.POS_TERMINAL_NOS_,
        STAFF_ID_NOS_ = source.STAFF_ID_NOS_,
        COUPON_NOS_ = source.COUPON_NOS_,
        ITEM_NOS_ = source.ITEM_NOS_,
        DATA_ACCESS_CONTROL = source.DATA_ACCESS_CONTROL,
        STORE_VAT_BUS_POST_GR_ = source.STORE_VAT_BUS_POST_GR_,
        STORE_GEN_BUS_POST_GR_ = source.STORE_GEN_BUS_POST_GR_,
        GEN_BUS_POST_GR_ = source.GEN_BUS_POST_GR_,
        LANGUAGE_CODE = source.LANGUAGE_CODE,
        POS_INVENTORY_LOOKUP = source.POS_INVENTORY_LOOKUP,
        POS_WARMUP_ACTIVE = source.POS_WARMUP_ACTIVE,
        CLICK_AND_COLLECT = source.CLICK_AND_COLLECT,
        PRINT_RECEIPT_LOGO = source.PRINT_RECEIPT_LOGO,
        PRINT_RECEIPT_BITMAP_NO_ = source.PRINT_RECEIPT_BITMAP_NO_,
        RCPT_TEXT_MAX_LENGTH = source.RCPT_TEXT_MAX_LENGTH,
        NO_OF_TOP_BOTTOM_LINES = source.NO_OF_TOP_BOTTOM_LINES,
        ITEM_NO_ON_RECEIPT = source.ITEM_NO_ON_RECEIPT,
        LAST_ACTION_FOR_LABEL_UPD = source.LAST_ACTION_FOR_LABEL_UPD,
        LAST_ACTION_FOR_ITEM_LABEL_UPD = source.LAST_ACTION_FOR_ITEM_LABEL_UPD,
        NO_SHELF_LABEL_PRINTING = source.NO_SHELF_LABEL_PRINTING,
        NO_ITEM_LABEL_PRINTING = source.NO_ITEM_LABEL_PRINTING,
        SERVICE_CHARGE_ = source.SERVICE_CHARGE_,
        SERV_CHARGE_INC_EXP_ACC = source.SERV_CHARGE_INC_EXP_ACC,
        SAFE_MGNT_IN_USE = source.SAFE_MGNT_IN_USE,
        LATITUDE = source.LATITUDE,
        LONGITUDE = source.LONGITUDE,
        COUNTY = source.COUNTY,
        PICTURE = source.PICTURE,
        PICTURE_MEDIA = source.PICTURE_MEDIA,
        POS_CHECK_Z_REPORT = source.POS_CHECK_Z_REPORT,
        STORE_SIZE_SQUARE_METERS = source.STORE_SIZE_SQUARE_METERS,
        LOADING_CARD_NOS_ = source.LOADING_CARD_NOS_,
        RECEIVING_NOS_ = source.RECEIVING_NOS_,
        POSTED_RECEIVING_NOS_ = source.POSTED_RECEIVING_NOS_,
        GIFT_REGISTRATION_NOS_ = source.GIFT_REGISTRATION_NOS_,
        USE_BATCH_POSTING_FOR_STATEM_ = source.USE_BATCH_POSTING_FOR_STATEM_,
        ONLY_ACCEPT_STATEMENT = source.ONLY_ACCEPT_STATEMENT,
        MAX_DIFF_TO_ALLOW_ACCEPT = source.MAX_DIFF_TO_ALLOW_ACCEPT,
        CURRENT_HOSP_PRINTING_ROUTE = source.CURRENT_HOSP_PRINTING_ROUTE,
        POS_START_AMOUNT_METHOD = source.POS_START_AMOUNT_METHOD,
        POS_POST_SAFE_LEDGER = source.POS_POST_SAFE_LEDGER,
        DINING_RESERVATION_NOS_ = source.DINING_RESERVATION_NOS_,
        DINING_WAITING_LIST_NOS_ = source.DINING_WAITING_LIST_NOS_,
        DINING_WALK_IN_NOS_ = source.DINING_WALK_IN_NOS_,
        KDS_BACKUP_PRINTING = source.KDS_BACKUP_PRINTING,
        ACTIVE_KDS_LOAD_CONFIG_ = source.ACTIVE_KDS_LOAD_CONFIG_,
        DEFAULT_DELIVERY_TYPE = source.DEFAULT_DELIVERY_TYPE,
        DISPLAY_DEL_TYPE_POP_UP = source.DISPLAY_DEL_TYPE_POP_UP,
        ORDERING_STATUS = source.ORDERING_STATUS,
        DELIVERY_TAKEOUT_CHANGE = source.DELIVERY_TAKEOUT_CHANGE,
        REST_ORDERS_IN_PROGRESS = source.REST_ORDERS_IN_PROGRESS,
        REST_ESTIM_PROD_TIME_MIN_ = source.REST_ESTIM_PROD_TIME_MIN_,
        KITCHEN_PROD_SYSTEM_IN_USE = source.KITCHEN_PROD_SYSTEM_IN_USE,
        NORMAL_ORDER_TIMING = source.NORMAL_ORDER_TIMING,
        MAX_ORDER_TIMING_MIN_ = source.MAX_ORDER_TIMING_MIN_,
        TIME_ROUNDING_PRECISION = source.TIME_ROUNDING_PRECISION,
        ALLOW_MEMBER_SCANNING_IN_KIOSK = source.ALLOW_MEMBER_SCANNING_IN_KIOSK,
        CURRENCY_CODE_IN_KIOSK = source.CURRENCY_CODE_IN_KIOSK,
        DISPLAY_ITEM_HTML_IN_KIOSK = source.DISPLAY_ITEM_HTML_IN_KIOSK,
        LOCATION_PROFILE = source.LOCATION_PROFILE,
        LOCATION_URL = source.LOCATION_URL,
        LOCATIONURLEXISTS = source.LOCATIONURLEXISTS,
        LOCATIONQRCODE = source.LOCATIONQRCODE,
        STORE_SALES_TYPE_FILTER = source.STORE_SALES_TYPE_FILTER,
        SHOW_AVAILAB_ON_POS_BUTTON = source.SHOW_AVAILAB_ON_POS_BUTTON,
        LAST_ZREPORT = source.LAST_ZREPORT,
        LAST_YREPORT = source.LAST_YREPORT,
        ATTRIB_1_CODE = source.ATTRIB_1_CODE,
        ATTRIB_2_CODE = source.ATTRIB_2_CODE,
        ATTRIB_3_CODE = source.ATTRIB_3_CODE,
        ATTRIB_4_CODE = source.ATTRIB_4_CODE,
        ATTRIB_5_CODE = source.ATTRIB_5_CODE,
        IN_TRANSIT_CODE = source.IN_TRANSIT_CODE,
        WEB_STORE = source.WEB_STORE,
        WEB_STORE_POS_TERMINAL = source.WEB_STORE_POS_TERMINAL,
        WEB_STORE_STAFF_ID = source.WEB_STORE_STAFF_ID,
        WEB_STORE_CUSTOMER_NO_ = source.WEB_STORE_CUSTOMER_NO_,
        WEB_STORE_SHIPPING_COST_ITEM = source.WEB_STORE_SHIPPING_COST_ITEM,
        LOYALTY = source.LOYALTY,
        MOBILE = source.MOBILE,
        PLU_MENU_PROFILE = source.PLU_MENU_PROFILE,
        PLU_MENU_ID = source.PLU_MENU_ID,
        LAST_ACTION_ENTRY_NO_ = source.LAST_ACTION_ENTRY_NO_,
        PREPAY_CUSTOMER_ORDER = source.PREPAY_CUSTOMER_ORDER,
        CUSTOMER_ORDER_INC_EXPENSE_ACC = source.CUSTOMER_ORDER_INC_EXPENSE_ACC,
        CUSTOMER_ORDER_REFUND_ACC = source.CUSTOMER_ORDER_REFUND_ACC,
        CUST_ORD_REFUND_TENDER_TYPE = source.CUST_ORD_REFUND_TENDER_TYPE,
        USE_SHELF_POSITION = source.USE_SHELF_POSITION,
        CO_TO_PICK_INDICATION = source.CO_TO_PICK_INDICATION,
        CO_TO_PICK_INTERVAL = source.CO_TO_PICK_INTERVAL,
        INCLUDE_SPG_IN_COLLECT_PANEL = source.INCLUDE_SPG_IN_COLLECT_PANEL,
        CALC_INV_FOR_SOURCING_LOCATION = source.CALC_INV_FOR_SOURCING_LOCATION,
        CREATE_CLE_FOR_WEB_CUSTOMER = source.CREATE_CLE_FOR_WEB_CUSTOMER,
        SKIP_PRINTING_TEND_DECL_COPY = source.SKIP_PRINTING_TEND_DECL_COPY,
        CUSTOMER_ORDER_PREPAYMENT_ACC = source.CUSTOMER_ORDER_PREPAYMENT_ACC,
        TAX_AREA_CODE = source.TAX_AREA_CODE,
        TAX_LIABLE = source.TAX_LIABLE,
        USE_F_B_ORDER_STRUCTURE = source.USE_F_B_ORDER_STRUCTURE,
        LS_RECOMMEND_BATCH_NO_ = source.LS_RECOMMEND_BATCH_NO_,
        RECOMMENDATION_API_URL = source.RECOMMENDATION_API_URL,
        PLB_STORE = source.PLB_STORE,
        TAX_GROUP_CODE_LIMITATION = source.TAX_GROUP_CODE_LIMITATION,
        VAT_PROD_POST_GRP_LIMITATION = source.VAT_PROD_POST_GRP_LIMITATION,
        SPLIT_ORDER_ON_LOAD_BALANCING = source.SPLIT_ORDER_ON_LOAD_BALANCING,
        SYSTEMID = source.SYSTEMID,
        SYSTEMCREATEDAT = source.SYSTEMCREATEDAT,
        SYSTEMCREATEDBY = source.SYSTEMCREATEDBY,
        SYSTEMMODIFIEDAT = source.SYSTEMMODIFIEDAT,
        SYSTEMMODIFIEDBY = source.SYSTEMMODIFIEDBY,
        BRAND_FILTER_BTR = source.BRAND_FILTER_BTR,
        QRCODE_TEXT_BTR = source.QRCODE_TEXT_BTR,
        QRCODE_DESCRIPTION_BTR = source.QRCODE_DESCRIPTION_BTR,
        PRINT_QRCODE_BTR = source.PRINT_QRCODE_BTR,
        PRINT_RECEIPT_NO_BTR = source.PRINT_RECEIPT_NO_BTR,
        QRCODE_HEIGHT_BTR = source.QRCODE_HEIGHT_BTR,
        QRCODE_WIDTH_BTR = source.QRCODE_WIDTH_BTR,
        CLOSED_BTR = source.CLOSED_BTR,
        STORE_XREF_NO_BTR = source.STORE_XREF_NO_BTR,
        STORE_DIM_CREATED_BTR = source.STORE_DIM_CREATED_BTR,
        NUMBER_OF_POS_TERMINALS = source.NUMBER_OF_POS_TERMINALS
    
    WHEN NOT MATCHED THEN INSERT (
        COMPANYNAME,
        SYSTEMROWVERSION,
        NO_,
        RESPONSIBILITY_CENTER,
        NAME,
        ADDRESS,
        ADDRESS_2,
        CITY,
        POST_CODE,
        STORE_MANAGER_ID,
        STORE_MANAGER_NAME,
        DB_DISTRIBUTION,
        PHONE_NO_,
        COUNTRY_CODE,
        GLOBAL_DIMENSION_1_CODE,
        LOCATION_CODE,
        CURRENCY_CODE,
        GLOBAL_DIMENSION_2_CODE,
        STORE_TYPE,
        LAST_DATE_MODIFIED,
        FUNCTIONALITY_PROFILE,
        MENU_PROFILE,
        INTERFACE_PROFILE,
        FRAUD_SORT_FIELD,
        STYLE_PROFILE,
        HARDWARE_PROFILE,
        ECOMMERCE_PROFILE_CODE,
        LANGUAGE_PROFILE_ID,
        SSK_PROFILE_ID,
        NO_SERIES,
        STATEMENT_NOS_,
        POSTED_STATEM_NOS_,
        ONE_STATEMENT_PER_DAY,
        AUTO_CALCULATE_STATEMENT,
        GROUP_BY_STAFF_POS,
        STATEMENT_METHOD,
        CLOSING_METHOD,
        ROUNDING_ACC_NAME,
        ROUNDING_ACCOUNT,
        MAX_DIFF_TO_ALLOW_POST,
        MAX_ROUND_IN_STMT_,
        MAX_DIFF_FROM_SHIFT_DATE,
        ALLOWED_DIFF_IN_TRANS_,
        PAYM_COMPR_IN_STATEM_POST_,
        TEND_DECL_CALCULATION,
        ADVANCED_SHIFT_METHOD,
        ADVANCED_SHIFT_NOS_,
        DEFAULT_COMMISSION_GROUP,
        CAMPAIGN_NOS_,
        PROMOTION_NOS_,
        PERIODIC_DISCOUNT_NOS_,
        PUBLISHED_OFFER_NOS_,
        MEMBER_NOTIFICATION_NOS_,
        FBP_NOS_,
        POS_TERMINAL_NOS_,
        STAFF_ID_NOS_,
        COUPON_NOS_,
        ITEM_NOS_,
        DATA_ACCESS_CONTROL,
        STORE_VAT_BUS_POST_GR_,
        STORE_GEN_BUS_POST_GR_,
        GEN_BUS_POST_GR_,
        LANGUAGE_CODE,
        POS_INVENTORY_LOOKUP,
        POS_WARMUP_ACTIVE,
        CLICK_AND_COLLECT,
        PRINT_RECEIPT_LOGO,
        PRINT_RECEIPT_BITMAP_NO_,
        RCPT_TEXT_MAX_LENGTH,
        NO_OF_TOP_BOTTOM_LINES,
        ITEM_NO_ON_RECEIPT,
        LAST_ACTION_FOR_LABEL_UPD,
        LAST_ACTION_FOR_ITEM_LABEL_UPD,
        NO_SHELF_LABEL_PRINTING,
        NO_ITEM_LABEL_PRINTING,
        SERVICE_CHARGE_,
        SERV_CHARGE_INC_EXP_ACC,
        SAFE_MGNT_IN_USE,
        LATITUDE,
        LONGITUDE,
        COUNTY,
        PICTURE,
        PICTURE_MEDIA,
        POS_CHECK_Z_REPORT,
        STORE_SIZE_SQUARE_METERS,
        LOADING_CARD_NOS_,
        RECEIVING_NOS_,
        POSTED_RECEIVING_NOS_,
        GIFT_REGISTRATION_NOS_,
        USE_BATCH_POSTING_FOR_STATEM_,
        ONLY_ACCEPT_STATEMENT,
        MAX_DIFF_TO_ALLOW_ACCEPT,
        CURRENT_HOSP_PRINTING_ROUTE,
        POS_START_AMOUNT_METHOD,
        POS_POST_SAFE_LEDGER,
        DINING_RESERVATION_NOS_,
        DINING_WAITING_LIST_NOS_,
        DINING_WALK_IN_NOS_,
        KDS_BACKUP_PRINTING,
        ACTIVE_KDS_LOAD_CONFIG_,
        DEFAULT_DELIVERY_TYPE,
        DISPLAY_DEL_TYPE_POP_UP,
        ORDERING_STATUS,
        DELIVERY_TAKEOUT_CHANGE,
        REST_ORDERS_IN_PROGRESS,
        REST_ESTIM_PROD_TIME_MIN_,
        KITCHEN_PROD_SYSTEM_IN_USE,
        NORMAL_ORDER_TIMING,
        MAX_ORDER_TIMING_MIN_,
        TIME_ROUNDING_PRECISION,
        ALLOW_MEMBER_SCANNING_IN_KIOSK,
        CURRENCY_CODE_IN_KIOSK,
        DISPLAY_ITEM_HTML_IN_KIOSK,
        LOCATION_PROFILE,
        LOCATION_URL,
        LOCATIONURLEXISTS,
        LOCATIONQRCODE,
        STORE_SALES_TYPE_FILTER,
        SHOW_AVAILAB_ON_POS_BUTTON,
        LAST_ZREPORT,
        LAST_YREPORT,
        ATTRIB_1_CODE,
        ATTRIB_2_CODE,
        ATTRIB_3_CODE,
        ATTRIB_4_CODE,
        ATTRIB_5_CODE,
        IN_TRANSIT_CODE,
        WEB_STORE,
        WEB_STORE_POS_TERMINAL,
        WEB_STORE_STAFF_ID,
        WEB_STORE_CUSTOMER_NO_,
        WEB_STORE_SHIPPING_COST_ITEM,
        LOYALTY,
        MOBILE,
        PLU_MENU_PROFILE,
        PLU_MENU_ID,
        LAST_ACTION_ENTRY_NO_,
        PREPAY_CUSTOMER_ORDER,
        CUSTOMER_ORDER_INC_EXPENSE_ACC,
        CUSTOMER_ORDER_REFUND_ACC,
        CUST_ORD_REFUND_TENDER_TYPE,
        USE_SHELF_POSITION,
        CO_TO_PICK_INDICATION,
        CO_TO_PICK_INTERVAL,
        INCLUDE_SPG_IN_COLLECT_PANEL,
        CALC_INV_FOR_SOURCING_LOCATION,
        CREATE_CLE_FOR_WEB_CUSTOMER,
        SKIP_PRINTING_TEND_DECL_COPY,
        CUSTOMER_ORDER_PREPAYMENT_ACC,
        TAX_AREA_CODE,
        TAX_LIABLE,
        USE_F_B_ORDER_STRUCTURE,
        LS_RECOMMEND_BATCH_NO_,
        RECOMMENDATION_API_URL,
        PLB_STORE,
        TAX_GROUP_CODE_LIMITATION,
        VAT_PROD_POST_GRP_LIMITATION,
        SPLIT_ORDER_ON_LOAD_BALANCING,
        SYSTEMID,
        SYSTEMCREATEDAT,
        SYSTEMCREATEDBY,
        SYSTEMMODIFIEDAT,
        SYSTEMMODIFIEDBY,
        BRAND_FILTER_BTR,
        QRCODE_TEXT_BTR,
        QRCODE_DESCRIPTION_BTR,
        PRINT_QRCODE_BTR,
        PRINT_RECEIPT_NO_BTR,
        QRCODE_HEIGHT_BTR,
        QRCODE_WIDTH_BTR,
        CLOSED_BTR,
        STORE_XREF_NO_BTR,
        STORE_DIM_CREATED_BTR,
        NUMBER_OF_POS_TERMINALS
    ) VALUES (
        source.COMPANYNAME,
        source.SYSTEMROWVERSION,
        source.NO_,
        source.RESPONSIBILITY_CENTER,
        source.NAME,
        source.ADDRESS,
        source.ADDRESS_2,
        source.CITY,
        source.POST_CODE,
        source.STORE_MANAGER_ID,
        source.STORE_MANAGER_NAME,
        source.DB_DISTRIBUTION,
        source.PHONE_NO_,
        source.COUNTRY_CODE,
        source.GLOBAL_DIMENSION_1_CODE,
        source.LOCATION_CODE,
        source.CURRENCY_CODE,
        source.GLOBAL_DIMENSION_2_CODE,
        source.STORE_TYPE,
        source.LAST_DATE_MODIFIED,
        source.FUNCTIONALITY_PROFILE,
        source.MENU_PROFILE,
        source.INTERFACE_PROFILE,
        source.FRAUD_SORT_FIELD,
        source.STYLE_PROFILE,
        source.HARDWARE_PROFILE,
        source.ECOMMERCE_PROFILE_CODE,
        source.LANGUAGE_PROFILE_ID,
        source.SSK_PROFILE_ID,
        source.NO_SERIES,
        source.STATEMENT_NOS_,
        source.POSTED_STATEM_NOS_,
        source.ONE_STATEMENT_PER_DAY,
        source.AUTO_CALCULATE_STATEMENT,
        source.GROUP_BY_STAFF_POS,
        source.STATEMENT_METHOD,
        source.CLOSING_METHOD,
        source.ROUNDING_ACC_NAME,
        source.ROUNDING_ACCOUNT,
        source.MAX_DIFF_TO_ALLOW_POST,
        source.MAX_ROUND_IN_STMT_,
        source.MAX_DIFF_FROM_SHIFT_DATE,
        source.ALLOWED_DIFF_IN_TRANS_,
        source.PAYM_COMPR_IN_STATEM_POST_,
        source.TEND_DECL_CALCULATION,
        source.ADVANCED_SHIFT_METHOD,
        source.ADVANCED_SHIFT_NOS_,
        source.DEFAULT_COMMISSION_GROUP,
        source.CAMPAIGN_NOS_,
        source.PROMOTION_NOS_,
        source.PERIODIC_DISCOUNT_NOS_,
        source.PUBLISHED_OFFER_NOS_,
        source.MEMBER_NOTIFICATION_NOS_,
        source.FBP_NOS_,
        source.POS_TERMINAL_NOS_,
        source.STAFF_ID_NOS_,
        source.COUPON_NOS_,
        source.ITEM_NOS_,
        source.DATA_ACCESS_CONTROL,
        source.STORE_VAT_BUS_POST_GR_,
        source.STORE_GEN_BUS_POST_GR_,
        source.GEN_BUS_POST_GR_,
        source.LANGUAGE_CODE,
        source.POS_INVENTORY_LOOKUP,
        source.POS_WARMUP_ACTIVE,
        source.CLICK_AND_COLLECT,
        source.PRINT_RECEIPT_LOGO,
        source.PRINT_RECEIPT_BITMAP_NO_,
        source.RCPT_TEXT_MAX_LENGTH,
        source.NO_OF_TOP_BOTTOM_LINES,
        source.ITEM_NO_ON_RECEIPT,
        source.LAST_ACTION_FOR_LABEL_UPD,
        source.LAST_ACTION_FOR_ITEM_LABEL_UPD,
        source.NO_SHELF_LABEL_PRINTING,
        source.NO_ITEM_LABEL_PRINTING,
        source.SERVICE_CHARGE_,
        source.SERV_CHARGE_INC_EXP_ACC,
        source.SAFE_MGNT_IN_USE,
        source.LATITUDE,
        source.LONGITUDE,
        source.COUNTY,
        source.PICTURE,
        source.PICTURE_MEDIA,
        source.POS_CHECK_Z_REPORT,
        source.STORE_SIZE_SQUARE_METERS,
        source.LOADING_CARD_NOS_,
        source.RECEIVING_NOS_,
        source.POSTED_RECEIVING_NOS_,
        source.GIFT_REGISTRATION_NOS_,
        source.USE_BATCH_POSTING_FOR_STATEM_,
        source.ONLY_ACCEPT_STATEMENT,
        source.MAX_DIFF_TO_ALLOW_ACCEPT,
        source.CURRENT_HOSP_PRINTING_ROUTE,
        source.POS_START_AMOUNT_METHOD,
        source.POS_POST_SAFE_LEDGER,
        source.DINING_RESERVATION_NOS_,
        source.DINING_WAITING_LIST_NOS_,
        source.DINING_WALK_IN_NOS_,
        source.KDS_BACKUP_PRINTING,
        source.ACTIVE_KDS_LOAD_CONFIG_,
        source.DEFAULT_DELIVERY_TYPE,
        source.DISPLAY_DEL_TYPE_POP_UP,
        source.ORDERING_STATUS,
        source.DELIVERY_TAKEOUT_CHANGE,
        source.REST_ORDERS_IN_PROGRESS,
        source.REST_ESTIM_PROD_TIME_MIN_,
        source.KITCHEN_PROD_SYSTEM_IN_USE,
        source.NORMAL_ORDER_TIMING,
        source.MAX_ORDER_TIMING_MIN_,
        source.TIME_ROUNDING_PRECISION,
        source.ALLOW_MEMBER_SCANNING_IN_KIOSK,
        source.CURRENCY_CODE_IN_KIOSK,
        source.DISPLAY_ITEM_HTML_IN_KIOSK,
        source.LOCATION_PROFILE,
        source.LOCATION_URL,
        source.LOCATIONURLEXISTS,
        source.LOCATIONQRCODE,
        source.STORE_SALES_TYPE_FILTER,
        source.SHOW_AVAILAB_ON_POS_BUTTON,
        source.LAST_ZREPORT,
        source.LAST_YREPORT,
        source.ATTRIB_1_CODE,
        source.ATTRIB_2_CODE,
        source.ATTRIB_3_CODE,
        source.ATTRIB_4_CODE,
        source.ATTRIB_5_CODE,
        source.IN_TRANSIT_CODE,
        source.WEB_STORE,
        source.WEB_STORE_POS_TERMINAL,
        source.WEB_STORE_STAFF_ID,
        source.WEB_STORE_CUSTOMER_NO_,
        source.WEB_STORE_SHIPPING_COST_ITEM,
        source.LOYALTY,
        source.MOBILE,
        source.PLU_MENU_PROFILE,
        source.PLU_MENU_ID,
        source.LAST_ACTION_ENTRY_NO_,
        source.PREPAY_CUSTOMER_ORDER,
        source.CUSTOMER_ORDER_INC_EXPENSE_ACC,
        source.CUSTOMER_ORDER_REFUND_ACC,
        source.CUST_ORD_REFUND_TENDER_TYPE,
        source.USE_SHELF_POSITION,
        source.CO_TO_PICK_INDICATION,
        source.CO_TO_PICK_INTERVAL,
        source.INCLUDE_SPG_IN_COLLECT_PANEL,
        source.CALC_INV_FOR_SOURCING_LOCATION,
        source.CREATE_CLE_FOR_WEB_CUSTOMER,
        source.SKIP_PRINTING_TEND_DECL_COPY,
        source.CUSTOMER_ORDER_PREPAYMENT_ACC,
        source.TAX_AREA_CODE,
        source.TAX_LIABLE,
        source.USE_F_B_ORDER_STRUCTURE,
        source.LS_RECOMMEND_BATCH_NO_,
        source.RECOMMENDATION_API_URL,
        source.PLB_STORE,
        source.TAX_GROUP_CODE_LIMITATION,
        source.VAT_PROD_POST_GRP_LIMITATION,
        source.SPLIT_ORDER_ON_LOAD_BALANCING,
        source.SYSTEMID,
        source.SYSTEMCREATEDAT,
        source.SYSTEMCREATEDBY,
        source.SYSTEMMODIFIEDAT,
        source.SYSTEMMODIFIEDBY,
        source.BRAND_FILTER_BTR,
        source.QRCODE_TEXT_BTR,
        source.QRCODE_DESCRIPTION_BTR,
        source.PRINT_QRCODE_BTR,
        source.PRINT_RECEIPT_NO_BTR,
        source.QRCODE_HEIGHT_BTR,
        source.QRCODE_WIDTH_BTR,
        source.CLOSED_BTR,
        source.STORE_XREF_NO_BTR,
        source.STORE_DIM_CREATED_BTR,
        source.NUMBER_OF_POS_TERMINALS
    );
    
    -- Get merge statistics
   
    
EXCEPTION
    WHEN OTHER THEN
        RETURN ''Error in merge operation: '' || SQLERRM;
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_ITEMLEDGERENTRY()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
  MERGE INTO fco.silver.factItemLedgerEntry AS target
  USING fco.staging.stgItemLedgerEntry AS source
  ON target.CompanyName = source.CompanyName
  AND target.entryNo = source.entryNo

  -- Update existing records
  WHEN MATCHED THEN
      UPDATE SET
          target.SystemRowVersion = source.SystemRowVersion,
          target.itemNo = source.itemNo,
          target.postingDate = source.postingDate,
          target.entryType = source.entryType,
          target.sourceNo = source.sourceNo,
          target.documentNo = source.documentNo,
          target.description = source.description,
          target.locationCode = source.locationCode,
          target.quantity = source.quantity,
          target.remainingQuantity = source.remainingQuantity,
          target.invoicedQuantity = source.invoicedQuantity,
          target.appliesToEntry = source.appliesToEntry,
          target.open = source.open,
          target.globalDimension1Code = source.globalDimension1Code,
          target.globalDimension2Code = source.globalDimension2Code,
          target.positive = source.positive,
          target.shptMethodCode = source.shptMethodCode,
          target.sourceType = source.sourceType,
          target.dropShipment = source.dropShipment,
          target.transactionType = source.transactionType,
          target.transportMethod = source.transportMethod,
          target.countryRegionCode = source.countryRegionCode,
          target.entryExitPoint = source.entryExitPoint,
          target.documentDate = source.documentDate,
          target.externalDocumentNo = source.externalDocumentNo,
          target.area = source.area,
          target.transactionSpecification = source.transactionSpecification,
          target.noSeries = source.noSeries,
          target.documentType = source.documentType,
          target.documentLineNo = source.documentLineNo,
          target.orderType = source.orderType,
          target.orderNo = source.orderNo,
          target.orderLineNo = source.orderLineNo,
          target.dimensionSetID = source.dimensionSetID,
          target.assembleToOrder = source.assembleToOrder,
          target.jobNo = source.jobNo,
          target.jobTaskNo = source.jobTaskNo,
          target.jobPurchase = source.jobPurchase,
          target.variantCode = source.variantCode,
          target.qtyPerUnitOfMeasure = source.qtyPerUnitOfMeasure,
          target.unitOfMeasureCode = source.unitOfMeasureCode,
          target.derivedFromBlanketOrder = source.derivedFromBlanketOrder,
          target.CrossReferenceNo_ = source.CrossReferenceNo_,
          target.originallyOrderedNo = source.originallyOrderedNo,
          target.originallyOrderedVarCode = source.originallyOrderedVarCode,
          target.outOfStockSubstitution = source.outOfStockSubstitution,
          target.itemCategoryCode = source.itemCategoryCode,
          target.nonstock = source.nonstock,
          target.purchasingCode = source.purchasingCode,
          target.lscRetailProductCode = source.lscRetailProductCode,
          target.itemReferenceNo = source.itemReferenceNo,
          target.completelyInvoiced = source.completelyInvoiced,
          target.lastInvoiceDate = source.lastInvoiceDate,
          target.appliedEntryToAdjust = source.appliedEntryToAdjust,
          target.correction = source.correction,
          target.ShippedQty_Returned = source.ShippedQty_Returned,
          target.prodOrderCompLineNo = source.prodOrderCompLineNo,
          target.serialNo = source.serialNo,
          target.lotNo = source.lotNo,
          target.warrantyDate = source.warrantyDate,
          target.expirationDate = source.expirationDate,
          target.itemTracking = replace(source.itemTracking,''_x0020_'','' ''),
          target.packageNo = source.packageNo,
          target.returnReasonCode = source.returnReasonCode,
          target.colourBTR = source.colourBTR,
          target.sizeBTR = source.sizeBTR,
          target.BTRWFAttachment = source.BTRWFAttachment,
          target.lscOfferNo = source.lscOfferNo,
          target.lscBatchNo = source.lscBatchNo,
          target.lscPromotionNo = source.lscPromotionNo,
          target.lscTransferType = source.lscTransferType,
          target.LSCBITimestamp = source.LSCBITimestamp,
          target.lscStatementNo = source.lscStatementNo,
          target.costAmountActual = source.costAmountActual,
          target.costAmountActualACY = source.costAmountActualACY,
          target.costAmountExpected = source.costAmountExpected,
          target.costAmountExpectedACY = source.costAmountExpectedACY,
          target.costAmountNonInvtbl = source.costAmountNonInvtbl,
          target.costAmountNonInvtblACY = source.costAmountNonInvtblACY,
          target.purchaseAmountActual = source.purchaseAmountActual,
          target.purchaseAmountExpected = source.purchaseAmountExpected,
          target.reservedQuantity = source.reservedQuantity,
          target.salesAmountActual = source.salesAmountActual,
          target.salesAmountExpected = source.salesAmountExpected,
          target.shippedQtyNotReturned = source.shippedQtyNotReturned,
          target.shortcutDimension3Code = source.shortcutDimension3Code,
          target.shortcutDimension4Code = source.shortcutDimension4Code,
          target.shortcutDimension5Code = source.shortcutDimension5Code,
          target.shortcutDimension6Code = source.shortcutDimension6Code,
          target.shortcutDimension7Code = source.shortcutDimension7Code,
          target.shortcutDimension8Code = source.shortcutDimension8Code,
          target.zeroStockDateBTR = source.zeroStockDateBTR,
          target.systemId = source.systemId,
          target.systemCreatedAt = source.systemCreatedAt,
          target.systemCreatedBy = source.systemCreatedBy,
          target.systemModifiedAt = source.systemModifiedAt,
          target.systemModifiedBy = source.systemModifiedBy

  -- Insert new records
  WHEN NOT MATCHED THEN
      INSERT (
          CompanyName, SystemRowVersion, entryNo, itemNo, postingDate, entryType, sourceNo, documentNo, description,
          locationCode, quantity, remainingQuantity, invoicedQuantity, appliesToEntry, open, globalDimension1Code,
          globalDimension2Code, positive, shptMethodCode, sourceType, dropShipment, transactionType, transportMethod,
          countryRegionCode, entryExitPoint, documentDate, externalDocumentNo, area, transactionSpecification,
          noSeries, documentType, documentLineNo, orderType, orderNo, orderLineNo, dimensionSetID, assembleToOrder,
          jobNo, jobTaskNo, jobPurchase, variantCode, qtyPerUnitOfMeasure, unitOfMeasureCode, derivedFromBlanketOrder,
          CrossReferenceNo_, originallyOrderedNo, originallyOrderedVarCode, outOfStockSubstitution, itemCategoryCode,
          nonstock, purchasingCode, lscRetailProductCode, itemReferenceNo, completelyInvoiced, lastInvoiceDate,
          appliedEntryToAdjust, correction, ShippedQty_Returned, prodOrderCompLineNo, serialNo, lotNo,
          warrantyDate, expirationDate, itemTracking, packageNo, returnReasonCode, colourBTR, sizeBTR, BTRWFAttachment,
          lscOfferNo, lscBatchNo, lscPromotionNo, lscTransferType, LSCBITimestamp, lscStatementNo, costAmountActual,
          costAmountActualACY, costAmountExpected, costAmountExpectedACY, costAmountNonInvtbl, costAmountNonInvtblACY,
          purchaseAmountActual, purchaseAmountExpected, reservedQuantity, salesAmountActual, salesAmountExpected,
          shippedQtyNotReturned, shortcutDimension3Code, shortcutDimension4Code, shortcutDimension5Code,
          shortcutDimension6Code, shortcutDimension7Code, shortcutDimension8Code, zeroStockDateBTR, systemId,
          systemCreatedAt, systemCreatedBy, systemModifiedAt, systemModifiedBy
      )
      VALUES (
          source.CompanyName, source.SystemRowVersion, source.entryNo, source.itemNo, source.postingDate, source.entryType,
          source.sourceNo, source.documentNo, source.description, source.locationCode, source.quantity,
          source.remainingQuantity, source.invoicedQuantity, source.appliesToEntry, source.Open,
          source.globalDimension1Code, source.globalDimension2Code, source.positive, source.shptMethodCode,
          source.sourceType, source.dropShipment, source.transactionType, source.transportMethod, source.countryRegionCode,
          source.entryExitPoint, source.documentDate, source.externalDocumentNo, source.area,
          source.transactionSpecification, source.noSeries, source.documentType, source.documentLineNo, source.orderType,
          source.orderNo, source.orderLineNo, source.dimensionSetID, source.assembleToOrder, source.jobNo,
          source.jobTaskNo, source.jobPurchase, source.variantCode, source.qtyPerUnitOfMeasure, source.unitOfMeasureCode,
          source.derivedFromBlanketOrder, source.CrossReferenceNo_, source.originallyOrderedNo,
          source.originallyOrderedVarCode, source.outOfStockSubstitution, source.itemCategoryCode, source.nonstock,
          source.purchasingCode, source.lscRetailProductCode, source.itemReferenceNo, source.completelyInvoiced,
          source.lastInvoiceDate, source.appliedEntryToAdjust, source.correction, source.ShippedQty_Returned,
          source.prodOrderCompLineNo, source.serialNo, source.lotNo, source.warrantyDate, source.expirationDate,
          replace(source.itemTracking,''_x0020_'','' ''), source.packageNo, source.returnReasonCode, source.colourBTR, source.sizeBTR,
          source.BTRWFAttachment, source.lscOfferNo, source.lscBatchNo, source.lscPromotionNo, source.lscTransferType,
          source.LSCBITimestamp, source.lscStatementNo, source.costAmountActual, source.costAmountActualACY,
          source.costAmountExpected, source.costAmountExpectedACY, source.costAmountNonInvtbl,
          source.costAmountNonInvtblACY, source.purchaseAmountActual, source.purchaseAmountExpected,
          source.reservedQuantity, source.salesAmountActual, source.salesAmountExpected, source.shippedQtyNotReturned,
          source.shortcutDimension3Code, source.shortcutDimension4Code, source.shortcutDimension5Code,
          source.shortcutDimension6Code, source.shortcutDimension7Code, source.shortcutDimension8Code,
          source.zeroStockDateBTR, source.systemId, source.systemCreatedAt, source.systemCreatedBy,
          source.systemModifiedAt, source.systemModifiedBy
      )
  ;
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_ITEM_VARIANT()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
DECLARE
    rows_merged INTEGER DEFAULT 0;
    rows_inserted INTEGER DEFAULT 0;
    rows_updated INTEGER DEFAULT 0;
    result_msg STRING;
BEGIN
    
    -- Perform MERGE operation from staging to silver table
    MERGE INTO FCO.SILVER.DIMITEMVARIANT AS target
    USING (
        SELECT 
            COMPANYNAME,
            SYSTEMROWVERSION,
            ITEM_NO_,
            VARIANT,
            VARIANT_DIMENSION_1,
            VARIANT_DIMENSION_2,
            VARIANT_DIMENSION_3,
            VARIANT_DIMENSION_4,
            VARIANT_DIMENSION_5,
            VARIANT_DIMENSION_6,
            BARCODE,
            LOGICAL_ORDER,
            DIMENSION_WEIGHT_1,
            DIMENSION_WEIGHT_2,
            DIMENSION_WEIGHT_3,
            DIMENSION_WEIGHT_4,
            DIMENSION_WEIGHT_5,
            DIMENSION_WEIGHT_6,
            DESCRIPTION,
            DESCRIPTION_2,
            ITEM_ID,
            BLOCKED,
            SALES_BLOCKED,
            PURCHASING_BLOCKED,
            SERVICE_BLOCKED,
            WC_UN_PUBLISHED_BTR,
            WC_ENTITY_EXIST,
            WC_DESCRIPTION_BTR,
            WC_ID_BTR,
            WC_ATTRIBUTES_CREATED_BTR,
            WC_ATTRIBUTES_CREATED_CNT_BTR,
            WC_PARENT_ID_BTR,
            ON_MARKDOWN_BTR,
            OLD_VARIANT_CODE_BTR,
            OLD_VARIANT_CODE_2_BTR,
            LSC_COMMON_ITEM_NO_,
            SYSTEMID,
            SYSTEMCREATEDAT,
            SYSTEMCREATEDBY,
            SYSTEMMODIFIEDAT,
            SYSTEMMODIFIEDBY
        FROM FCO.STAGING.STGITEMVARIANT
    ) AS source
    ON target.COMPANYNAME = source.COMPANYNAME 
       AND target.ITEM_NO_ = source.ITEM_NO_ 
       AND target.VARIANT = source.VARIANT
    
    -- Update existing records when matched and data has changed
    WHEN MATCHED AND (
        COALESCE(target.SYSTEMROWVERSION, 0) <> COALESCE(source.SYSTEMROWVERSION, 0)
        OR COALESCE(target.VARIANT_DIMENSION_1, '''') <> COALESCE(source.VARIANT_DIMENSION_1, '''')
        OR COALESCE(target.VARIANT_DIMENSION_2, '''') <> COALESCE(source.VARIANT_DIMENSION_2, '''')
        OR COALESCE(target.VARIANT_DIMENSION_3, '''') <> COALESCE(source.VARIANT_DIMENSION_3, '''')
        OR COALESCE(target.VARIANT_DIMENSION_4, '''') <> COALESCE(source.VARIANT_DIMENSION_4, '''')
        OR COALESCE(target.VARIANT_DIMENSION_5, '''') <> COALESCE(source.VARIANT_DIMENSION_5, '''')
        OR COALESCE(target.VARIANT_DIMENSION_6, '''') <> COALESCE(source.VARIANT_DIMENSION_6, '''')
        OR COALESCE(target.BARCODE, '''') <> COALESCE(source.BARCODE, '''')
        OR COALESCE(target.LOGICAL_ORDER, '''') <> COALESCE(source.LOGICAL_ORDER, '''')
        OR COALESCE(target.DIMENSION_WEIGHT_1, '''') <> COALESCE(source.DIMENSION_WEIGHT_1, '''')
        OR COALESCE(target.DIMENSION_WEIGHT_2, '''') <> COALESCE(source.DIMENSION_WEIGHT_2, '''')
        OR COALESCE(target.DIMENSION_WEIGHT_3, '''') <> COALESCE(source.DIMENSION_WEIGHT_3, '''')
        OR COALESCE(target.DIMENSION_WEIGHT_4, '''') <> COALESCE(source.DIMENSION_WEIGHT_4, '''')
        OR COALESCE(target.DIMENSION_WEIGHT_5, '''') <> COALESCE(source.DIMENSION_WEIGHT_5, '''')
        OR COALESCE(target.DIMENSION_WEIGHT_6, '''') <> COALESCE(source.DIMENSION_WEIGHT_6, '''')
        OR COALESCE(target.DESCRIPTION, '''') <> COALESCE(source.DESCRIPTION, '''')
        OR COALESCE(target.DESCRIPTION_2, '''') <> COALESCE(source.DESCRIPTION_2, '''')
        OR COALESCE(target.ITEM_ID, '''') <> COALESCE(source.ITEM_ID, '''')
        OR COALESCE(target.BLOCKED, '''') <> COALESCE(source.BLOCKED, '''')
        OR COALESCE(target.SALES_BLOCKED, '''') <> COALESCE(source.SALES_BLOCKED, '''')
        OR COALESCE(target.PURCHASING_BLOCKED, '''') <> COALESCE(source.PURCHASING_BLOCKED, '''')
        OR COALESCE(target.SERVICE_BLOCKED, '''') <> COALESCE(source.SERVICE_BLOCKED, '''')
        OR COALESCE(target.WC_UN_PUBLISHED_BTR, '''') <> COALESCE(source.WC_UN_PUBLISHED_BTR, '''')
        OR COALESCE(target.WC_ENTITY_EXIST, '''') <> COALESCE(source.WC_ENTITY_EXIST, '''')
        OR COALESCE(target.WC_DESCRIPTION_BTR, '''') <> COALESCE(source.WC_DESCRIPTION_BTR, '''')
        OR COALESCE(target.WC_ID_BTR, '''') <> COALESCE(source.WC_ID_BTR, '''')
        OR COALESCE(target.WC_ATTRIBUTES_CREATED_BTR, '''') <> COALESCE(source.WC_ATTRIBUTES_CREATED_BTR, '''')
        OR COALESCE(target.WC_ATTRIBUTES_CREATED_CNT_BTR, 0) <> COALESCE(source.WC_ATTRIBUTES_CREATED_CNT_BTR, 0)
        OR COALESCE(target.WC_PARENT_ID_BTR, '''') <> COALESCE(source.WC_PARENT_ID_BTR, '''')
        OR COALESCE(target.ON_MARKDOWN_BTR, '''') <> COALESCE(source.ON_MARKDOWN_BTR, '''')
        OR COALESCE(target.OLD_VARIANT_CODE_BTR, '''') <> COALESCE(source.OLD_VARIANT_CODE_BTR, '''')
        OR COALESCE(target.OLD_VARIANT_CODE_2_BTR, '''') <> COALESCE(source.OLD_VARIANT_CODE_2_BTR, '''')
        OR COALESCE(target.LSC_COMMON_ITEM_NO_, '''') <> COALESCE(source.LSC_COMMON_ITEM_NO_, '''')
        OR COALESCE(target.SYSTEMID, '''') <> COALESCE(source.SYSTEMID, '''')
        OR COALESCE(target.SYSTEMCREATEDAT, ''1900-01-01''::TIMESTAMP_NTZ) <> COALESCE(source.SYSTEMCREATEDAT, ''1900-01-01''::TIMESTAMP_NTZ)
        OR COALESCE(target.SYSTEMCREATEDBY, '''') <> COALESCE(source.SYSTEMCREATEDBY, '''')
        OR COALESCE(target.SYSTEMMODIFIEDAT, ''1900-01-01''::TIMESTAMP_NTZ) <> COALESCE(source.SYSTEMMODIFIEDAT, ''1900-01-01''::TIMESTAMP_NTZ)
        OR COALESCE(target.SYSTEMMODIFIEDBY, '''') <> COALESCE(source.SYSTEMMODIFIEDBY, '''')
    ) THEN UPDATE SET
        SYSTEMROWVERSION = source.SYSTEMROWVERSION,
        VARIANT_DIMENSION_1 = source.VARIANT_DIMENSION_1,
        VARIANT_DIMENSION_2 = source.VARIANT_DIMENSION_2,
        VARIANT_DIMENSION_3 = source.VARIANT_DIMENSION_3,
        VARIANT_DIMENSION_4 = source.VARIANT_DIMENSION_4,
        VARIANT_DIMENSION_5 = source.VARIANT_DIMENSION_5,
        VARIANT_DIMENSION_6 = source.VARIANT_DIMENSION_6,
        BARCODE = source.BARCODE,
        LOGICAL_ORDER = source.LOGICAL_ORDER,
        DIMENSION_WEIGHT_1 = source.DIMENSION_WEIGHT_1,
        DIMENSION_WEIGHT_2 = source.DIMENSION_WEIGHT_2,
        DIMENSION_WEIGHT_3 = source.DIMENSION_WEIGHT_3,
        DIMENSION_WEIGHT_4 = source.DIMENSION_WEIGHT_4,
        DIMENSION_WEIGHT_5 = source.DIMENSION_WEIGHT_5,
        DIMENSION_WEIGHT_6 = source.DIMENSION_WEIGHT_6,
        DESCRIPTION = source.DESCRIPTION,
        DESCRIPTION_2 = source.DESCRIPTION_2,
        ITEM_ID = source.ITEM_ID,
        BLOCKED = source.BLOCKED,
        SALES_BLOCKED = source.SALES_BLOCKED,
        PURCHASING_BLOCKED = source.PURCHASING_BLOCKED,
        SERVICE_BLOCKED = source.SERVICE_BLOCKED,
        WC_UN_PUBLISHED_BTR = source.WC_UN_PUBLISHED_BTR,
        WC_ENTITY_EXIST = source.WC_ENTITY_EXIST,
        WC_DESCRIPTION_BTR = source.WC_DESCRIPTION_BTR,
        WC_ID_BTR = source.WC_ID_BTR,
        WC_ATTRIBUTES_CREATED_BTR = source.WC_ATTRIBUTES_CREATED_BTR,
        WC_ATTRIBUTES_CREATED_CNT_BTR = source.WC_ATTRIBUTES_CREATED_CNT_BTR,
        WC_PARENT_ID_BTR = source.WC_PARENT_ID_BTR,
        ON_MARKDOWN_BTR = source.ON_MARKDOWN_BTR,
        OLD_VARIANT_CODE_BTR = source.OLD_VARIANT_CODE_BTR,
        OLD_VARIANT_CODE_2_BTR = source.OLD_VARIANT_CODE_2_BTR,
        LSC_COMMON_ITEM_NO_ = source.LSC_COMMON_ITEM_NO_,
        SYSTEMID = source.SYSTEMID,
        SYSTEMCREATEDAT = source.SYSTEMCREATEDAT,
        SYSTEMCREATEDBY = source.SYSTEMCREATEDBY,
        SYSTEMMODIFIEDAT = source.SYSTEMMODIFIEDAT,
        SYSTEMMODIFIEDBY = source.SYSTEMMODIFIEDBY
    
    -- Insert new records when not matched
    WHEN NOT MATCHED THEN INSERT (
        COMPANYNAME,
        SYSTEMROWVERSION,
        ITEM_NO_,
        VARIANT,
        VARIANT_DIMENSION_1,
        VARIANT_DIMENSION_2,
        VARIANT_DIMENSION_3,
        VARIANT_DIMENSION_4,
        VARIANT_DIMENSION_5,
        VARIANT_DIMENSION_6,
        BARCODE,
        LOGICAL_ORDER,
        DIMENSION_WEIGHT_1,
        DIMENSION_WEIGHT_2,
        DIMENSION_WEIGHT_3,
        DIMENSION_WEIGHT_4,
        DIMENSION_WEIGHT_5,
        DIMENSION_WEIGHT_6,
        DESCRIPTION,
        DESCRIPTION_2,
        ITEM_ID,
        BLOCKED,
        SALES_BLOCKED,
        PURCHASING_BLOCKED,
        SERVICE_BLOCKED,
        WC_UN_PUBLISHED_BTR,
        WC_ENTITY_EXIST,
        WC_DESCRIPTION_BTR,
        WC_ID_BTR,
        WC_ATTRIBUTES_CREATED_BTR,
        WC_ATTRIBUTES_CREATED_CNT_BTR,
        WC_PARENT_ID_BTR,
        ON_MARKDOWN_BTR,
        OLD_VARIANT_CODE_BTR,
        OLD_VARIANT_CODE_2_BTR,
        LSC_COMMON_ITEM_NO_,
        SYSTEMID,
        SYSTEMCREATEDAT,
        SYSTEMCREATEDBY,
        SYSTEMMODIFIEDAT,
        SYSTEMMODIFIEDBY
    ) VALUES (
        source.COMPANYNAME,
        source.SYSTEMROWVERSION,
        source.ITEM_NO_,
        source.VARIANT,
        source.VARIANT_DIMENSION_1,
        source.VARIANT_DIMENSION_2,
        source.VARIANT_DIMENSION_3,
        source.VARIANT_DIMENSION_4,
        source.VARIANT_DIMENSION_5,
        source.VARIANT_DIMENSION_6,
        source.BARCODE,
        source.LOGICAL_ORDER,
        source.DIMENSION_WEIGHT_1,
        source.DIMENSION_WEIGHT_2,
        source.DIMENSION_WEIGHT_3,
        source.DIMENSION_WEIGHT_4,
        source.DIMENSION_WEIGHT_5,
        source.DIMENSION_WEIGHT_6,
        source.DESCRIPTION,
        source.DESCRIPTION_2,
        source.ITEM_ID,
        source.BLOCKED,
        source.SALES_BLOCKED,
        source.PURCHASING_BLOCKED,
        source.SERVICE_BLOCKED,
        source.WC_UN_PUBLISHED_BTR,
        source.WC_ENTITY_EXIST,
        source.WC_DESCRIPTION_BTR,
        source.WC_ID_BTR,
        source.WC_ATTRIBUTES_CREATED_BTR,
        source.WC_ATTRIBUTES_CREATED_CNT_BTR,
        source.WC_PARENT_ID_BTR,
        source.ON_MARKDOWN_BTR,
        source.OLD_VARIANT_CODE_BTR,
        source.OLD_VARIANT_CODE_2_BTR,
        source.LSC_COMMON_ITEM_NO_,
        source.SYSTEMID,
        source.SYSTEMCREATEDAT,
        source.SYSTEMCREATEDBY,
        source.SYSTEMMODIFIEDAT,
        source.SYSTEMMODIFIEDBY
    );
    
    -- Get row counts from SQLROWCOUNT after merge
    rows_merged := SQLROWCOUNT;
    
    -- Build result message
    result_msg := ''MERGE completed successfully. Total rows processed: '' || rows_merged;
    
    RETURN result_msg;
    
EXCEPTION
    WHEN OTHER THEN
        RETURN ''Error occurred during MERGE operation: '' || SQLERRM;
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_LOTINFO()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
 MERGE INTO fco.silver.factLotNo_Information AS target
 USING fco.staging.stgLotNo_Information AS source
 ON target.companyName = source.companyName
 AND target.itemNo = source.itemNo
 AND target.variantCode = source.variantCode
 AND target.lotNo = source.lotNo

 WHEN MATCHED THEN
     UPDATE SET
         target.SystemRowVersion = source.SystemRowVersion,
         target.description = source.description,
         target.testQuality = source.testQuality,
         target.certificateNumber = source.certificateNumber,
         target.blocked = source.blocked,
         target.number = source.number,
         target.packageType = source.packageType,
         target.quantity = source.quantity,
         target.typeBTR = source.typeBTR,
         target.no = source.no,
         target.sourceNo = source.sourceNo,
         target.sourceLineNo = source.sourceLineNo,
         target.sourceDocumentBTR = source.sourceDocumentBTR,
         target.printed = source.printed,
         target.firstReceiptDate = source.firstReceiptDate,
         target.firstShipmentDate = source.firstShipmentDate,
         target.qcRequired = source.qcRequired,
         target.qcStatus = source.qcStatus,
         target.isQCLot = source.isQCLot,
         target.qcStatusTime = source.qcStatusTime,
         target.qcStartTime = source.qcStartTime,
         target.quantityConfirmed = source.quantityConfirmed,
         target.confirmed = source.confirmed,
         target.quantityCounted = source.quantityCounted,
         target.countInProgress = source.countInProgress,
         target.routeLabelPrinted = source.routeLabelPrinted,
         target.lastReceiptDate = source.lastReceiptDate,
         target.lastShipmentDate = source.lastShipmentDate,
         target.lastBinCode = source.lastBinCode,
         target.lastLocationCode = source.lastLocationCode,
         target.shipToCode = source.shipToCode,
         target.shipToName = source.shipToName,
         target.shipToName2 = source.shipToName2,
         target.shipToAddress = source.shipToAddress,
         target.shipToAddress2 = source.shipToAddress2,
         target.shipToPostCode = source.shipToPostCode,
         target.shipToCity = source.shipToCity,
         target.shipToCounty = source.shipToCounty,
         target.shipToCountryRegionCode = source.shipToCountryRegionCode,
         target.shipToContact = source.shipToContact,
         target.brandDimensionCode = source.brandDimensionCode,
         target.brandDimensionName = source.brandDimensionName,
         target.shipmentPosted = source.shipmentPosted,
         target.tripSheetNo = source.tripSheetNo,
         target.integrationProcessed = source.integrationProcessed,
         target.externalDocumentNo = source.externalDocumentNo,
         target.creationDate = source.creationDate,
         target.printedDate = source.printedDate,
         target.routePrintedDate = source.routePrintedDate,
         target.quantityPicked = source.quantityPicked,
         target.qtyToTransfer = source.qtyToTransfer,
         target.transferToLotNo = source.transferToLotNo,
         target.transferToLocation = source.transferToLocation,
         target.modifiedAt = source.modifiedAt,
         target.countDateTime = source.countDateTime,
         target.lastQuantityCounted = source.lastQuantityCounted,
         target.countDate = source.countDate,
         target.countPostingDate = source.countPostingDate,
         target.countJournalTemplateName = source.countJournalTemplateName,
         target.countJournalBatchName = source.countJournalBatchName,
         target.difference = source.difference,
         target.ADCSUser = source.ADCSUser,
         target.QuantityxRex = source.QuantityxRex,
         target.vendorItemNo = source.vendorItemNo,
         target.confirmedADCSUser = source.confirmedADCSUser,
         target.MovementADCSUser = source.MovementADCSUser,
         target.confirmedDateTime = source.confirmedDateTime,
         target.lotLedgerProcessed = source.lotLedgerProcessed,
         target.whsePostedDocumentNo = source.whsePostedDocumentNo,
         target.lotUsed = source.lotUsed,
         target.weight = source.weight,
         target.systemId = source.systemId,
         target.systemCreatedAt = source.systemCreatedAt,
         target.systemCreatedBy = source.systemCreatedBy,
         target.systemModifiedAt = source.systemModifiedAt,
         target.systemModifiedBy = source.systemModifiedBy,
         target.comment = source.comment,
         target.expiredInventory = source.expiredInventory,
         target.inventory = source.inventory,
         target.relatedLots = source.relatedLots,
         target.relatedPallet = source.relatedPallet,
         target.binContentQty = source.binContentQty

 WHEN NOT MATCHED  THEN
     INSERT (
         companyName, SystemRowVersion, itemNo, variantCode, lotNo, description, testQuality, certificateNumber,
         blocked, number, packageType, quantity, typeBTR, no, sourceNo, sourceLineNo, sourceDocumentBTR,
         printed, firstReceiptDate, firstShipmentDate, qcRequired, qcStatus, isQCLot, qcStatusTime,
         qcStartTime, quantityConfirmed, confirmed, quantityCounted, countInProgress, routeLabelPrinted,
         lastReceiptDate, lastShipmentDate, lastBinCode, lastLocationCode, shipToCode, shipToName,
         shipToName2, shipToAddress, shipToAddress2, shipToPostCode, shipToCity, shipToCounty,
         shipToCountryRegionCode, shipToContact, brandDimensionCode, brandDimensionName, shipmentPosted,
         tripSheetNo, integrationProcessed, externalDocumentNo, creationDate, printedDate, routePrintedDate,
         quantityPicked, qtyToTransfer, transferToLotNo, transferToLocation, modifiedAt, countDateTime,
         lastQuantityCounted, countDate, countPostingDate, countJournalTemplateName, countJournalBatchName,
         difference, ADCSUser, QuantityxRex, vendorItemNo, confirmedADCSUser, MovementADCSUser,
         confirmedDateTime, lotLedgerProcessed, whsePostedDocumentNo, lotUsed, weight, systemId,
         systemCreatedAt, systemCreatedBy, systemModifiedAt, systemModifiedBy, comment, expiredInventory,
         inventory, relatedLots, relatedPallet, binContentQty
     )
     VALUES (
         source.companyName, source.SystemRowVersion, source.itemNo, source.variantCode, source.lotNo,
         source.description, source.testQuality, source.certificateNumber, source.blocked, source.number,
         source.packageType, source.quantity, source.typeBTR, source.no, source.sourceNo,
         source.sourceLineNo, source.sourceDocumentBTR, source.printed, source.firstReceiptDate,
         source.firstShipmentDate, source.qcRequired, source.qcStatus, source.isQCLot,
         source.qcStatusTime, source.qcStartTime, source.quantityConfirmed, source.confirmed,
         source.quantityCounted, source.countInProgress, source.routeLabelPrinted, source.lastReceiptDate,
         source.lastShipmentDate, source.lastBinCode, source.lastLocationCode, source.shipToCode,
         source.shipToName, source.shipToName2, source.shipToAddress, source.shipToAddress2,
         source.shipToPostCode, source.shipToCity, source.shipToCounty, source.shipToCountryRegionCode,
         source.shipToContact, source.brandDimensionCode, source.brandDimensionName, source.shipmentPosted,
         source.tripSheetNo, source.integrationProcessed, source.externalDocumentNo, source.creationDate,
         source.printedDate, source.routePrintedDate, source.quantityPicked, source.qtyToTransfer,
         source.transferToLotNo, source.transferToLocation, source.modifiedAt, source.countDateTime,
         source.lastQuantityCounted, source.countDate, source.countPostingDate, source.countJournalTemplateName,
         source.countJournalBatchName, source.difference, source.ADCSUser, source.QuantityxRex,
         source.vendorItemNo, source.confirmedADCSUser, source.MovementADCSUser, source.confirmedDateTime,
         source.lotLedgerProcessed, source.whsePostedDocumentNo, source.lotUsed, source.weight,
         source.systemId, source.systemCreatedAt, source.systemCreatedBy, source.systemModifiedAt,
         source.systemModifiedBy, source.comment, source.expiredInventory, source.inventory,
         source.relatedLots, source.relatedPallet, source.binContentQty
     );
     END;
';
CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_LOTNO_INFORMATION()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
 MERGE INTO fco.silver.factLotNo_Information AS target
 USING fco.staging.stgLotNo_Information AS source
 ON target.companyName = source.companyName
 AND target.itemNo = source.itemNo
 AND target.variantCode = source.variantCode
 AND target.lotNo = source.lotNo

 WHEN MATCHED THEN
     UPDATE SET
         target.SystemRowVersion = source.SystemRowVersion,
         target.description = source.description,
         target.testQuality = source.testQuality,
         target.certificateNumber = source.certificateNumber,
         target.blocked = source.blocked,
         target.number = source.number,
         target.packageType = source.packageType,
         target.quantity = source.quantity,
         target.typeBTR = source.typeBTR,
         target.no = source.no,
         target.sourceNo = source.sourceNo,
         target.sourceLineNo = source.sourceLineNo,
         target.sourceDocumentBTR = source.sourceDocumentBTR,
         target.printed = source.printed,
         target.firstReceiptDate = source.firstReceiptDate,
         target.firstShipmentDate = source.firstShipmentDate,
         target.qcRequired = source.qcRequired,
         target.qcStatus = source.qcStatus,
         target.isQCLot = source.isQCLot,
         target.qcStatusTime = source.qcStatusTime,
         target.qcStartTime = source.qcStartTime,
         target.quantityConfirmed = source.quantityConfirmed,
         target.confirmed = source.confirmed,
         target.quantityCounted = source.quantityCounted,
         target.countInProgress = source.countInProgress,
         target.routeLabelPrinted = source.routeLabelPrinted,
         target.lastReceiptDate = source.lastReceiptDate,
         target.lastShipmentDate = source.lastShipmentDate,
         target.lastBinCode = source.lastBinCode,
         target.lastLocationCode = source.lastLocationCode,
         target.shipToCode = source.shipToCode,
         target.shipToName = source.shipToName,
         target.shipToName2 = source.shipToName2,
         target.shipToAddress = source.shipToAddress,
         target.shipToAddress2 = source.shipToAddress2,
         target.shipToPostCode = source.shipToPostCode,
         target.shipToCity = source.shipToCity,
         target.shipToCounty = source.shipToCounty,
         target.shipToCountryRegionCode = source.shipToCountryRegionCode,
         target.shipToContact = source.shipToContact,
         target.brandDimensionCode = source.brandDimensionCode,
         target.brandDimensionName = source.brandDimensionName,
         target.shipmentPosted = source.shipmentPosted,
         target.tripSheetNo = source.tripSheetNo,
         target.integrationProcessed = source.integrationProcessed,
         target.externalDocumentNo = source.externalDocumentNo,
         target.creationDate = source.creationDate,
         target.printedDate = source.printedDate,
         target.routePrintedDate = source.routePrintedDate,
         target.quantityPicked = source.quantityPicked,
         target.qtyToTransfer = source.qtyToTransfer,
         target.transferToLotNo = source.transferToLotNo,
         target.transferToLocation = source.transferToLocation,
         target.modifiedAt = source.modifiedAt,
         target.countDateTime = source.countDateTime,
         target.lastQuantityCounted = source.lastQuantityCounted,
         target.countDate = source.countDate,
         target.countPostingDate = source.countPostingDate,
         target.countJournalTemplateName = source.countJournalTemplateName,
         target.countJournalBatchName = source.countJournalBatchName,
         target.difference = source.difference,
         target.ADCSUser = source.ADCSUser,
         target.QuantityxRex = source.QuantityxRex,
         target.vendorItemNo = source.vendorItemNo,
         target.confirmedADCSUser = source.confirmedADCSUser,
         target.MovementADCSUser = source.MovementADCSUser,
         target.confirmedDateTime = source.confirmedDateTime,
         target.lotLedgerProcessed = source.lotLedgerProcessed,
         target.whsePostedDocumentNo = source.whsePostedDocumentNo,
         target.lotUsed = source.lotUsed,
         target.weight = source.weight,
         target.systemId = source.systemId,
         target.systemCreatedAt = source.systemCreatedAt,
         target.systemCreatedBy = source.systemCreatedBy,
         target.systemModifiedAt = source.systemModifiedAt,
         target.systemModifiedBy = source.systemModifiedBy,
         target.comment = source.comment,
         target.expiredInventory = source.expiredInventory,
         target.inventory = source.inventory,
         target.relatedLots = source.relatedLots,
         target.relatedPallet = source.relatedPallet,
         target.binContentQty = source.binContentQty

 WHEN NOT MATCHED   THEN
     INSERT (
         companyName, SystemRowVersion, itemNo, variantCode, lotNo, description, testQuality, certificateNumber,
         blocked, number, packageType, quantity, typeBTR, no, sourceNo, sourceLineNo, sourceDocumentBTR,
         printed, firstReceiptDate, firstShipmentDate, qcRequired, qcStatus, isQCLot, qcStatusTime,
         qcStartTime, quantityConfirmed, confirmed, quantityCounted, countInProgress, routeLabelPrinted,
         lastReceiptDate, lastShipmentDate, lastBinCode, lastLocationCode, shipToCode, shipToName,
         shipToName2, shipToAddress, shipToAddress2, shipToPostCode, shipToCity, shipToCounty,
         shipToCountryRegionCode, shipToContact, brandDimensionCode, brandDimensionName, shipmentPosted,
         tripSheetNo, integrationProcessed, externalDocumentNo, creationDate, printedDate, routePrintedDate,
         quantityPicked, qtyToTransfer, transferToLotNo, transferToLocation, modifiedAt, countDateTime,
         lastQuantityCounted, countDate, countPostingDate, countJournalTemplateName, countJournalBatchName,
         difference, ADCSUser, QuantityxRex, vendorItemNo, confirmedADCSUser, MovementADCSUser,
         confirmedDateTime, lotLedgerProcessed, whsePostedDocumentNo, lotUsed, weight, systemId,
         systemCreatedAt, systemCreatedBy, systemModifiedAt, systemModifiedBy, comment, expiredInventory,
         inventory, relatedLots, relatedPallet, binContentQty
     )
     VALUES (
         source.companyName, source.SystemRowVersion, source.itemNo, source.variantCode, source.lotNo,
         source.description, source.testQuality, source.certificateNumber, source.blocked, source.number,
         source.packageType, source.quantity, source.typeBTR, source.no, source.sourceNo,
         source.sourceLineNo, source.sourceDocumentBTR, source.printed, source.firstReceiptDate,
         source.firstShipmentDate, source.qcRequired, source.qcStatus, source.isQCLot,
         source.qcStatusTime, source.qcStartTime, source.quantityConfirmed, source.confirmed,
         source.quantityCounted, source.countInProgress, source.routeLabelPrinted, source.lastReceiptDate,
         source.lastShipmentDate, source.lastBinCode, source.lastLocationCode, source.shipToCode,
         source.shipToName, source.shipToName2, source.shipToAddress, source.shipToAddress2,
         source.shipToPostCode, source.shipToCity, source.shipToCounty, source.shipToCountryRegionCode,
         source.shipToContact, source.brandDimensionCode, source.brandDimensionName, source.shipmentPosted,
         source.tripSheetNo, source.integrationProcessed, source.externalDocumentNo, source.creationDate,
         source.printedDate, source.routePrintedDate, source.quantityPicked, source.qtyToTransfer,
         source.transferToLotNo, source.transferToLocation, source.modifiedAt, source.countDateTime,
         source.lastQuantityCounted, source.countDate, source.countPostingDate, source.countJournalTemplateName,
         source.countJournalBatchName, source.difference, source.ADCSUser, source.QuantityxRex,
         source.vendorItemNo, source.confirmedADCSUser, source.MovementADCSUser, source.confirmedDateTime,
         source.lotLedgerProcessed, source.whsePostedDocumentNo, source.lotUsed, source.weight,
         source.systemId, source.systemCreatedAt, source.systemCreatedBy, source.systemModifiedAt,
         source.systemModifiedBy, source.comment, source.expiredInventory, source.inventory,
         source.relatedLots, source.relatedPallet, source.binContentQty
     );
END;
';
CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_LSCTRANS_SALESENTRYSTATUS()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
    MERGE INTO fco.silver.factlsctrans_salesentrystatus AS target
    USING  FCO.STAGING.STGLSCTRANS_SALESENTRYSTATUS AS source
    ON target.CompanyName = source.CompanyName
    AND target.storeNo = source.storeNo
    AND target.posTerminalNo = source.posTerminalNo
    AND target.transactionNo = source.transactionNo
    AND target.lineNo = source.lineNo
    
    -- Update existing records
    WHEN MATCHED AND (
     target.SystemRowVersion <> source.SystemRowVersion
     OR IFNULL(target.status, '''') <> IFNULL(source.status, '''')
     OR IFNULL(target.statementNo, '''') <> IFNULL(source.statementNo, '''')
     OR IFNULL(target.itemNo, '''') <> IFNULL(source.itemNo, '''')
     OR IFNULL(target.variantCode, '''') <> IFNULL(source.variantCode, '''')
     OR IFNULL(target.quantity, 0) <> IFNULL(source.quantity, 0)
     OR IFNULL(target.date, '''') <> IFNULL(source.date, '''')
     OR IFNULL(target.serialNo, '''') <> IFNULL(source.serialNo, '''')
     OR IFNULL(target.lotNo, '''') <> IFNULL(source.lotNo, '''')
     OR IFNULL(target.replicationCounter, 0) <> IFNULL(source.replicationCounter, 0)
     OR IFNULL(target.systemId, ''00000000-0000-0000-0000-000000000000'') <> IFNULL(source.systemId, ''00000000-0000-0000-0000-000000000000'')
     OR IFNULL(target.systemCreatedAt, ''1900-01-01'') <> IFNULL(source.systemCreatedAt, ''1900-01-01'')
     OR IFNULL(target.systemCreatedBy, ''00000000-0000-0000-0000-000000000000'') <> IFNULL(source.systemCreatedBy, ''00000000-0000-0000-0000-000000000000'')
     OR IFNULL(target.systemModifiedAt, ''1900-01-01'') <> IFNULL(source.systemModifiedAt, ''1900-01-01'')
     OR IFNULL(target.systemModifiedBy, ''00000000-0000-0000-0000-000000000000'') <> IFNULL(source.systemModifiedBy, ''00000000-0000-0000-0000-000000000000'')
    ) THEN
     UPDATE SET
         target.SystemRowVersion = source.SystemRowVersion,
         target.status = source.status,
         target.statementNo = source.statementNo,
         target.itemNo = source.itemNo,
         target.variantCode = source.variantCode,
         target.quantity = source.quantity,
         target.date = source.date,
         target.serialNo = source.serialNo,
         target.lotNo = source.lotNo,
         target.replicationCounter = source.replicationCounter,
         target.systemId = source.systemId,
         target.systemCreatedAt = source.systemCreatedAt,
         target.systemCreatedBy = source.systemCreatedBy,
         target.systemModifiedAt = source.systemModifiedAt,
         target.systemModifiedBy = source.systemModifiedBy
    
    -- Insert new records
    WHEN NOT MATCHED THEN
     INSERT (
         CompanyName,
         SystemRowVersion,
         storeNo,
         posTerminalNo,
         transactionNo,
         lineNo,
         status,
         statementNo,
         itemNo,
         variantCode,
         quantity,
         date,
         serialNo,
         lotNo,
         replicationCounter,
         systemId,
         systemCreatedAt,
         systemCreatedBy,
         systemModifiedAt,
         systemModifiedBy
     )
     VALUES (
         source.CompanyName,
         source.SystemRowVersion,
         source.storeNo,
         source.posTerminalNo,
         source.transactionNo,
         source.lineNo,
         source.status,
         source.statementNo,
         source.itemNo,
         source.variantCode,
         source.quantity,
         source.date,
         source.serialNo,
         source.lotNo,
         source.replicationCounter,
         source.systemId,
         source.systemCreatedAt,
         source.systemCreatedBy,
         source.systemModifiedAt,
         source.systemModifiedBy
     );
END;
';
CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_PURCHASEHEADER()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
 MERGE INTO fco.silver.factPurchaseHeader AS target
 USING fco.staging.stgPurchaseHeader AS source
 ON target.companyName = source.companyName
 AND target.documentType = source.documentType
 AND target.no = source.no
 WHEN MATCHED AND source.SystemRowVersion > target.SystemRowVersion THEN
     UPDATE SET
         target.systemRowVersion = source.systemRowVersion,
         target.aRcdNotInvExVATLCY = source.aRcdNotInvExVATLCY,
         target.amount = source.amount,
         target.amountIncludingVAT = source.amountIncludingVAT,
         target.amtRcdNotInvoicedLCY = source.amtRcdNotInvoicedLCY,
         target.appliesToDocNo = source.appliesToDocNo,
         target.appliesToDocType = source.appliesToDocType,
         target.appliesToID = source.appliesToID,
         target.area = source.area,
         target.assignedUserID = source.assignedUserID,
         target.autoApplyBTR = source.autoApplyBTR,
         target.balAccountNo = source.balAccountNo,
         target.balAccountType = source.balAccountType,
         target.brandActionRequired = source.brandActionRequired,
         target.buyFromAddress = source.buyFromAddress,
         target.buyFromAddress2 = source.buyFromAddress2,
         target.buyFromCity = source.buyFromCity,
         target.buyFromContact = source.buyFromContact,
         target.buyFromContactNo = source.buyFromContactNo,
         target.buyFromCountryRegionCode = source.buyFromCountryRegionCode,
         target.buyFromCounty = source.buyFromCounty,
         target.buyFromICPartnerCode = source.buyFromICPartnerCode,
         target.buyFromPostCode = source.buyFromPostCode,
         target.buyFromVendorName = source.buyFromVendorName,
         target.buyFromVendorName2 = source.buyFromVendorName2,
         target.buyFromVendorNo = source.buyFromVendorNo,
         target.campaignNo = source.campaignNo,
         target.cargoReadyDateBTR = source.cargoReadyDateBTR,
         target.comment = source.comment,
         target.completelyReceived = source.completelyReceived,
         target.compressPrepayment = source.compressPrepayment,
         target.correction = source.correction,
         target.creditorNo = source.creditorNo,
         target.currFactorfromShipCostBTR = source.currFactorfromShipCostBTR,
         target.currencyCode = source.currencyCode,
         target.currencyFactor = source.currencyFactor,
         target.dimensionSetID = source.dimensionSetID,
         target.docNoOccurrence = source.docNoOccurrence,
         target.documentDate = source.documentDate,
         target.documentPostedDateBTR = source.documentPostedDateBTR,
         target.dueDate = source.dueDate,
         target.entryPoint = source.entryPoint,
         target.expectedReceiptDate = source.expectedReceiptDate,
         target.expectedShippingDateBTR = source.expectedShippingDateBTR,
         target.formatRegion = source.formatRegion,
         target.genBusPostingGroup = source.genBusPostingGroup,
         target.icDirection = source.icDirection,
         target.icReferenceDocumentNo = source.icReferenceDocumentNo,
         target.icStatus = source.icStatus,
         target.incoTermBTR = source.incoTermBTR,
         target.inboundWhseHandlingTime = source.inboundWhseHandlingTime,
         target.incomingDocumentEntryNo = source.incomingDocumentEntryNo,
         target.invoice = source.invoice,
         target.invoiceDiscCode = source.invoiceDiscCode,
         target.invoiceDiscountAmount = source.invoiceDiscountAmount,
         target.invoiceDiscountCalculation = source.invoiceDiscountCalculation,
         target.invoiceDiscountValue = source.invoiceDiscountValue,
         target.invoiceReceivedDate = source.invoiceReceivedDate,
         target.jobQueueEntryID = source.jobQueueEntryID,
         target.jobQueueStatus = source.jobQueueStatus,
         target.journalTemplName = source.journalTemplName,
         target.lscAssessableValue = source.lscAssessableValue,
         target.lscBuyerGroupCode = source.lscBuyerGroupCode,
         target.lscBuyerID = source.lscBuyerID,
         target.lscCreatedBySourceCode = source.lscCreatedBySourceCode,
         target.lscCustomerOrderID = source.lscCustomerOrderID,
         target.lscCustomsRefNo = source.lscCustomsRefNo,
         target.lscEnableForRelCalendar = source.lscEnableForRelCalendar,
         target.lscFranchiseSingleShip = source.lscFranchiseSingleShip,
         target.lscFranchiseProcessStatus = source.lscFranchiseProcessStatus,
         target.lscGeneralComments = source.lscGeneralComments,
         target.lscItemRegistrationNo = source.lscItemRegistrationNo,
         target.lscLastOpenToBuyChecked = source.lscLastOpenToBuyChecked,
         target.lscLastOpenToBuyChkStat = source.lscLastOpenToBuyChkStat,
         target.lscNarration = source.lscNarration,
         target.lscOpenToBuyDate = source.lscOpenToBuyDate,
         target.lscRTCFilterField = source.lscRTCFilterField,
         target.lscRecivingPickingNo = source.lscRecivingPickingNo,
         target.lscRetailPurchDestFilter = source.lscRetailPurchDestFilter,
         target.lscRetailPurchSrcFilter = source.lscRetailPurchSrcFilter,
         target.lscRetailStatus = source.lscRetailStatus,
         target.lscStoreNo = source.lscStoreNo,
         target.lscValidateTrackingCode = source.lscValidateTrackingCode,
         target.lscVendorTrustLevel = source.lscVendorTrustLevel,
         target.lscVersionNo = source.lscVersionNo,
         target.lscWorksheetSeqNumber = source.lscWorksheetSeqNumber,
         target.languageCode = source.languageCode,
         target.lastPostingNo = source.lastPostingNo,
         target.lastPrepaymentNo = source.lastPrepaymentNo,
         target.lastPrepmtCrMemoNo = source.lastPrepmtCrMemoNo,
         target.lastReceivingNo = source.lastReceivingNo,
         target.lastReturnShipmentNo = source.lastReturnShipmentNo,
         target.leadTimeCalculation = source.leadTimeCalculation,
         target.locationCode = source.locationCode,
         target.modeOfTransportBTR = source.modeOfTransportBTR,
         target.noPrinted = source.noPrinted,
         target.noSeries = source.noSeries,
         target.noOfArchivedVersions = source.noOfArchivedVersions,
         target.onHold = source.onHold,
         target.orderAddressCode = source.orderAddressCode,
         target.orderClass = source.orderClass,
         target.orderDate = source.orderDate,
         target.originCountryBTR = source.originCountryBTR,
         target.originalQuantityBTR = source.originalQuantityBTR,
         target.outstandingQuantityBTR = source.outstandingQuantityBTR,
         target.overReceiptQuantityBTR = source.overReceiptQuantityBTR,
         target.poDescriptionBTR = source.poDescriptionBTR,
         target.partiallyInvoiced = source.partiallyInvoiced,
         target.payToAddress = source.payToAddress,
         target.payToAddress2 = source.payToAddress2,
         target.payToCity = source.payToCity,
         target.payToContact = source.payToContact,
         target.payToContactNo = source.payToContactNo,
         target.payToCountryRegionCode = source.payToCountryRegionCode,
         target.payToCounty = source.payToCounty,
         target.payToICPartnerCode = source.payToICPartnerCode,
         target.payToName = source.payToName,
         target.payToName2 = source.payToName2,
         target.payToPostCode = source.payToPostCode,
         target.payToVendorNo = source.payToVendorNo,
         target.paymentDiscount = source.paymentDiscount,
         target.paymentMethodCode = source.paymentMethodCode,
         target.paymentReference = source.paymentReference,
         target.paymentTermsCode = source.paymentTermsCode,
         target.pendingApprovals = source.pendingApprovals,
         target.pmtDiscountDate = source.pmtDiscountDate,
         target.portOfLoadingBTR = source.portOfLoadingBTR,
         target.postingDate = source.postingDate,
         target.postingDescription = source.postingDescription,
         target.postingNo = source.postingNo,
         target.postingNoSeries = source.postingNoSeries,
         target.postingFromWhseRef = source.postingFromWhseRef,
         target.prepayment = source.prepayment,
         target.prepaymentDueDate = source.prepaymentDueDate,
         target.prepaymentNo = source.prepaymentNo,
         target.prepaymentNoSeries = source.prepaymentNoSeries,
         target.prepmtCrMemoNo = source.prepmtCrMemoNo,
         target.prepmtCrMemoNoSeries = source.prepmtCrMemoNoSeries,
         target.prepmtPaymentDiscount = source.prepmtPaymentDiscount,
         target.prepmtPaymentTermsCode = source.prepmtPaymentTermsCode,
         target.prepmtPmtDiscountDate = source.prepmtPmtDiscountDate,
         target.prepmtPostingDescription = source.prepmtPostingDescription,
         target.priceCalculationMethod = source.priceCalculationMethod,
         target.pricesIncludingVAT = source.pricesIncludingVAT,
         target.printPostedDocuments = source.printPostedDocuments,
         target.promisedReceiptDate = source.promisedReceiptDate,
         target.purchaserCode = source.purchaserCode,
         target.qualityControlRequired = source.qualityControlRequired,
         target.quantityBTR = source.quantityBTR,
         target.quantityDifferenceBTR = source.quantityDifferenceBTR,
         target.quantityInvoicedBTR = source.quantityInvoicedBTR,
         target.quantityReceivedBTR = source.quantityReceivedBTR,
         target.quoteNo = source.quoteNo,
         target.reasonCode = source.reasonCode,
         target.recalculateInvoiceDisc = source.recalculateInvoiceDisc,
         target.receive = source.receive,
         target.receivedNotInvoiced = source.receivedNotInvoiced,
         target.receivingNo = source.receivingNo,
         target.receivingNoSeries = source.receivingNoSeries,
         target.releaseDateBTR = source.releaseDateBTR,
         target.remitToCode = source.remitToCode,
         target.requestedReceiptDate = source.requestedReceiptDate,
         target.requiredInStoreDateBTR = source.requiredInStoreDateBTR,
         target.responsibilityCenter = source.responsibilityCenter,
         target.returnShipmentNo = source.returnShipmentNo,
         target.returnShipmentNoSeries = source.returnShipmentNoSeries,
         target.sellToCustomerNo = source.sellToCustomerNo,
         target.sendICDocument = source.sendICDocument,
         target.ship = source.ship,
         target.shipToAddress = source.shipToAddress,
         target.shipToAddress2 = source.shipToAddress2,
         target.shipToCity = source.shipToCity,
         target.shipToCode = source.shipToCode,
         target.shipToContact = source.shipToContact,
         target.shipToCountryRegionCode = source.shipToCountryRegionCode,
         target.shipToCounty = source.shipToCounty,
         target.shipToName = source.shipToName,
         target.shipToName2 = source.shipToName2,
         target.shipToPhoneNo = source.shipToPhoneNo,
         target.shipToPostCode = source.shipToPostCode,
         target.shipmentMethodCode = source.shipmentMethodCode,
         target.shipmentNoBTR = source.shipmentNoBTR,
         target.shortcutDimension1Code = source.shortcutDimension1Code,
         target.shortcutDimension2Code = source.shortcutDimension2Code,
         target.sourceCreatedByUserBTR = source.sourceCreatedByUserBTR,
         target.sourceLastModifiedUserBTR = source.sourceLastModifiedUserBTR,
         target.status = source.status,
         target.systemCreatedAt = source.systemCreatedAt,
         target.systemCreatedBy = source.systemCreatedBy,
         target.systemId = source.systemId,
         target.systemModifiedAt = source.systemModifiedAt,
         target.systemModifiedBy = source.systemModifiedBy,
         target.taxAreaCode = source.taxAreaCode,
         target.taxLiable = source.taxLiable,
         target.totalCbmBTR = source.totalCbmBTR,
         target.totalKgBTR = source.totalKgBTR,
         target.totalNoOfCTNBTR = source.totalNoOfCTNBTR,
         target.transactionSpecification = source.transactionSpecification,
         target.transactionType = source.transactionType,
         target.transportMethod = source.transportMethod,
         target.vatBaseDiscount = source.vatBaseDiscount,
         target.vatBusPostingGroup = source.vatBusPostingGroup,
         target.vatCountryRegionCode = source.vatCountryRegionCode,
         target.vatRegistrationNo = source.vatRegistrationNo,
         target.vatReportingDate = source.vatReportingDate,
         target.vendorAuthorizationNo = source.vendorAuthorizationNo,
         target.vendorCrMemoNo = source.vendorCrMemoNo,
         target.vendorInvoiceNo = source.vendorInvoiceNo,
         target.vendorOrderNo = source.vendorOrderNo,
         target.vendorPostingGroup = source.vendorPostingGroup,
         target.vendorShipmentNo = source.vendorShipmentNo,
         target.whseActivityNoBTR = source.whseActivityNoBTR,
         target.whseReceiptDateBTR = source.whseReceiptDateBTR,
         target.whseShipmentDateBTR = source.whseShipmentDateBTR,
         target.yourReference = source.yourReference
 WHEN NOT MATCHED   THEN
     INSERT (
         companyName, systemRowVersion, documentType, no, aRcdNotInvExVATLCY, amount, amountIncludingVAT, 
         amtRcdNotInvoicedLCY, appliesToDocNo, appliesToDocType, appliesToID, area, assignedUserID, 
         autoApplyBTR, balAccountNo, balAccountType, brandActionRequired, buyFromAddress, buyFromAddress2, 
         buyFromCity, buyFromContact, buyFromContactNo, buyFromCountryRegionCode, buyFromCounty, 
         buyFromICPartnerCode, buyFromPostCode, buyFromVendorName, buyFromVendorName2, buyFromVendorNo, 
         campaignNo, cargoReadyDateBTR, comment, completelyReceived, compressPrepayment, correction, 
         creditorNo, currFactorfromShipCostBTR, currencyCode, currencyFactor, dimensionSetID, 
         docNoOccurrence, documentDate, documentPostedDateBTR, dueDate, entryPoint, expectedReceiptDate, 
         expectedShippingDateBTR, formatRegion, genBusPostingGroup, icDirection, icReferenceDocumentNo, 
         icStatus, incoTermBTR, inboundWhseHandlingTime, incomingDocumentEntryNo, invoice, invoiceDiscCode, 
         invoiceDiscountAmount, invoiceDiscountCalculation, invoiceDiscountValue, invoiceReceivedDate, 
         jobQueueEntryID, jobQueueStatus, journalTemplName, lscAssessableValue, lscBuyerGroupCode, 
         lscBuyerID, lscCreatedBySourceCode, lscCustomerOrderID, lscCustomsRefNo, lscEnableForRelCalendar, 
         lscFranchiseSingleShip, lscFranchiseProcessStatus, lscGeneralComments, lscItemRegistrationNo, 
         lscLastOpenToBuyChecked, lscLastOpenToBuyChkStat, lscNarration, lscOpenToBuyDate, 
         lscRTCFilterField, lscRecivingPickingNo, lscRetailPurchDestFilter, lscRetailPurchSrcFilter, 
         lscRetailStatus, lscStoreNo, lscValidateTrackingCode, lscVendorTrustLevel, lscVersionNo, 
         lscWorksheetSeqNumber, languageCode, lastPostingNo, lastPrepaymentNo, lastPrepmtCrMemoNo, 
         lastReceivingNo, lastReturnShipmentNo, leadTimeCalculation, locationCode, modeOfTransportBTR, 
         noPrinted, noSeries, noOfArchivedVersions, onHold, orderAddressCode, orderClass, orderDate, 
         originCountryBTR, originalQuantityBTR, outstandingQuantityBTR, overReceiptQuantityBTR, 
         poDescriptionBTR, partiallyInvoiced, payToAddress, payToAddress2, payToCity, payToContact, 
         payToContactNo, payToCountryRegionCode, payToCounty, payToICPartnerCode, payToName, payToName2, 
         payToPostCode, payToVendorNo, paymentDiscount, paymentMethodCode, paymentReference, 
         paymentTermsCode, pendingApprovals, pmtDiscountDate, portOfLoadingBTR, postingDate, 
         postingDescription, postingNo, postingNoSeries, postingFromWhseRef, prepayment, 
         prepaymentDueDate, prepaymentNo, prepaymentNoSeries, prepmtCrMemoNo, prepmtCrMemoNoSeries, 
         prepmtPaymentDiscount, prepmtPaymentTermsCode, prepmtPmtDiscountDate, prepmtPostingDescription, 
         priceCalculationMethod, pricesIncludingVAT, printPostedDocuments, promisedReceiptDate, 
         purchaserCode, qualityControlRequired, quantityBTR, quantityDifferenceBTR, quantityInvoicedBTR, 
         quantityReceivedBTR, quoteNo, reasonCode, recalculateInvoiceDisc, receive, receivedNotInvoiced, 
         receivingNo, receivingNoSeries, releaseDateBTR, remitToCode, requestedReceiptDate, 
         requiredInStoreDateBTR, responsibilityCenter, returnShipmentNo, returnShipmentNoSeries, 
         sellToCustomerNo, sendICDocument, ship, shipToAddress, shipToAddress2, shipToCity, shipToCode, 
         shipToContact, shipToCountryRegionCode, shipToCounty, shipToName, shipToName2, shipToPhoneNo, 
         shipToPostCode, shipmentMethodCode, shipmentNoBTR, shortcutDimension1Code, shortcutDimension2Code, 
         sourceCreatedByUserBTR, sourceLastModifiedUserBTR, status, systemCreatedAt, systemCreatedBy, 
         systemId, systemModifiedAt, systemModifiedBy, taxAreaCode, taxLiable, totalCbmBTR, totalKgBTR, 
         totalNoOfCTNBTR, transactionSpecification, transactionType, transportMethod, vatBaseDiscount, 
         vatBusPostingGroup, vatCountryRegionCode, vatRegistrationNo, vatReportingDate, 
         vendorAuthorizationNo, vendorCrMemoNo, vendorInvoiceNo, vendorOrderNo, vendorPostingGroup, 
         vendorShipmentNo, whseActivityNoBTR, whseReceiptDateBTR, whseShipmentDateBTR, yourReference
     )
     VALUES (
         source.companyName, source.systemRowVersion, source.documentType, source.no, 
         source.aRcdNotInvExVATLCY, source.amount, source.amountIncludingVAT, 
         source.amtRcdNotInvoicedLCY, source.appliesToDocNo, source.appliesToDocType, 
         source.appliesToID, source.area, source.assignedUserID, source.autoApplyBTR, 
         source.balAccountNo, source.balAccountType, source.brandActionRequired, 
         source.buyFromAddress, source.buyFromAddress2, source.buyFromCity, 
         source.buyFromContact, source.buyFromContactNo, source.buyFromCountryRegionCode, 
         source.buyFromCounty, source.buyFromICPartnerCode, source.buyFromPostCode, 
         source.buyFromVendorName, source.buyFromVendorName2, source.buyFromVendorNo, 
         source.campaignNo, source.cargoReadyDateBTR, source.comment, 
         source.completelyReceived, source.compressPrepayment, source.correction, 
         source.creditorNo, source.currFactorfromShipCostBTR, source.currencyCode, 
         source.currencyFactor, source.dimensionSetID, source.docNoOccurrence, 
         source.documentDate, source.documentPostedDateBTR, source.dueDate, 
         source.entryPoint, source.expectedReceiptDate, source.expectedShippingDateBTR, 
         source.formatRegion, source.genBusPostingGroup, source.icDirection, 
         source.icReferenceDocumentNo, source.icStatus, source.incoTermBTR, 
         source.inboundWhseHandlingTime, source.incomingDocumentEntryNo, source.invoice, 
         source.invoiceDiscCode, source.invoiceDiscountAmount, 
         source.invoiceDiscountCalculation, source.invoiceDiscountValue, 
         source.invoiceReceivedDate, source.jobQueueEntryID, source.jobQueueStatus, 
         source.journalTemplName, source.lscAssessableValue, source.lscBuyerGroupCode, 
         source.lscBuyerID, source.lscCreatedBySourceCode, source.lscCustomerOrderID, 
         source.lscCustomsRefNo, source.lscEnableForRelCalendar, 
         source.lscFranchiseSingleShip, source.lscFranchiseProcessStatus, 
         source.lscGeneralComments, source.lscItemRegistrationNo, 
         source.lscLastOpenToBuyChecked, source.lscLastOpenToBuyChkStat, 
         source.lscNarration, source.lscOpenToBuyDate, source.lscRTCFilterField, 
         source.lscRecivingPickingNo, source.lscRetailPurchDestFilter, 
         source.lscRetailPurchSrcFilter, source.lscRetailStatus, source.lscStoreNo, 
         source.lscValidateTrackingCode, source.lscVendorTrustLevel, 
         source.lscVersionNo, source.lscWorksheetSeqNumber, source.languageCode, 
         source.lastPostingNo, source.lastPrepaymentNo, source.lastPrepmtCrMemoNo, 
         source.lastReceivingNo, source.lastReturnShipmentNo, 
         source.leadTimeCalculation, source.locationCode, source.modeOfTransportBTR, 
         source.noPrinted, source.noSeries, source.noOfArchivedVersions, 
         source.onHold, source.orderAddressCode, source.orderClass, source.orderDate, 
         source.originCountryBTR, source.originalQuantityBTR, 
         source.outstandingQuantityBTR, source.overReceiptQuantityBTR, 
         source.poDescriptionBTR, source.partiallyInvoiced, source.payToAddress, 
         source.payToAddress2, source.payToCity, source.payToContact, 
         source.payToContactNo, source.payToCountryRegionCode, source.payToCounty, 
         source.payToICPartnerCode, source.payToName, source.payToName2, 
         source.payToPostCode, source.payToVendorNo, source.paymentDiscount, 
         source.paymentMethodCode, source.paymentReference, source.paymentTermsCode, 
         source.pendingApprovals, source.pmtDiscountDate, source.portOfLoadingBTR, 
         source.postingDate, source.postingDescription, source.postingNo, 
         source.postingNoSeries, source.postingFromWhseRef, source.prepayment, 
         source.prepaymentDueDate, source.prepaymentNo, source.prepaymentNoSeries, 
         source.prepmtCrMemoNo, source.prepmtCrMemoNoSeries, 
         source.prepmtPaymentDiscount, source.prepmtPaymentTermsCode, 
         source.prepmtPmtDiscountDate, source.prepmtPostingDescription, 
         source.priceCalculationMethod, source.pricesIncludingVAT, 
         source.printPostedDocuments, source.promisedReceiptDate, 
         source.purchaserCode, source.qualityControlRequired, source.quantityBTR, 
         source.quantityDifferenceBTR, source.quantityInvoicedBTR, 
         source.quantityReceivedBTR, source.quoteNo, source.reasonCode, 
         source.recalculateInvoiceDisc, source.receive, source.receivedNotInvoiced, 
         source.receivingNo, source.receivingNoSeries, source.releaseDateBTR, 
         source.remitToCode, source.requestedReceiptDate, 
         source.requiredInStoreDateBTR, source.responsibilityCenter, 
         source.returnShipmentNo, source.returnShipmentNoSeries, 
         source.sellToCustomerNo, source.sendICDocument, source.ship, 
         source.shipToAddress, source.shipToAddress2, source.shipToCity, 
         source.shipToCode, source.shipToContact, source.shipToCountryRegionCode, 
         source.shipToCounty, source.shipToName, source.shipToName2, 
         source.shipToPhoneNo, source.shipToPostCode, source.shipmentMethodCode, 
         source.shipmentNoBTR, source.shortcutDimension1Code, 
         source.shortcutDimension2Code, source.sourceCreatedByUserBTR, 
         source.sourceLastModifiedUserBTR, source.status, source.systemCreatedAt, 
         source.systemCreatedBy, source.systemId, source.systemModifiedAt, 
         source.systemModifiedBy, source.taxAreaCode, source.taxLiable, 
         source.totalCbmBTR, source.totalKgBTR, source.totalNoOfCTNBTR, 
         source.transactionSpecification, source.transactionType, 
         source.transportMethod, source.vatBaseDiscount, source.vatBusPostingGroup, 
         source.vatCountryRegionCode, source.vatRegistrationNo, 
         source.vatReportingDate, source.vendorAuthorizationNo, 
         source.vendorCrMemoNo, source.vendorInvoiceNo, source.vendorOrderNo, 
         source.vendorPostingGroup, source.vendorShipmentNo, 
         source.whseActivityNoBTR, source.whseReceiptDateBTR, 
         source.whseShipmentDateBTR, source.yourReference
     );
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_PURCHASELINES()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
MERGE INTO fco.silver.factPurchaseLine AS target
USING fco.staging.stgPurchaseLine AS source
ON target.CompanyName = source.CompanyName
   AND target.documentType = source.documentType
   AND target.documentNo = source.documentNo
   AND target.lineNo = source.lineNo
WHEN MATCHED AND  source.SystemRowVersion > target.SystemRowVersion THEN
    UPDATE SET
        target.SystemRowVersion = source.SystemRowVersion,
        target.buyFromVendorNo = source.buyFromVendorNo,
        target.type = source.type,
        target.no = source.no,
        target.locationCode = source.locationCode,
        target.postingGroup = source.postingGroup,
        target.expectedReceiptDate = source.expectedReceiptDate,
        target.description = source.description,
        target.description2 = source.description2,
        target.unitOfMeasure = source.unitOfMeasure,
        target.quantity = source.quantity,
        target.outstandingQuantity = source.outstandingQuantity,
        target.qtyToInvoice = source.qtyToInvoice,
        target.qtyToReceive = source.qtyToReceive,
        target.directUnitCost = source.directUnitCost,
        target.unitCostLCY = source.unitCostLCY,
        target.vat = source.vat,
        target.lineDiscount = source.lineDiscount,
        target.lineDiscountAmount = source.lineDiscountAmount,
        target.amount = source.amount,
        target.amountIncludingVAT = source.amountIncludingVAT,
        target.unitPriceLCY = source.unitPriceLCY,
        target.allowInvoiceDisc = source.allowInvoiceDisc,
        target.grossWeight = source.grossWeight,
        target.netWeight = source.netWeight,
        target.unitsPerParcel = source.unitsPerParcel,
        target.unitVolume = source.unitVolume,
        target.applToItemEntry = source.applToItemEntry,
        target.shortcutDimension1Code = source.shortcutDimension1Code,
        target.shortcutDimension2Code = source.shortcutDimension2Code,
        target.jobNo = source.jobNo,
        target.indirectCost = source.indirectCost,
        target.recalculateInvoiceDisc = source.recalculateInvoiceDisc,
        target.outstandingAmount = source.outstandingAmount,
        target.qtyRcdNotInvoiced = source.qtyRcdNotInvoiced,
        target.amtRcdNotInvoiced = source.amtRcdNotInvoiced,
        target.quantityReceived = source.quantityReceived,
        target.quantityInvoiced = source.quantityInvoiced,
        target.receiptNo = source.receiptNo,
        target.receiptLineNo = source.receiptLineNo,
        target.orderNo = source.orderNo,
        target.orderLineNo = source.orderLineNo,
        target.profit = source.profit,
        target.payToVendorNo = source.payToVendorNo,
        target.invDiscountAmount = source.invDiscountAmount,
        target.vendorItemNo = source.vendorItemNo,
        target.salesOrderNo = source.salesOrderNo,
        target.salesOrderLineNo = source.salesOrderLineNo,
        target.dropShipment = source.dropShipment,
        target.genBusPostingGroup = source.genBusPostingGroup,
        target.genProdPostingGroup = source.genProdPostingGroup,
        target.vatCalculationType = source.vatCalculationType,
        target.transactionType = source.transactionType,
        target.transportMethod = source.transportMethod,
        target.attachedToLineNo = source.attachedToLineNo,
        target.entryPoint = source.entryPoint,
        target.area = source.area,
        target.transactionSpecification = source.transactionSpecification,
        target.taxAreaCode = source.taxAreaCode,
        target.taxLiable = source.taxLiable,
        target.taxGroupCode = source.taxGroupCode,
        target.useTax = source.useTax,
        target.vatBusPostingGroup = source.vatBusPostingGroup,
        target.vatProdPostingGroup = source.vatProdPostingGroup,
        target.currencyCode = source.currencyCode,
        target.outstandingAmountLCY = source.outstandingAmountLCY,
        target.amtRcdNotInvoicedLCY = source.amtRcdNotInvoicedLCY,
        target.blanketOrderNo = source.blanketOrderNo,
        target.blanketOrderLineNo = source.blanketOrderLineNo,
        target.vatBaseAmount = source.vatBaseAmount,
        target.unitCost = source.unitCost,
        target.systemCreatedEntry = source.systemCreatedEntry,
        target.lineAmount = source.lineAmount,
        target.vatDifference = source.vatDifference,
        target.invDiscAmountToInvoice = source.invDiscAmountToInvoice,
        target.vatIdentifier = source.vatIdentifier,
        target.icPartnerRefType = source.icPartnerRefType,
        target.icPartnerReference = source.icPartnerReference,
        target.prepayment = source.prepayment,
        target.prepmtLineAmount = source.prepmtLineAmount,
        target.prepmtAmtInv = source.prepmtAmtInv,
        target.prepmtAmtInclVAT = source.prepmtAmtInclVAT,
        target.prepaymentAmount = source.prepaymentAmount,
        target.prepmtVATBaseAmt = source.prepmtVATBaseAmt,
        target.prepaymentVAT = source.prepaymentVAT,
        target.prepmtVATCalcType = source.prepmtVATCalcType,
        target.prepaymentVATIdentifier = source.prepaymentVATIdentifier,
        target.prepaymentTaxAreaCode = source.prepaymentTaxAreaCode,
        target.prepaymentTaxLiable = source.prepaymentTaxLiable,
        target.prepaymentTaxGroupCode = source.prepaymentTaxGroupCode,
        target.prepmtAmtToDeduct = source.prepmtAmtToDeduct,
        target.prepmtAmtDeducted = source.prepmtAmtDeducted,
        target.prepaymentLine = source.prepaymentLine,
        target.prepmtAmountInvInclVAT = source.prepmtAmountInvInclVAT,
        target.prepmtAmountInvLCY = source.prepmtAmountInvLCY,
        target.icPartnerCode = source.icPartnerCode,
        target.prepmtVATAmountInvLCY = source.prepmtVATAmountInvLCY,
        target.prepaymentVATDifference = source.prepaymentVATDifference,
        target.prepmtVATDiffToDeduct = source.prepmtVATDiffToDeduct,
        target.prepmtVATDiffDeducted = source.prepmtVATDiffDeducted,
        target.icItemReferenceNo = source.icItemReferenceNo,
        target.outstandingAmtExVATLCY = source.outstandingAmtExVATLCY,
        target.aRcdNotInvExVATLCY = source.aRcdNotInvExVATLCY,
        target.pmtDiscountAmount = source.pmtDiscountAmount,
        target.prepmtPmtDiscountAmount = source.prepmtPmtDiscountAmount,
        target.dimensionSetID = source.dimensionSetID,
        target.jobTaskNo = source.jobTaskNo,
        target.jobLineType = source.jobLineType,
        target.jobUnitPrice = source.jobUnitPrice,
        target.jobTotalPrice = source.jobTotalPrice,
        target.jobLineAmount = source.jobLineAmount,
        target.jobLineDiscountAmount = source.jobLineDiscountAmount,
        target.jobLineDiscount = source.jobLineDiscount,
        target.jobUnitPriceLCY = source.jobUnitPriceLCY,
        target.jobTotalPriceLCY = source.jobTotalPriceLCY,
        target.jobLineAmountLCY = source.jobLineAmountLCY,
        target.jobLineDiscAmountLCY = source.jobLineDiscAmountLCY,
        target.jobCurrencyFactor = source.jobCurrencyFactor,
        target.jobCurrencyCode = source.jobCurrencyCode,
        target.jobPlanningLineNo = source.jobPlanningLineNo,
        target.jobRemainingQty = source.jobRemainingQty,
        target.jobRemainingQtyBase = source.jobRemainingQtyBase,
        target.deferralCode = source.deferralCode,
        target.returnsDeferralStartDate = source.returnsDeferralStartDate,
        target.selectedAllocAccountNo = source.selectedAllocAccountNo,
        target.allocationAccountNo = source.allocationAccountNo,
        target.prodOrderNo = source.prodOrderNo,
        target.variantCode = source.variantCode,
        target.binCode = source.binCode,
        target.qtyPerUnitOfMeasure = source.qtyPerUnitOfMeasure,
        target.qtyRoundingPrecision = source.qtyRoundingPrecision,
        target.qtyRoundingPrecisionBase = source.qtyRoundingPrecisionBase,
        target.unitOfMeasureCode = source.unitOfMeasureCode,
        target.quantityBase = source.quantityBase,
        target.outstandingQtyBase = source.outstandingQtyBase,
        target.qtyToInvoiceBase = source.qtyToInvoiceBase,
        target.qtyToReceiveBase = source.qtyToReceiveBase,
        target.qtyRcdNotInvoicedBase = source.qtyRcdNotInvoicedBase,
        target.qtyReceivedBase = source.qtyReceivedBase,
        target.qtyInvoicedBase = source.qtyInvoicedBase,
        target.faPostingDate = source.faPostingDate,
        target.faPostingType = source.faPostingType,
        target.depreciationBookCode = source.depreciationBookCode,
        target.salvageValue = source.salvageValue,
        target.deprUntilFAPostingDate = source.deprUntilFAPostingDate,
        target.deprAcquisitionCost = source.deprAcquisitionCost,
        target.maintenanceCode = source.maintenanceCode,
        target.insuranceNo = source.insuranceNo,
        target.budgetedFANo = source.budgetedFANo,
        target.duplicateInDepreciationBook = source.duplicateInDepreciationBook,
        target.useDuplicationList = source.useDuplicationList,
        target.responsibilityCenter = source.responsibilityCenter,
        target.itemReferenceNo = source.itemReferenceNo,
        target.itemReferenceUnitOfMeasure = source.itemReferenceUnitOfMeasure,
        target.itemReferenceType = source.itemReferenceType,
        target.itemReferenceTypeNo = source.itemReferenceTypeNo,
        target.itemCategoryCode = source.itemCategoryCode,
        target.nonstock = source.nonstock,
        target.purchasingCode = source.purchasingCode,
        target.ProductGroupCode = source.ProductGroupCode,
        target.specialOrder = source.specialOrder,
        target.specialOrderSalesNo = source.specialOrderSalesNo,
        target.specialOrderSalesLineNo = source.specialOrderSalesLineNo,
        target.itemReferenceNo_2 = source.itemReferenceNo_2,
        target.itemReferenceUnitOfMeasure_2 = source.itemReferenceUnitOfMeasure_2,
        target.itemReferenceType_2 = source.itemReferenceType_2,
        target.itemReferenceTypeNo_2 = source.itemReferenceTypeNo_2,
        target.completelyReceived = source.completelyReceived,
        target.requestedReceiptDate = source.requestedReceiptDate,
        target.promisedReceiptDate = source.promisedReceiptDate,
        target.leadTimeCalculation = source.leadTimeCalculation,
        target.inboundWhseHandlingTime = source.inboundWhseHandlingTime,
        target.plannedReceiptDate = source.plannedReceiptDate,
        target.orderDate = source.orderDate,
        target.allowItemChargeAssignment = source.allowItemChargeAssignment,
        target.returnQtyToShip = source.returnQtyToShip,
        target.returnQtyToShipBase = source.returnQtyToShipBase,
        target.returnQtyShippedNotInvd = source.returnQtyShippedNotInvd,
        target.retQtyShpdNotInvdBase = source.retQtyShpdNotInvdBase,
        target.returnShpdNotInvd = source.returnShpdNotInvd,
        target.returnShpdNotInvdLCY = source.returnShpdNotInvdLCY,
        target.returnQtyShipped = source.returnQtyShipped,
        target.returnQtyShippedBase = source.returnQtyShippedBase,
        target.nonDeductibleVAT = source.nonDeductibleVAT,
        target.nonDeductibleVATBase = source.nonDeductibleVATBase,
        target.nonDeductibleVATAmount = source.nonDeductibleVATAmount,
        target.nonDeductibleVATDiff = source.nonDeductibleVATDiff,
        target.prepmtNonDeductVATBase = source.prepmtNonDeductVATBase,
        target.prepmtNonDeductVATAmount = source.prepmtNonDeductVATAmount,
        target.returnShipmentNo = source.returnShipmentNo,
        target.returnShipmentLineNo = source.returnShipmentLineNo,
        target.returnReasonCode = source.returnReasonCode,
        target.subtype = source.subtype,
        target.copiedFromPostedDoc = source.copiedFromPostedDoc,
        target.priceCalculationMethod = source.priceCalculationMethod,
        target.overReceiptQuantity = source.overReceiptQuantity,
        target.overReceiptCode = source.overReceiptCode,
        target.overReceiptApprovalStatus = source.overReceiptApprovalStatus,
        target.routingNo = source.routingNo,
        target.operationNo = source.operationNo,
        target.workCenterNo = source.workCenterNo,
        target.finished = source.finished,
        target.prodOrderLineNo = source.prodOrderLineNo,
        target.overheadRate = source.overheadRate,
        target.mpsOrder = source.mpsOrder,
        target.planningFlexibility = source.planningFlexibility,
        target.safetyLeadTime = source.safetyLeadTime,
        target.routingReferenceNo = source.routingReferenceNo,
        target.systemId = source.systemId,
        target.systemCreatedAt = source.systemCreatedAt,
        target.systemCreatedBy = source.systemCreatedBy,
        target.systemModifiedAt = source.systemModifiedAt,
        target.systemModifiedBy = source.systemModifiedBy,
        target.attachedDocCount = source.attachedDocCount,
        target.attachedLinesCount = source.attachedLinesCount,
        target.colourBTR = source.colourBTR,
        target.itemChargeQtyToHandle = source.itemChargeQtyToHandle,
        target.lscCollectionItemNo = source.lscCollectionItemNo,
        target.lscCollectionLineNo = source.lscCollectionLineNo,
        target.lscCrossDocDifference = source.lscCrossDocDifference,
        target.lscDivision = source.lscDivision,
        target.lscFranchiseProcess = source.lscFranchiseProcess,
        target.lscOriginalQuantity = source.lscOriginalQuantity,
        target.lscOriginalQuantityBase = source.lscOriginalQuantityBase,
        target.lscQuantityDifference = source.lscQuantityDifference,
        target.lscRetailProductCode = source.lscRetailProductCode,
        target.qtyAssigned = source.qtyAssigned,
        target.qtyToAssign = source.qtyToAssign,
        target.reservedQtyBase = source.reservedQtyBase,
        target.reservedQuantity = source.reservedQuantity,
        target.shipmentNoBTR = source.shipmentNoBTR,
        target.sourceLastModifiedUserBTR = source.sourceLastModifiedUserBTR,
        target.statusBTR = source.statusBTR,
        target.whseOutstandingQtyBase = source.whseOutstandingQtyBase,
        target.sizeBTR = source.sizeBTR,
        target.allocAccModifiedByUser = source.allocAccModifiedByUser
WHEN NOT MATCHED   THEN
    INSERT (
        CompanyName, SystemRowVersion, documentType, documentNo, lineNo, buyFromVendorNo, type, no, locationCode, 
        postingGroup, expectedReceiptDate, description, description2, unitOfMeasure, quantity, outstandingQuantity, 
        qtyToInvoice, qtyToReceive, directUnitCost, unitCostLCY, vat, lineDiscount, lineDiscountAmount, amount, 
        amountIncludingVAT, unitPriceLCY, allowInvoiceDisc, grossWeight, netWeight, unitsPerParcel, unitVolume, 
        applToItemEntry, shortcutDimension1Code, shortcutDimension2Code, jobNo, indirectCost, recalculateInvoiceDisc, 
        outstandingAmount, qtyRcdNotInvoiced, amtRcdNotInvoiced, quantityReceived, quantityInvoiced, receiptNo, 
        receiptLineNo, orderNo, orderLineNo, profit, payToVendorNo, invDiscountAmount, vendorItemNo, salesOrderNo, 
        salesOrderLineNo, dropShipment, genBusPostingGroup, genProdPostingGroup, vatCalculationType, transactionType, 
        transportMethod, attachedToLineNo, entryPoint, area, transactionSpecification, taxAreaCode, taxLiable, 
        taxGroupCode, useTax, vatBusPostingGroup, vatProdPostingGroup, currencyCode, outstandingAmountLCY, 
        amtRcdNotInvoicedLCY, blanketOrderNo, blanketOrderLineNo, vatBaseAmount, unitCost, systemCreatedEntry, 
        lineAmount, vatDifference, invDiscAmountToInvoice, vatIdentifier, icPartnerRefType, icPartnerReference, 
        prepayment, prepmtLineAmount, prepmtAmtInv, prepmtAmtInclVAT, prepaymentAmount, prepmtVATBaseAmt, 
        prepaymentVAT, prepmtVATCalcType, prepaymentVATIdentifier, prepaymentTaxAreaCode, prepaymentTaxLiable, 
        prepaymentTaxGroupCode, prepmtAmtToDeduct, prepmtAmtDeducted, prepaymentLine, prepmtAmountInvInclVAT, 
        prepmtAmountInvLCY, icPartnerCode, prepmtVATAmountInvLCY, prepaymentVATDifference, prepmtVATDiffToDeduct, 
        prepmtVATDiffDeducted, icItemReferenceNo, outstandingAmtExVATLCY, aRcdNotInvExVATLCY, pmtDiscountAmount, 
        prepmtPmtDiscountAmount, dimensionSetID, jobTaskNo, jobLineType, jobUnitPrice, jobTotalPrice, jobLineAmount, 
        jobLineDiscountAmount, jobLineDiscount, jobUnitPriceLCY, jobTotalPriceLCY, jobLineAmountLCY, 
        jobLineDiscAmountLCY, jobCurrencyFactor, jobCurrencyCode, jobPlanningLineNo, jobRemainingQty, 
        jobRemainingQtyBase, deferralCode, returnsDeferralStartDate, selectedAllocAccountNo, allocationAccountNo, 
        prodOrderNo, variantCode, binCode, qtyPerUnitOfMeasure, qtyRoundingPrecision, qtyRoundingPrecisionBase, 
        unitOfMeasureCode, quantityBase, outstandingQtyBase, qtyToInvoiceBase, qtyToReceiveBase, qtyRcdNotInvoicedBase, 
        qtyReceivedBase, qtyInvoicedBase, faPostingDate, faPostingType, depreciationBookCode, salvageValue, 
        deprUntilFAPostingDate, deprAcquisitionCost, maintenanceCode, insuranceNo, budgetedFANo, 
        duplicateInDepreciationBook, useDuplicationList, responsibilityCenter, itemReferenceNo, 
        itemReferenceUnitOfMeasure, itemReferenceType, itemReferenceTypeNo, itemCategoryCode, nonstock, 
        purchasingCode, ProductGroupCode, specialOrder, specialOrderSalesNo, specialOrderSalesLineNo, 
        itemReferenceNo_2, itemReferenceUnitOfMeasure_2, itemReferenceType_2, itemReferenceTypeNo_2, 
        completelyReceived, requestedReceiptDate, promisedReceiptDate, leadTimeCalculation, inboundWhseHandlingTime, 
        plannedReceiptDate, orderDate, allowItemChargeAssignment, returnQtyToShip, returnQtyToShipBase, 
        returnQtyShippedNotInvd, retQtyShpdNotInvdBase, returnShpdNotInvd, returnShpdNotInvdLCY, 
        returnQtyShipped, returnQtyShippedBase, nonDeductibleVAT, nonDeductibleVATBase, nonDeductibleVATAmount, 
        nonDeductibleVATDiff, prepmtNonDeductVATBase, prepmtNonDeductVATAmount, returnShipmentNo, 
        returnShipmentLineNo, returnReasonCode, subtype, copiedFromPostedDoc, priceCalculationMethod, 
        overReceiptQuantity, overReceiptCode, overReceiptApprovalStatus, routingNo, operationNo, workCenterNo, 
        finished, prodOrderLineNo, overheadRate, mpsOrder, planningFlexibility, safetyLeadTime, 
        routingReferenceNo, systemId, systemCreatedAt, systemCreatedBy, systemModifiedAt, systemModifiedBy, 
        attachedDocCount, attachedLinesCount, colourBTR, itemChargeQtyToHandle, lscCollectionItemNo, 
        lscCollectionLineNo, lscCrossDocDifference, lscDivision, lscFranchiseProcess, lscOriginalQuantity, 
        lscOriginalQuantityBase, lscQuantityDifference, lscRetailProductCode, qtyAssigned, qtyToAssign, 
        reservedQtyBase, reservedQuantity, shipmentNoBTR, sourceLastModifiedUserBTR, statusBTR, 
        whseOutstandingQtyBase, sizeBTR, allocAccModifiedByUser
    )
    VALUES (
        source.CompanyName, source.SystemRowVersion, source.documentType, source.documentNo, source.lineNo, 
        source.buyFromVendorNo, source.type, source.no, source.locationCode, source.postingGroup, 
        source.expectedReceiptDate, source.description, source.description2, source.unitOfMeasure, source.quantity, 
        source.outstandingQuantity, source.qtyToInvoice, source.qtyToReceive, source.directUnitCost, 
        source.unitCostLCY, source.vat, source.lineDiscount, source.lineDiscountAmount, source.amount, 
        source.amountIncludingVAT, source.unitPriceLCY, source.allowInvoiceDisc, source.grossWeight, 
        source.netWeight, source.unitsPerParcel, source.unitVolume, source.applToItemEntry, 
        source.shortcutDimension1Code, source.shortcutDimension2Code, source.jobNo, source.indirectCost, 
        source.recalculateInvoiceDisc, source.outstandingAmount, source.qtyRcdNotInvoiced, source.amtRcdNotInvoiced, 
        source.quantityReceived, source.quantityInvoiced, source.receiptNo, source.receiptLineNo, source.orderNo, 
        source.orderLineNo, source.profit, source.payToVendorNo, source.invDiscountAmount, source.vendorItemNo, 
        source.salesOrderNo, source.salesOrderLineNo, source.dropShipment, source.genBusPostingGroup, 
        source.genProdPostingGroup, source.vatCalculationType, source.transactionType, source.transportMethod, 
        source.attachedToLineNo, source.entryPoint, source.area, source.transactionSpecification, 
        source.taxAreaCode, source.taxLiable, source.taxGroupCode, source.useTax, source.vatBusPostingGroup, 
        source.vatProdPostingGroup, source.currencyCode, source.outstandingAmountLCY, source.amtRcdNotInvoicedLCY, 
        source.blanketOrderNo, source.blanketOrderLineNo, source.vatBaseAmount, source.unitCost, 
        source.systemCreatedEntry, source.lineAmount, source.vatDifference, source.invDiscAmountToInvoice, 
        source.vatIdentifier, source.icPartnerRefType, source.icPartnerReference, source.prepayment, 
        source.prepmtLineAmount, source.prepmtAmtInv, source.prepmtAmtInclVAT, source.prepaymentAmount, 
        source.prepmtVATBaseAmt, source.prepaymentVAT, source.prepmtVATCalcType, source.prepaymentVATIdentifier, 
        source.prepaymentTaxAreaCode, source.prepaymentTaxLiable, source.prepaymentTaxGroupCode, 
        source.prepmtAmtToDeduct, source.prepmtAmtDeducted, source.prepaymentLine, source.prepmtAmountInvInclVAT, 
        source.prepmtAmountInvLCY, source.icPartnerCode, source.prepmtVATAmountInvLCY, 
        source.prepaymentVATDifference, source.prepmtVATDiffToDeduct, source.prepmtVATDiffDeducted, 
        source.icItemReferenceNo, source.outstandingAmtExVATLCY, source.aRcdNotInvExVATLCY, 
        source.pmtDiscountAmount, source.prepmtPmtDiscountAmount, source.dimensionSetID, source.jobTaskNo, 
        source.jobLineType, source.jobUnitPrice, source.jobTotalPrice, source.jobLineAmount, 
        source.jobLineDiscountAmount, source.jobLineDiscount, source.jobUnitPriceLCY, source.jobTotalPriceLCY, 
        source.jobLineAmountLCY, source.jobLineDiscAmountLCY, source.jobCurrencyFactor, source.jobCurrencyCode, 
        source.jobPlanningLineNo, source.jobRemainingQty, source.jobRemainingQtyBase, source.deferralCode, 
        source.returnsDeferralStartDate, source.selectedAllocAccountNo, source.allocationAccountNo, 
        source.prodOrderNo, source.variantCode, source.binCode, source.qtyPerUnitOfMeasure, 
        source.qtyRoundingPrecision, source.qtyRoundingPrecisionBase, source.unitOfMeasureCode, 
        source.quantityBase, source.outstandingQtyBase, source.qtyToInvoiceBase, source.qtyToReceiveBase, 
        source.qtyRcdNotInvoicedBase, source.qtyReceivedBase, source.qtyInvoicedBase, source.faPostingDate, 
        source.faPostingType, source.depreciationBookCode, source.salvageValue, source.deprUntilFAPostingDate, 
        source.deprAcquisitionCost, source.maintenanceCode, source.insuranceNo, source.budgetedFANo, 
        source.duplicateInDepreciationBook, source.useDuplicationList, source.responsibilityCenter, 
        source.itemReferenceNo, source.itemReferenceUnitOfMeasure, source.itemReferenceType, 
        source.itemReferenceTypeNo, source.itemCategoryCode, source.nonstock, source.purchasingCode, 
        source.ProductGroupCode, source.specialOrder, source.specialOrderSalesNo, source.specialOrderSalesLineNo, 
        source.itemReferenceNo_2, source.itemReferenceUnitOfMeasure_2, source.itemReferenceType_2, 
        source.itemReferenceTypeNo_2, source.completelyReceived, source.requestedReceiptDate, 
        source.promisedReceiptDate, source.leadTimeCalculation, source.inboundWhseHandlingTime, 
        source.plannedReceiptDate, source.orderDate, source.allowItemChargeAssignment, source.returnQtyToShip, 
        source.returnQtyToShipBase, source.returnQtyShippedNotInvd, source.retQtyShpdNotInvdBase, 
        source.returnShpdNotInvd, source.returnShpdNotInvdLCY, source.returnQtyShipped, 
        source.returnQtyShippedBase, source.nonDeductibleVAT, source.nonDeductibleVATBase, 
        source.nonDeductibleVATAmount, source.nonDeductibleVATDiff, source.prepmtNonDeductVATBase, 
        source.prepmtNonDeductVATAmount, source.returnShipmentNo, source.returnShipmentLineNo, 
        source.returnReasonCode, source.subtype, source.copiedFromPostedDoc, source.priceCalculationMethod, 
        source.overReceiptQuantity, source.overReceiptCode, source.overReceiptApprovalStatus, source.routingNo, 
        source.operationNo, source.workCenterNo, source.finished, source.prodOrderLineNo, source.overheadRate, 
        source.mpsOrder, source.planningFlexibility, source.safetyLeadTime, source.routingReferenceNo, 
        source.systemId, source.systemCreatedAt, source.systemCreatedBy, source.systemModifiedAt, 
        source.systemModifiedBy, source.attachedDocCount, source.attachedLinesCount, source.colourBTR, 
        source.itemChargeQtyToHandle, source.lscCollectionItemNo, source.lscCollectionLineNo, 
        source.lscCrossDocDifference, source.lscDivision, source.lscFranchiseProcess, source.lscOriginalQuantity, 
        source.lscOriginalQuantityBase, source.lscQuantityDifference, source.lscRetailProductCode, 
        source.qtyAssigned, source.qtyToAssign, source.reservedQtyBase, source.reservedQuantity, 
        source.shipmentNoBTR, source.sourceLastModifiedUserBTR, source.statusBTR, source.whseOutstandingQtyBase, 
        source.sizeBTR, source.allocAccModifiedByUser
    )
	;
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_RESERVATIONENTRY()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
  MERGE INTO fco.silver.factReservationEntry AS target
  USING fco.staging.stgReservationEntry AS source
  ON target.companyName = source.companyName
     AND target.entryNo = source.entryNo
     AND target.positive = source.positive
  WHEN MATCHED THEN
      UPDATE SET
          target.systemRowVersion = source.systemRowVersion,
          target.itemNo = source.itemNo,
          target.locationCode = source.locationCode,
          target.quantityBase = source.quantityBase,
          target.reservationStatus = source.reservationStatus,
          target.description = source.description,
          target.creationDate = source.creationDate,
          target.transferredFromEntryNo = source.transferredFromEntryNo,
          target.sourceType = source.sourceType,
          target.sourceSubtype = source.sourceSubtype,
          target.sourceID = source.sourceID,
          target.sourceBatchName = source.sourceBatchName,
          target.sourceProdOrderLine = source.sourceProdOrderLine,
          target.sourceRefNo = source.sourceRefNo,
          target.itemLedgerEntryNo = source.itemLedgerEntryNo,
          target.expectedReceiptDate = source.expectedReceiptDate,
          target.shipmentDate = source.shipmentDate,
          target.serialNo = source.serialNo,
          target.createdBy = source.createdBy,
          target.changedBy = source.changedBy,
          target.qtyPerUnitOfMeasure = source.qtyPerUnitOfMeasure,
          target.quantity = source.quantity,
          target.binding = source.binding,
          target.suppressedActionMsg = source.suppressedActionMsg,
          target.planningFlexibility = source.planningFlexibility,
          target.applToItemEntry = source.applToItemEntry,
          target.warrantyDate = source.warrantyDate,
          target.expirationDate = source.expirationDate,
          target.qtyToHandleBase = source.qtyToHandleBase,
          target.qtyToInvoiceBase = source.qtyToInvoiceBase,
          target.quantityInvoicedBase = source.quantityInvoicedBase,
          target.newSerialNo = source.newSerialNo,
          target.newLotNo = source.newLotNo,
          target.disallowCancellation = source.disallowCancellation,
          target.lotNo = source.lotNo,
          target.variantCode = source.variantCode,
          target.applFromItemEntry = source.applFromItemEntry,
          target.correction = source.correction,
          target.newExpirationDate = source.newExpirationDate,
          target.itemTracking = source.itemTracking,
          target.untrackedSurplus = source.untrackedSurplus,
          target.packageNo = source.packageNo,
          target.newPackageNo = source.newPackageNo,
          target.colourBTR = source.colourBTR,
          target.sizeBTR = source.sizeBTR,
          target.customerNoBTR = source.customerNoBTR,
          target.customerNameBTR = source.customerNameBTR,
          target.documentDateBTR = source.documentDateBTR,
          target.requestedDelDateBTR = source.requestedDelDateBTR,
          target.systemId = source.systemId,
          target.systemCreatedAt = source.systemCreatedAt,
          target.systemCreatedBy = source.systemCreatedBy,
          target.systemModifiedAt = source.systemModifiedAt,
          target.systemModifiedBy = source.systemModifiedBy,
          target.actionMessageAdjustment = source.actionMessageAdjustment
  WHEN NOT MATCHED   THEN
      INSERT (
          companyName,
          systemRowVersion,
          entryNo,
          positive,
          itemNo,
          locationCode,
          quantityBase,
          reservationStatus,
          description,
          creationDate,
          transferredFromEntryNo,
          sourceType,
          sourceSubtype,
          sourceID,
          sourceBatchName,
          sourceProdOrderLine,
          sourceRefNo,
          itemLedgerEntryNo,
          expectedReceiptDate,
          shipmentDate,
          serialNo,
          createdBy,
          changedBy,
          qtyPerUnitOfMeasure,
          quantity,
          binding,
          suppressedActionMsg,
          planningFlexibility,
          applToItemEntry,
          warrantyDate,
          expirationDate,
          qtyToHandleBase,
          qtyToInvoiceBase,
          quantityInvoicedBase,
          newSerialNo,
          newLotNo,
          disallowCancellation,
          lotNo,
          variantCode,
          applFromItemEntry,
          correction,
          newExpirationDate,
          itemTracking,
          untrackedSurplus,
          packageNo,
          newPackageNo,
          colourBTR,
          sizeBTR,
          customerNoBTR,
          customerNameBTR,
          documentDateBTR,
          requestedDelDateBTR,
          systemId,
          systemCreatedAt,
          systemCreatedBy,
          systemModifiedAt,
          systemModifiedBy,
          actionMessageAdjustment
      )
      VALUES (
          source.companyName,
          source.systemRowVersion,
          source.entryNo,
          source.positive,
          source.itemNo,
          source.locationCode,
          source.quantityBase,
          source.reservationStatus,
          source.description,
          source.creationDate,
          source.transferredFromEntryNo,
          source.sourceType,
          source.sourceSubtype,
          source.sourceID,
          source.sourceBatchName,
          source.sourceProdOrderLine,
          source.sourceRefNo,
          source.itemLedgerEntryNo,
          source.expectedReceiptDate,
          source.shipmentDate,
          source.serialNo,
          source.createdBy,
          source.changedBy,
          source.qtyPerUnitOfMeasure,
          source.quantity,
          source.binding,
          source.suppressedActionMsg,
          source.planningFlexibility,
          source.applToItemEntry,
          source.warrantyDate,
          source.expirationDate,
          source.qtyToHandleBase,
          source.qtyToInvoiceBase,
          source.quantityInvoicedBase,
          source.newSerialNo,
          source.newLotNo,
          source.disallowCancellation,
          source.lotNo,
          source.variantCode,
          source.applFromItemEntry,
          source.correction,
          source.newExpirationDate,
          source.itemTracking,
          source.untrackedSurplus,
          source.packageNo,
          source.newPackageNo,
          source.colourBTR,
          source.sizeBTR,
          source.customerNoBTR,
          source.customerNameBTR,
          source.documentDateBTR,
          source.requestedDelDateBTR,
          source.systemId,
          source.systemCreatedAt,
          source.systemCreatedBy,
          source.systemModifiedAt,
          source.systemModifiedBy,
          source.actionMessageAdjustment
      );
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_SALESCR_MEMOHEADER()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
   MERGE INTO fco.silver.factSalesCr_MemoHeader AS target
   USING fco.staging.stgSalesCr_MemoHeader AS source
   ON target.companyName = source.companyName
   AND target.no = source.no

   -- Update existing records
   WHEN MATCHED THEN
       UPDATE SET
           target.systemRowVersion = source.systemRowVersion,
           target.sellToCustomerNo = source.sellToCustomerNo,
           target.billToCustomerNo = source.billToCustomerNo,
           target.billToName = source.billToName,
           target.billToName2 = source.billToName2,
           target.billToAddress = source.billToAddress,
           target.billToAddress2 = source.billToAddress2,
           target.billToCity = source.billToCity,
           target.billToContact = source.billToContact,
           target.yourReference = source.yourReference,
           target.shipToCode = source.shipToCode,
           target.shipToName = source.shipToName,
           target.shipToName2 = source.shipToName2,
           target.shipToAddress = source.shipToAddress,
           target.shipToAddress2 = source.shipToAddress2,
           target.shipToCity = source.shipToCity,
           target.shipToContact = source.shipToContact,
           target.postingDate = source.postingDate,
           target.shipmentDate = source.shipmentDate,
           target.postingDescription = source.postingDescription,
           target.paymentTermsCode = source.paymentTermsCode,
           target.dueDate = source.dueDate,
           target.paymentDiscount = source.paymentDiscount,
           target.pmtDiscountDate = source.pmtDiscountDate,
           target.shipmentMethodCode = source.shipmentMethodCode,
           target.locationCode = source.locationCode,
           target.shortcutDimension1Code = source.shortcutDimension1Code,
           target.shortcutDimension2Code = source.shortcutDimension2Code,
           target.customerPostingGroup = source.customerPostingGroup,
           target.currencyCode = source.currencyCode,
           target.currencyFactor = source.currencyFactor,
           target.customerPriceGroup = source.customerPriceGroup,
           target.pricesIncludingVAT = source.pricesIncludingVAT,
           target.invoiceDiscCode = source.invoiceDiscCode,
           target.customerDiscGroup = source.customerDiscGroup,
           target.languageCode = source.languageCode,
           target.salespersonCode = source.salespersonCode,
           target.noPrinted = source.noPrinted,
           target.onHold = source.onHold,
           target.appliesToDocType = source.appliesToDocType,
           target.appliesToDocNo = source.appliesToDocNo,
           target.balAccountNo = source.balAccountNo,
           target.vatRegistrationNo = source.vatRegistrationNo,
           target.reasonCode = source.reasonCode,
           target.genBusPostingGroup = source.genBusPostingGroup,
           target.eu3PartyTrade = source.eu3PartyTrade,
           target.transactionType = source.transactionType,
           target.transportMethod = source.transportMethod,
           target.vatCountryRegionCode = source.vatCountryRegionCode,
           target.sellToCustomerName = source.sellToCustomerName,
           target.sellToCustomerName2 = source.sellToCustomerName2,
           target.sellToAddress = source.sellToAddress,
           target.sellToAddress2 = source.sellToAddress2,
           target.sellToCity = source.sellToCity,
           target.sellToContact = source.sellToContact,
           target.billToPostCode = source.billToPostCode,
           target.billToCounty = source.billToCounty,
           target.billToCountryRegionCode = source.billToCountryRegionCode,
           target.sellToPostCode = source.sellToPostCode,
           target.sellToCounty = source.sellToCounty,
           target.sellToCountryRegionCode = source.sellToCountryRegionCode,
           target.shipToPostCode = source.shipToPostCode,
           target.shipToCounty = source.shipToCounty,
           target.shipToCountryRegionCode = source.shipToCountryRegionCode,
           target.balAccountType = source.balAccountType,
           target.exitPoint = source.exitPoint,
           target.correction = source.correction,
           target.documentDate = source.documentDate,
           target.externalDocumentNo = source.externalDocumentNo,
           target.area = source.area,
           target.transactionSpecification = source.transactionSpecification,
           target.paymentMethodCode = source.paymentMethodCode,
           target.shippingAgentCode = source.shippingAgentCode,
           target.packageTrackingNo = source.packageTrackingNo,
           target.preAssignedNoSeries = source.preAssignedNoSeries,
           target.noSeries = source.noSeries,
           target.preAssignedNo = source.preAssignedNo,
           target.userID = source.userID,
           target.sourceCode = source.sourceCode,
           target.taxAreaCode = source.taxAreaCode,
           target.taxLiable = source.taxLiable,
           target.vatBusPostingGroup = source.vatBusPostingGroup,
           target.vatBaseDiscount = source.vatBaseDiscount,
           target.prepmtCrMemoNoSeries = source.prepmtCrMemoNoSeries,
           target.prepaymentCreditMemo = source.prepaymentCreditMemo,
           target.prepaymentOrderNo = source.prepaymentOrderNo,
           target.sellToPhoneNo = source.sellToPhoneNo,
           target.sellToEMail = source.sellToEMail,
           target.workDescription = source.workDescription,
           target.dimensionSetID = source.dimensionSetID,
           target.documentExchangeIdentifier = source.documentExchangeIdentifier,
           target.documentExchangeStatus = source.documentExchangeStatus,
           target.docExchOriginalIdentifier = source.docExchOriginalIdentifier,
           target.custLedgerEntryNo = source.custLedgerEntryNo,
           target.campaignNo = source.campaignNo,
           target.sellToContactNo = source.sellToContactNo,
           target.billToContactNo = source.billToContactNo,
           target.opportunityNo = source.opportunityNo,
           target.responsibilityCenter = source.responsibilityCenter,
           target.shippingAgentServiceCode = source.shippingAgentServiceCode,
           target.returnOrderNo = source.returnOrderNo,
           target.returnOrderNoSeries = source.returnOrderNoSeries,
           target.priceCalculationMethod = source.priceCalculationMethod,
           target.allowLineDisc = source.allowLineDisc,
           target.getReturnReceiptUsed = source.getReturnReceiptUsed,
           target.id = source.id,
           target.draftCrMemoSystemId = source.draftCrMemoSystemId,
           target.systemId = source.systemId,
           target.systemCreatedAt = source.systemCreatedAt,
           target.systemCreatedBy = source.systemCreatedBy,
           target.systemModifiedAt = source.systemModifiedAt,
           target.systemModifiedBy = source.systemModifiedBy,
           target.formatRegion = source.formatRegion,
           target.companyBankAccountCode = source.companyBankAccountCode,
           target.vatReportingDate = source.vatReportingDate,
           target.rcvdFromCountRegionCode = source.rcvdFromCountRegionCode,
           target.amount = source.amount,
           target.amountIncludingVAT = source.amountIncludingVAT,
           target.cancelled = source.cancelled,
           target.comment = source.comment,
           target.corrective = source.corrective,
           target.paid = source.paid,
           target.remainingAmount = source.remainingAmount,
           target.altGenBusPostingGroup = source.altGenBusPostingGroup,
           target.altVATBusPostingGroup = source.altVATBusPostingGroup,
           target.altVATRegistrationNo = source.altVATRegistrationNo,
           target.invoiceDiscountAmount = source.invoiceDiscountAmount,
           target.registrationNumber = source.registrationNumber,
           target.workDescriptionodatamediaEditLink = source.workDescriptionodatamediaEditLink,
           target.workDescriptionodatamediaReadLink = source.workDescriptionodatamediaReadLink,
           target.ReasonForExclusionBTR = source.ReasonForExclusionBTR,
           target.ExcludeFromRoyaltyBTR = source.ExcludeFromRoyaltyBTR,
           target.OnWorksheetBTR = source.OnWorksheetBTR,
           target.BrandBTR = source.BrandBTR,
           target.WCUrlBTR = source.WCUrlBTR,
           target.GPAmount = source.GPAmount,
           target.GPPercent = source.GPPercent,
           target.SLModified = source.SLModified,
           target.SLUpdated = source.SLUpdated,
           target.SourceCreatedByUserBTR = source.SourceCreatedByUserBTR,
           target.SourceLastModifiedUserBTR = source.SourceLastModifiedUserBTR,
           target.AutoApplyBTR = source.AutoApplyBTR,
           target.WCStatusBTR = source.WCStatusBTR,
           target.WCDocumentBTR = source.WCDocumentBTR,
           target.WCDatePaidBTR = source.WCDatePaidBTR,
           target.WCDateCompletedBTR = source.WCDateCompletedBTR,
           target.ShipToPhoneNoBTR = source.ShipToPhoneNoBTR,
           target.WCIdBTR = source.WCIdBTR,
           target.WCTransIdBTR = source.WCTransIdBTR,
           target.WCPaymentPostedBTR = source.WCPaymentPostedBTR,
           target.WCDiscountTotalBTR = source.WCDiscountTotalBTR,
           target.WCDiscountTaxBTR = source.WCDiscountTaxBTR,
           target.SourceCodeBTR = source.SourceCodeBTR,
           target.EMailStorefront = source.EMailStorefront,
           target.StatusStorefront = source.StatusStorefront,
           target.FulfilmentStatusStorefront = source.FulfilmentStatusStorefront,
           target.PaymentAmountStorefront = source.PaymentAmountStorefront,
           target.PaymentCurrencyStorefront = source.PaymentCurrencyStorefront,
           target.PaymentReferenceStorefront = source.PaymentReferenceStorefront,
           target.PaymentStatusStorefront = source.PaymentStatusStorefront,
           target.PaymentResultStorefront = source.PaymentResultStorefront,
           target.PaymentIDStorefront = source.PaymentIDStorefront,
           target.PaymentDateStorefront = source.PaymentDateStorefront,
           target.DocumentGUIDStorefront = source.DocumentGUIDStorefront,
           target.VoucherCodeSF = source.VoucherCodeSF,
           target.CreationDateTimeSF = source.CreationDateTimeSF,
           target.ConfirmationDateTimeSF = source.ConfirmationDateTimeSF,
           target.LoginDateTimeSF = source.LoginDateTimeSF,
           target.ActionSF = source.ActionSF,
           target.ForCollectionSF = source.ForCollectionSF,
           target.LSCBatchNo = source.LSCBatchNo,
           target.LSCStoreNo = source.LSCStoreNo,
           target.LSCPOSID = source.LSCPOSID,
           target.LSCPostingTime = source.LSCPostingTime,
           target.LSCCashierID = source.LSCCashierID,
           target.LSCBITimestamp = source.LSCBITimestamp,
           target.LSCCustomerOrderID = source.LSCCustomerOrderID,
           target.LSCMemberCardNo = source.LSCMemberCardNo,
           target.LSCFranchiseSingleShip = source.LSCFranchiseSingleShip,
           target.LSCCOShipOrder = source.LSCCOShipOrder,
           target.SFDriverName = source.SFDriverName,
           target.SFDriverSurname = source.SFDriverSurname,
           target.SFDriverIDNo = source.SFDriverIDNo,
           target.SFVehicleRegistration = source.SFVehicleRegistration,
           target.SFTrailerRegistration = source.SFTrailerRegistration,
           target.SFRequestedTime = source.SFRequestedTime,
           target.WCVoucherNoBTR = source.WCVoucherNoBTR,
           target.WCVoucherAmountBTR = source.WCVoucherAmountBTR,
           target.WCVoucherProcessedBTR = source.WCVoucherProcessedBTR

   -- Insert new records
   WHEN NOT MATCHED   THEN
       INSERT (
           companyName, no, systemRowVersion, sellToCustomerNo, billToCustomerNo, billToName, billToName2, 
           billToAddress, billToAddress2, billToCity, billToContact, yourReference, shipToCode, shipToName, 
           shipToName2, shipToAddress, shipToAddress2, shipToCity, shipToContact, postingDate, shipmentDate, 
           postingDescription, paymentTermsCode, dueDate, paymentDiscount, pmtDiscountDate, shipmentMethodCode, 
           locationCode, shortcutDimension1Code, shortcutDimension2Code, customerPostingGroup, currencyCode, 
           currencyFactor, customerPriceGroup, pricesIncludingVAT, invoiceDiscCode, customerDiscGroup, 
           languageCode, salespersonCode, noPrinted, onHold, appliesToDocType, appliesToDocNo, balAccountNo, 
           vatRegistrationNo, reasonCode, genBusPostingGroup, eu3PartyTrade, transactionType, transportMethod, 
           vatCountryRegionCode, sellToCustomerName, sellToCustomerName2, sellToAddress, sellToAddress2, 
           sellToCity, sellToContact, billToPostCode, billToCounty, billToCountryRegionCode, sellToPostCode, 
           sellToCounty, sellToCountryRegionCode, shipToPostCode, shipToCounty, shipToCountryRegionCode, 
           balAccountType, exitPoint, correction, documentDate, externalDocumentNo, area, transactionSpecification, 
           paymentMethodCode, shippingAgentCode, packageTrackingNo, preAssignedNoSeries, noSeries, preAssignedNo, 
           userID, sourceCode, taxAreaCode, taxLiable, vatBusPostingGroup, vatBaseDiscount, prepmtCrMemoNoSeries, 
           prepaymentCreditMemo, prepaymentOrderNo, sellToPhoneNo, sellToEMail, workDescription, dimensionSetID, 
           documentExchangeIdentifier, documentExchangeStatus, docExchOriginalIdentifier, custLedgerEntryNo, 
           campaignNo, sellToContactNo, billToContactNo, opportunityNo, responsibilityCenter, shippingAgentServiceCode, 
           returnOrderNo, returnOrderNoSeries, priceCalculationMethod, allowLineDisc, getReturnReceiptUsed, id, 
           draftCrMemoSystemId, systemId, systemCreatedAt, systemCreatedBy, systemModifiedAt, systemModifiedBy, 
           formatRegion, companyBankAccountCode, vatReportingDate, rcvdFromCountRegionCode, amount, 
           amountIncludingVAT, cancelled, comment, corrective, paid, remainingAmount, altGenBusPostingGroup, 
           altVATBusPostingGroup, altVATRegistrationNo, invoiceDiscountAmount, registrationNumber, 
           workDescriptionodatamediaEditLink, workDescriptionodatamediaReadLink, ReasonForExclusionBTR, 
           ExcludeFromRoyaltyBTR, OnWorksheetBTR, BrandBTR, WCUrlBTR, GPAmount, GPPercent, SLModified, SLUpdated, 
           SourceCreatedByUserBTR, SourceLastModifiedUserBTR, AutoApplyBTR, WCStatusBTR, WCDocumentBTR, 
           WCDatePaidBTR, WCDateCompletedBTR, ShipToPhoneNoBTR, WCIdBTR, WCTransIdBTR, WCPaymentPostedBTR, 
           WCDiscountTotalBTR, WCDiscountTaxBTR, SourceCodeBTR, EMailStorefront, StatusStorefront, 
           FulfilmentStatusStorefront, PaymentAmountStorefront, PaymentCurrencyStorefront, PaymentReferenceStorefront, 
           PaymentStatusStorefront, PaymentResultStorefront, PaymentIDStorefront, PaymentDateStorefront, 
           DocumentGUIDStorefront, VoucherCodeSF, CreationDateTimeSF, ConfirmationDateTimeSF, LoginDateTimeSF, 
           ActionSF, ForCollectionSF, LSCBatchNo, LSCStoreNo, LSCPOSID, LSCPostingTime, LSCCashierID, 
           LSCBITimestamp, LSCCustomerOrderID, LSCMemberCardNo, LSCFranchiseSingleShip, LSCCOShipOrder, 
           SFDriverName, SFDriverSurname, SFDriverIDNo, SFVehicleRegistration, SFTrailerRegistration, 
           SFRequestedTime, WCVoucherNoBTR, WCVoucherAmountBTR, WCVoucherProcessedBTR
       )
       VALUES (
           source.companyName, source.no, source.systemRowVersion, source.sellToCustomerNo, source.billToCustomerNo, 
           source.billToName, source.billToName2, source.billToAddress, source.billToAddress2, source.billToCity, 
           source.billToContact, source.yourReference, source.shipToCode, source.shipToName, source.shipToName2, 
           source.shipToAddress, source.shipToAddress2, source.shipToCity, source.shipToContact, source.postingDate, 
           source.shipmentDate, source.postingDescription, source.paymentTermsCode, source.dueDate, 
           source.paymentDiscount, source.pmtDiscountDate, source.shipmentMethodCode, source.locationCode, 
           source.shortcutDimension1Code, source.shortcutDimension2Code, source.customerPostingGroup, 
           source.currencyCode, source.currencyFactor, source.customerPriceGroup, source.pricesIncludingVAT, 
           source.invoiceDiscCode, source.customerDiscGroup, source.languageCode, source.salespersonCode, 
           source.noPrinted, source.onHold, source.appliesToDocType, source.appliesToDocNo, source.balAccountNo, 
           source.vatRegistrationNo, source.reasonCode, source.genBusPostingGroup, source.eu3PartyTrade, 
           source.transactionType, source.transportMethod, source.vatCountryRegionCode, source.sellToCustomerName, 
           source.sellToCustomerName2, source.sellToAddress, source.sellToAddress2, source.sellToCity, 
           source.sellToContact, source.billToPostCode, source.billToCounty, source.billToCountryRegionCode, 
           source.sellToPostCode, source.sellToCounty, source.sellToCountryRegionCode, source.shipToPostCode, 
           source.shipToCounty, source.shipToCountryRegionCode, source.balAccountType, source.exitPoint, 
           source.correction, source.documentDate, source.externalDocumentNo, source.area, 
           source.transactionSpecification, source.paymentMethodCode, source.shippingAgentCode, 
           source.packageTrackingNo, source.preAssignedNoSeries, source.noSeries, source.preAssignedNo, 
           source.userID, source.sourceCode, source.taxAreaCode, source.taxLiable, source.vatBusPostingGroup, 
           source.vatBaseDiscount, source.prepmtCrMemoNoSeries, source.prepaymentCreditMemo, 
           source.prepaymentOrderNo, source.sellToPhoneNo, source.sellToEMail, source.workDescription, 
           source.dimensionSetID, source.documentExchangeIdentifier, source.documentExchangeStatus, 
           source.docExchOriginalIdentifier, source.custLedgerEntryNo, source.campaignNo, source.sellToContactNo, 
           source.billToContactNo, source.opportunityNo, source.responsibilityCenter, source.shippingAgentServiceCode, 
           source.returnOrderNo, source.returnOrderNoSeries, source.priceCalculationMethod, source.allowLineDisc, 
           source.getReturnReceiptUsed, source.id, source.draftCrMemoSystemId, source.systemId, 
           source.systemCreatedAt, source.systemCreatedBy, source.systemModifiedAt, source.systemModifiedBy, 
           source.formatRegion, source.companyBankAccountCode, source.vatReportingDate, 
           source.rcvdFromCountRegionCode, source.amount, source.amountIncludingVAT, source.cancelled, 
           source.comment, source.corrective, source.paid, source.remainingAmount, source.altGenBusPostingGroup, 
           source.altVATBusPostingGroup, source.altVATRegistrationNo, source.invoiceDiscountAmount, 
           source.registrationNumber, source.workDescriptionodatamediaEditLink, 
           source.workDescriptionodatamediaReadLink, source.ReasonForExclusionBTR, 
           source.ExcludeFromRoyaltyBTR, source.OnWorksheetBTR, source.BrandBTR, source.WCUrlBTR, 
           source.GPAmount, source.GPPercent, source.SLModified, source.SLUpdated, source.SourceCreatedByUserBTR, 
           source.SourceLastModifiedUserBTR, source.AutoApplyBTR, source.WCStatusBTR, source.WCDocumentBTR, 
           source.WCDatePaidBTR, source.WCDateCompletedBTR, source.ShipToPhoneNoBTR, source.WCIdBTR, 
           source.WCTransIdBTR, source.WCPaymentPostedBTR, source.WCDiscountTotalBTR, source.WCDiscountTaxBTR, 
           source.SourceCodeBTR, source.EMailStorefront, source.StatusStorefront, source.FulfilmentStatusStorefront, 
           source.PaymentAmountStorefront, source.PaymentCurrencyStorefront, source.PaymentReferenceStorefront, 
           source.PaymentStatusStorefront, source.PaymentResultStorefront, source.PaymentIDStorefront, 
           source.PaymentDateStorefront, source.DocumentGUIDStorefront, source.VoucherCodeSF, 
           source.CreationDateTimeSF, source.ConfirmationDateTimeSF, source.LoginDateTimeSF, source.ActionSF, 
           source.ForCollectionSF, source.LSCBatchNo, source.LSCStoreNo, source.LSCPOSID, source.LSCPostingTime, 
           source.LSCCashierID, source.LSCBITimestamp, source.LSCCustomerOrderID, source.LSCMemberCardNo, 
           source.LSCFranchiseSingleShip, source.LSCCOShipOrder, source.SFDriverName, source.SFDriverSurname, 
           source.SFDriverIDNo, source.SFVehicleRegistration, source.SFTrailerRegistration, source.SFRequestedTime, 
           source.WCVoucherNoBTR, source.WCVoucherAmountBTR, source.WCVoucherProcessedBTR
       );
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_SALESCR_MEMOLINE()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
  MERGE INTO fco.silver.factSalesCr_MemoLine AS target
        USING fco.staging.stgSalesCr_MemoLine AS source
        ON target.CompanyName = source.CompanyName
           AND target.documentNo = source.documentNo
           AND target.lineNo = source.lineNo

        -- Update existing records where there is a match and data has changed
        WHEN MATCHED AND (
            target.systemRowVersion <> source.systemRowVersion
            OR COALESCE(target.sellToCustomerNo, '''') <> COALESCE(source.sellToCustomerNo, '''')
            OR COALESCE(target.type, '''') <> COALESCE(source.type, '''')
            OR COALESCE(target.no, '''') <> COALESCE(source.no, '''')
            OR COALESCE(target.locationCode, '''') <> COALESCE(source.locationCode, '''')
            OR COALESCE(target.postingGroup, '''') <> COALESCE(source.postingGroup, '''')
            OR COALESCE(target.shipmentDate, '''') <> COALESCE(source.shipmentDate, '''')
            OR COALESCE(target.description, '''') <> COALESCE(source.description, '''')
            OR COALESCE(target.description2, '''') <> COALESCE(source.description2, '''')
            OR COALESCE(target.unitOfMeasure, '''') <> COALESCE(source.unitOfMeasure, '''')
            OR COALESCE(target.quantity, 0) <> COALESCE(source.quantity, 0)
            OR COALESCE(target.unitPrice, 0) <> COALESCE(source.unitPrice, 0)
            OR COALESCE(target.unitCostLCY, 0) <> COALESCE(source.unitCostLCY, 0)
            OR COALESCE(target.vat, 0) <> COALESCE(source.vat, 0)
            OR COALESCE(target.lineDiscount, 0) <> COALESCE(source.lineDiscount, 0)
            OR COALESCE(target.lineDiscountAmount, 0) <> COALESCE(source.lineDiscountAmount, 0)
            OR COALESCE(target.amount, 0) <> COALESCE(source.amount, 0)
            OR COALESCE(target.amountIncludingVAT, 0) <> COALESCE(source.amountIncludingVAT, 0)
            OR COALESCE(target.allowInvoiceDisc, '''') <> COALESCE(source.allowInvoiceDisc, '''')
            OR COALESCE(target.grossWeight, 0) <> COALESCE(source.grossWeight, 0)
            OR COALESCE(target.netWeight, 0) <> COALESCE(source.netWeight, 0)
            OR COALESCE(target.unitsPerParcel, 0) <> COALESCE(source.unitsPerParcel, 0)
            OR COALESCE(target.unitVolume, 0) <> COALESCE(source.unitVolume, 0)
            OR COALESCE(target.applToItemEntry, 0) <> COALESCE(source.applToItemEntry, 0)
            OR COALESCE(target.shortcutDimension1Code, '''') <> COALESCE(source.shortcutDimension1Code, '''')
            OR COALESCE(target.shortcutDimension2Code, '''') <> COALESCE(source.shortcutDimension2Code, '''')
            OR COALESCE(target.customerPriceGroup, '''') <> COALESCE(source.customerPriceGroup, '''')
            OR COALESCE(target.jobNo, '''') <> COALESCE(source.jobNo, '''')
            OR COALESCE(target.workTypeCode, '''') <> COALESCE(source.workTypeCode, '''')
            OR COALESCE(target.orderNo, '''') <> COALESCE(source.orderNo, '''')
            OR COALESCE(target.orderLineNo, 0) <> COALESCE(source.orderLineNo, 0)
            OR COALESCE(target.billToCustomerNo, '''') <> COALESCE(source.billToCustomerNo, '''')
            OR COALESCE(target.invDiscountAmount, 0) <> COALESCE(source.invDiscountAmount, 0)
            OR COALESCE(target.genBusPostingGroup, '''') <> COALESCE(source.genBusPostingGroup, '''')
            OR COALESCE(target.genProdPostingGroup, '''') <> COALESCE(source.genProdPostingGroup, '''')
            OR COALESCE(target.vatCalculationType, '''') <> COALESCE(source.vatCalculationType, '''')
            OR COALESCE(target.transactionType, '''') <> COALESCE(source.transactionType, '''')
            OR COALESCE(target.transportMethod, '''') <> COALESCE(source.transportMethod, '''')
            OR COALESCE(target.attachedToLineNo, 0) <> COALESCE(source.attachedToLineNo, 0)
            OR COALESCE(target.exitPoint, '''') <> COALESCE(source.exitPoint, '''')
            OR COALESCE(target.area, '''') <> COALESCE(source.area, '''')
            OR COALESCE(target.transactionSpecification, '''') <> COALESCE(source.transactionSpecification, '''')
            OR COALESCE(target.taxCategory, '''') <> COALESCE(source.taxCategory, '''')
            OR COALESCE(target.taxAreaCode, '''') <> COALESCE(source.taxAreaCode, '''')
            OR COALESCE(target.taxLiable, '''') <> COALESCE(source.taxLiable, '''')
            OR COALESCE(target.taxGroupCode, '''') <> COALESCE(source.taxGroupCode, '''')
            OR COALESCE(target.vatClauseCode, '''') <> COALESCE(source.vatClauseCode, '''')
            OR COALESCE(target.vatBusPostingGroup, '''') <> COALESCE(source.vatBusPostingGroup, '''')
            OR COALESCE(target.vatProdPostingGroup, '''') <> COALESCE(source.vatProdPostingGroup, '''')
            OR COALESCE(target.blanketOrderNo, '''') <> COALESCE(source.blanketOrderNo, '''')
            OR COALESCE(target.blanketOrderLineNo, 0) <> COALESCE(source.blanketOrderLineNo, 0)
            OR COALESCE(target.vatBaseAmount, 0) <> COALESCE(source.vatBaseAmount, 0)
            OR COALESCE(target.unitCost, 0) <> COALESCE(source.unitCost, 0)
            OR COALESCE(target.systemCreatedEntry, '''') <> COALESCE(source.systemCreatedEntry, '''')
            OR COALESCE(target.lineAmount, 0) <> COALESCE(source.lineAmount, 0)
            OR COALESCE(target.vatDifference, 0) <> COALESCE(source.vatDifference, 0)
            OR COALESCE(target.vatIdentifier, '''') <> COALESCE(source.vatIdentifier, '''')
            OR COALESCE(target.icPartnerRefType, '''') <> COALESCE(source.icPartnerRefType, '''')
            OR COALESCE(target.icPartnerReference, '''') <> COALESCE(source.icPartnerReference, '''')
            OR COALESCE(target.prepaymentLine, '''') <> COALESCE(source.prepaymentLine, '''')
            OR COALESCE(target.icPartnerCode, '''') <> COALESCE(source.icPartnerCode, '''')
            OR COALESCE(target.postingDate, '''') <> COALESCE(source.postingDate, '''')
            OR COALESCE(target.icItemReferenceNo, '''') <> COALESCE(source.icItemReferenceNo, '''')
            OR COALESCE(target.pmtDiscountAmount, 0) <> COALESCE(source.pmtDiscountAmount, 0)
            OR COALESCE(target.lineDiscountCalculation, '''') <> COALESCE(source.lineDiscountCalculation, '''')
            OR COALESCE(target.dimensionSetID, 0) <> COALESCE(source.dimensionSetID, 0)
            OR COALESCE(target.jobTaskNo, '''') <> COALESCE(source.jobTaskNo, '''')
            OR COALESCE(target.jobContractEntryNo, 0) <> COALESCE(source.jobContractEntryNo, 0)
            OR COALESCE(target.deferralCode, '''') <> COALESCE(source.deferralCode, '''')
            OR COALESCE(target.variantCode, '''') <> COALESCE(source.variantCode, '''')
            OR COALESCE(target.binCode, '''') <> COALESCE(source.binCode, '''')
            OR COALESCE(target.qtyPerUnitOfMeasure, 0) <> COALESCE(source.qtyPerUnitOfMeasure, 0)
            OR COALESCE(target.unitOfMeasureCode, '''') <> COALESCE(source.unitOfMeasureCode, '''')
            OR COALESCE(target.quantityBase, 0) <> COALESCE(source.quantityBase, 0)
            OR COALESCE(target.faPostingDate, '''') <> COALESCE(source.faPostingDate, '''')
            OR COALESCE(target.depreciationBookCode, '''') <> COALESCE(source.depreciationBookCode, '''')
            OR COALESCE(target.deprUntilFAPostingDate, '''') <> COALESCE(source.deprUntilFAPostingDate, '''')
            OR COALESCE(target.duplicateInDepreciationBook, '''') <> COALESCE(source.duplicateInDepreciationBook, '''')
            OR COALESCE(target.useDuplicationList, '''') <> COALESCE(source.useDuplicationList, '''')
            OR COALESCE(target.responsibilityCenter, '''') <> COALESCE(source.responsibilityCenter, '''')
            OR COALESCE(target.crossReferenceNo, '''') <> COALESCE(source.crossReferenceNo, '''')
            OR COALESCE(target.unitOfMeasureCrossRef, '''') <> COALESCE(source.unitOfMeasureCrossRef, '''')
            OR COALESCE(target.crossReferenceType, '''') <> COALESCE(source.crossReferenceType, '''')
            OR COALESCE(target.crossReferenceTypeNo, '''') <> COALESCE(source.crossReferenceTypeNo, '''')
            OR COALESCE(target.itemCategoryCode, '''') <> COALESCE(source.itemCategoryCode, '''')
            OR COALESCE(target.nonstock, '''') <> COALESCE(source.nonstock, '''')
            OR COALESCE(target.purchasingCode, '''') <> COALESCE(source.purchasingCode, '''')
            OR COALESCE(target.productGroupCode, '''') <> COALESCE(source.productGroupCode, '''')
            OR COALESCE(target.itemReferenceNo, '''') <> COALESCE(source.itemReferenceNo, '''')
            OR COALESCE(target.itemReferenceUnitOfMeasure, '''') <> COALESCE(source.itemReferenceUnitOfMeasure, '''')
            OR COALESCE(target.itemReferenceType, '''') <> COALESCE(source.itemReferenceType, '''')
            OR COALESCE(target.itemReferenceTypeNo, '''') <> COALESCE(source.itemReferenceTypeNo, '''')
            OR COALESCE(target.applFromItemEntry, 0) <> COALESCE(source.applFromItemEntry, 0)
            OR COALESCE(target.returnReceiptNo, '''') <> COALESCE(source.returnReceiptNo, '''')
            OR COALESCE(target.returnReceiptLineNo, 0) <> COALESCE(source.returnReceiptLineNo, 0)
            OR COALESCE(target.returnReasonCode, '''') <> COALESCE(source.returnReasonCode, '''')
            OR COALESCE(target.priceCalculationMethod, '''') <> COALESCE(source.priceCalculationMethod, '''')
            OR COALESCE(target.allowLineDisc, '''') <> COALESCE(source.allowLineDisc, '''')
            OR COALESCE(target.customerDiscGroup, '''') <> COALESCE(source.customerDiscGroup, '''')
            OR COALESCE(target.statusBTR, '''') <> COALESCE(source.statusBTR, '''')
            OR COALESCE(target.colourBTR, '''') <> COALESCE(source.colourBTR, '''')
            OR COALESCE(target.sizeBTR, '''') <> COALESCE(source.sizeBTR, '''')
            OR COALESCE(target.LinkedLineNo_SF, 0) <> COALESCE(source.LinkedLineNo_SF, 0)
            OR COALESCE(target.LinkedLineTypeSF, 0) <> COALESCE(source.LinkedLineTypeSF, 0)
            OR COALESCE(target.LinkedLineDescriptionSF, '''') <> COALESCE(source.LinkedLineDescriptionSF, '''')
            OR COALESCE(target.BasketOfferIdSF, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36))) <> COALESCE(source.BasketOfferIdSF, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36)))
            OR COALESCE(target.BasketOfferUnitPriceSF, 0) <> COALESCE(source.BasketOfferUnitPriceSF, 0)
            OR COALESCE(target.SalesLineUnitPriceSF, 0) <> COALESCE(source.SalesLineUnitPriceSF, 0)
            OR COALESCE(target.SalesLineDiscountSF, 0) <> COALESCE(source.SalesLineDiscountSF, 0)
            OR COALESCE(target.OriginalUnitPriceSF, 0) <> COALESCE(source.OriginalUnitPriceSF, 0)
            OR COALESCE(target.PromotionDiscountSF, 0) <> COALESCE(source.PromotionDiscountSF, 0)
            OR COALESCE(target.CustomerDiscountSF, 0) <> COALESCE(source.CustomerDiscountSF, 0)
            OR COALESCE(target.PaymentDiscountSF, 0) <> COALESCE(source.PaymentDiscountSF, 0)
            OR COALESCE(target.ItemDiscountSF, 0) <> COALESCE(source.ItemDiscountSF, 0)
            OR COALESCE(target.DiscountExclusionSF, '''') <> COALESCE(source.DiscountExclusionSF, '''')
            OR COALESCE(target.Max_DiscountSF, 0) <> COALESCE(source.Max_DiscountSF, 0)
            OR COALESCE(target.PromoSPUnitPriceSF, 0) <> COALESCE(source.PromoSPUnitPriceSF, 0)
            OR COALESCE(target.PixelSubmitted, '''') <> COALESCE(source.PixelSubmitted, '''')
            OR COALESCE(target.VoucherCodeKI, '''') <> COALESCE(source.VoucherCodeKI, '''')
            OR COALESCE(target.VoucherAmountKI, 0) <> COALESCE(source.VoucherAmountKI, 0)
            OR COALESCE(target.CustDisc_GroupSF, 0) <> COALESCE(source.CustDisc_GroupSF, 0)
            OR COALESCE(target.LSCCollectionItemNo_, '''') <> COALESCE(source.LSCCollectionItemNo_, '''')
            OR COALESCE(target.LSCCollectionLineNo_, 0) <> COALESCE(source.LSCCollectionLineNo_, 0)
            OR COALESCE(target.LSCRetailProductCode, '''') <> COALESCE(source.LSCRetailProductCode, '''')
            OR COALESCE(target.LSCDivision, '''') <> COALESCE(source.LSCDivision, '''')
            OR COALESCE(target.LSCOfferNo_, '''') <> COALESCE(source.LSCOfferNo_, '''')
            OR COALESCE(target.LSCBITimestamp, '''') <> COALESCE(source.LSCBITimestamp, '''')
            OR COALESCE(target.LSCMemberPointsType, 0) <> COALESCE(source.LSCMemberPointsType, 0)
            OR COALESCE(target.LSCMemberPoints, 0) <> COALESCE(source.LSCMemberPoints, 0)
            OR COALESCE(target.systemId, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36))) <> COALESCE(source.systemId, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36)))
            OR COALESCE(target.systemCreatedAt, ''1900-01-01'') <> COALESCE(source.systemCreatedAt, ''1900-01-01'')
            OR COALESCE(target.systemCreatedBy, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36))) <> COALESCE(source.systemCreatedBy, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36)))
            OR COALESCE(target.systemModifiedAt, ''1900-01-01'') <> COALESCE(source.systemModifiedAt, ''1900-01-01'')
            OR COALESCE(target.systemModifiedBy, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36))) <> COALESCE(source.systemModifiedBy, CAST(''00000000-0000-0000-0000-000000000000'' AS varchar(36)))
        )
        THEN
            UPDATE SET
                target.systemRowVersion = source.systemRowVersion,
                target.sellToCustomerNo = source.sellToCustomerNo,
                target.type = source.type,
                target.no = source.no,
                target.locationCode = source.locationCode,
                target.postingGroup = source.postingGroup,
                target.shipmentDate = source.shipmentDate,
                target.description = source.description,
                target.description2 = source.description2,
                target.unitOfMeasure = source.unitOfMeasure,
                target.quantity = source.quantity,
                target.unitPrice = source.unitPrice,
                target.unitCostLCY = source.unitCostLCY,
                target.vat = source.vat,
                target.lineDiscount = source.lineDiscount,
                target.lineDiscountAmount = source.lineDiscountAmount,
                target.amount = source.amount,
                target.amountIncludingVAT = source.amountIncludingVAT,
                target.allowInvoiceDisc = source.allowInvoiceDisc,
                target.grossWeight = source.grossWeight,
                target.netWeight = source.netWeight,
                target.unitsPerParcel = source.unitsPerParcel,
                target.unitVolume = source.unitVolume,
                target.applToItemEntry = source.applToItemEntry,
                target.shortcutDimension1Code = source.shortcutDimension1Code,
                target.shortcutDimension2Code = source.shortcutDimension2Code,
                target.customerPriceGroup = source.customerPriceGroup,
                target.jobNo = source.jobNo,
                target.workTypeCode = source.workTypeCode,
                target.orderNo = source.orderNo,
                target.orderLineNo = source.orderLineNo,
                target.billToCustomerNo = source.billToCustomerNo,
                target.invDiscountAmount = source.invDiscountAmount,
                target.genBusPostingGroup = source.genBusPostingGroup,
                target.genProdPostingGroup = source.genProdPostingGroup,
                target.vatCalculationType = source.vatCalculationType,
                target.transactionType = source.transactionType,
                target.transportMethod = source.transportMethod,
                target.attachedToLineNo = source.attachedToLineNo,
                target.exitPoint = source.exitPoint,
                target.area = source.area,
                target.transactionSpecification = source.transactionSpecification,
                target.taxCategory = source.taxCategory,
                target.taxAreaCode = source.taxAreaCode,
                target.taxLiable = source.taxLiable,
                target.taxGroupCode = source.taxGroupCode,
                target.vatClauseCode = source.vatClauseCode,
                target.vatBusPostingGroup = source.vatBusPostingGroup,
                target.vatProdPostingGroup = source.vatProdPostingGroup,
                target.blanketOrderNo = source.blanketOrderNo,
                target.blanketOrderLineNo = source.blanketOrderLineNo,
                target.vatBaseAmount = source.vatBaseAmount,
                target.unitCost = source.unitCost,
                target.systemCreatedEntry = source.systemCreatedEntry,
                target.lineAmount = source.lineAmount,
                target.vatDifference = source.vatDifference,
                target.vatIdentifier = source.vatIdentifier,
                target.icPartnerRefType = source.icPartnerRefType,
                target.icPartnerReference = source.icPartnerReference,
                target.prepaymentLine = source.prepaymentLine,
                target.icPartnerCode = source.icPartnerCode,
                target.postingDate = source.postingDate,
                target.icItemReferenceNo = source.icItemReferenceNo,
                target.pmtDiscountAmount = source.pmtDiscountAmount,
                target.lineDiscountCalculation = source.lineDiscountCalculation,
                target.dimensionSetID = source.dimensionSetID,
                target.jobTaskNo = source.jobTaskNo,
                target.jobContractEntryNo = source.jobContractEntryNo,
                target.deferralCode = source.deferralCode,
                target.variantCode = source.variantCode,
                target.binCode = source.binCode,
                target.qtyPerUnitOfMeasure = source.qtyPerUnitOfMeasure,
                target.unitOfMeasureCode = source.unitOfMeasureCode,
                target.quantityBase = source.quantityBase,
                target.faPostingDate = source.faPostingDate,
                target.depreciationBookCode = source.depreciationBookCode,
                target.deprUntilFAPostingDate = source.deprUntilFAPostingDate,
                target.duplicateInDepreciationBook = source.duplicateInDepreciationBook,
                target.useDuplicationList = source.useDuplicationList,
                target.responsibilityCenter = source.responsibilityCenter,
                target.crossReferenceNo = source.crossReferenceNo,
                target.unitOfMeasureCrossRef = source.unitOfMeasureCrossRef,
                target.crossReferenceType = source.crossReferenceType,
                target.crossReferenceTypeNo = source.crossReferenceTypeNo,
                target.itemCategoryCode = source.itemCategoryCode,
                target.nonstock = source.nonstock,
                target.purchasingCode = source.purchasingCode,
                target.productGroupCode = source.productGroupCode,
                target.itemReferenceNo = source.itemReferenceNo,
                target.itemReferenceUnitOfMeasure = source.itemReferenceUnitOfMeasure,
                target.itemReferenceType = source.itemReferenceType,
                target.itemReferenceTypeNo = source.itemReferenceTypeNo,
                target.applFromItemEntry = source.applFromItemEntry,
                target.returnReceiptNo = source.returnReceiptNo,
                target.returnReceiptLineNo = source.returnReceiptLineNo,
                target.returnReasonCode = source.returnReasonCode,
                target.priceCalculationMethod = source.priceCalculationMethod,
                target.allowLineDisc = source.allowLineDisc,
                target.customerDiscGroup = source.customerDiscGroup,
                target.statusBTR = source.statusBTR,
                target.colourBTR = source.colourBTR,
                target.sizeBTR = source.sizeBTR,
                target.LinkedLineNo_SF = source.LinkedLineNo_SF,
                target.LinkedLineTypeSF = source.LinkedLineTypeSF,
                target.LinkedLineDescriptionSF = source.LinkedLineDescriptionSF,
                target.BasketOfferIdSF = source.BasketOfferIdSF,
                target.BasketOfferUnitPriceSF = source.BasketOfferUnitPriceSF,
                target.SalesLineUnitPriceSF = source.SalesLineUnitPriceSF,
                target.SalesLineDiscountSF = source.SalesLineDiscountSF,
                target.OriginalUnitPriceSF = source.OriginalUnitPriceSF,
                target.PromotionDiscountSF = source.PromotionDiscountSF,
                target.CustomerDiscountSF = source.CustomerDiscountSF,
                target.PaymentDiscountSF = source.PaymentDiscountSF,
                target.ItemDiscountSF = source.ItemDiscountSF,
                target.DiscountExclusionSF = source.DiscountExclusionSF,
                target.Max_DiscountSF = source.Max_DiscountSF,
                target.PromoSPUnitPriceSF = source.PromoSPUnitPriceSF,
                target.PixelSubmitted = source.PixelSubmitted,
                target.VoucherCodeKI = source.VoucherCodeKI,
                target.VoucherAmountKI = source.VoucherAmountKI,
                target.CustDisc_GroupSF = source.CustDisc_GroupSF,
                target.LSCCollectionItemNo_ = source.LSCCollectionItemNo_,
                target.LSCCollectionLineNo_ = source.LSCCollectionLineNo_,
                target.LSCRetailProductCode = source.LSCRetailProductCode,
                target.LSCDivision = source.LSCDivision,
                target.LSCOfferNo_ = source.LSCOfferNo_,
                target.LSCBITimestamp = source.LSCBITimestamp,
                target.LSCMemberPointsType = source.LSCMemberPointsType,
                target.LSCMemberPoints = source.LSCMemberPoints,
                target.systemId = source.systemId,
                target.systemCreatedAt = source.systemCreatedAt,
                target.systemCreatedBy = source.systemCreatedBy,
                target.systemModifiedAt = source.systemModifiedAt,
                target.systemModifiedBy = source.systemModifiedBy

        -- Insert new records from source that don''t exist in target
        WHEN NOT MATCHED  THEN
            INSERT (
                CompanyName, systemRowVersion, documentNo, lineNo, sellToCustomerNo, type, no, locationCode, postingGroup,
                shipmentDate, description, description2, unitOfMeasure, quantity, unitPrice, unitCostLCY, vat, lineDiscount,
                lineDiscountAmount, amount, amountIncludingVAT, allowInvoiceDisc, grossWeight, netWeight, unitsPerParcel,
                unitVolume, applToItemEntry, shortcutDimension1Code, shortcutDimension2Code, customerPriceGroup, jobNo,
                workTypeCode, orderNo, orderLineNo, billToCustomerNo, invDiscountAmount, genBusPostingGroup,
                genProdPostingGroup, vatCalculationType, transactionType, transportMethod, attachedToLineNo, exitPoint,
                area, transactionSpecification, taxCategory, taxAreaCode, taxLiable, taxGroupCode, vatClauseCode,
                vatBusPostingGroup, vatProdPostingGroup, blanketOrderNo, blanketOrderLineNo, vatBaseAmount, unitCost,
                systemCreatedEntry, lineAmount, vatDifference, vatIdentifier, icPartnerRefType, icPartnerReference,
                prepaymentLine, icPartnerCode, postingDate, icItemReferenceNo, pmtDiscountAmount, lineDiscountCalculation,
                dimensionSetID, jobTaskNo, jobContractEntryNo, deferralCode, variantCode, binCode, qtyPerUnitOfMeasure,
                unitOfMeasureCode, quantityBase, faPostingDate, depreciationBookCode, deprUntilFAPostingDate,
                duplicateInDepreciationBook, useDuplicationList, responsibilityCenter, crossReferenceNo,
                unitOfMeasureCrossRef, crossReferenceType, crossReferenceTypeNo, itemCategoryCode, nonstock,
                purchasingCode, productGroupCode, itemReferenceNo, itemReferenceUnitOfMeasure, itemReferenceType,
                itemReferenceTypeNo, applFromItemEntry, returnReceiptNo, returnReceiptLineNo, returnReasonCode,
                priceCalculationMethod, allowLineDisc, customerDiscGroup, statusBTR, colourBTR, sizeBTR,
                LinkedLineNo_SF, LinkedLineTypeSF, LinkedLineDescriptionSF, BasketOfferIdSF,
                BasketOfferUnitPriceSF, SalesLineUnitPriceSF, SalesLineDiscountSF, OriginalUnitPriceSF,
                PromotionDiscountSF, CustomerDiscountSF, PaymentDiscountSF, ItemDiscountSF,
               DiscountExclusionSF, Max_DiscountSF, PromoSPUnitPriceSF, PixelSubmitted,
                VoucherCodeKI, VoucherAmountKI, CustDisc_GroupSF, LSCCollectionItemNo_,
                LSCCollectionLineNo_, LSCRetailProductCode, LSCDivision, LSCOfferNo_, LSCBITimestamp,
                LSCMemberPointsType, LSCMemberPoints, systemId, systemCreatedAt, systemCreatedBy,
                systemModifiedAt, systemModifiedBy
            )
            VALUES (
                source.CompanyName, source.systemRowVersion, source.documentNo, source.lineNo, source.sellToCustomerNo,
                source.type, source.no, source.locationCode, source.postingGroup, source.shipmentDate,
                source.description, source.description2, source.unitOfMeasure, source.quantity, source.unitPrice,
                source.unitCostLCY, source.vat, source.lineDiscount, source.lineDiscountAmount, source.amount,
                source.amountIncludingVAT, source.allowInvoiceDisc, source.grossWeight, source.netWeight,
                source.unitsPerParcel, source.unitVolume, source.applToItemEntry, source.shortcutDimension1Code,
                source.shortcutDimension2Code, source.customerPriceGroup, source.jobNo, source.workTypeCode,
                source.orderNo, source.orderLineNo, source.billToCustomerNo, source.invDiscountAmount,
                source.genBusPostingGroup, source.genProdPostingGroup, source.vatCalculationType, source.transactionType,
                source.transportMethod, source.attachedToLineNo, source.exitPoint, source.area,
                source.transactionSpecification, source.taxCategory, source.taxAreaCode, source.taxLiable,
                source.taxGroupCode, source.vatClauseCode, source.vatBusPostingGroup, source.vatProdPostingGroup,
                source.blanketOrderNo, source.blanketOrderLineNo, source.vatBaseAmount, source.unitCost,
                source.systemCreatedEntry, source.lineAmount, source.vatDifference, source.vatIdentifier,
                source.icPartnerRefType, source.icPartnerReference, source.prepaymentLine, source.icPartnerCode,
                source.postingDate, source.icItemReferenceNo, source.pmtDiscountAmount, source.lineDiscountCalculation,
                source.dimensionSetID, source.jobTaskNo, source.jobContractEntryNo, source.deferralCode,
                source.variantCode, source.binCode, source.qtyPerUnitOfMeasure, source.unitOfMeasureCode,
                source.quantityBase, source.faPostingDate, source.depreciationBookCode, source.deprUntilFAPostingDate,
                source.duplicateInDepreciationBook, source.useDuplicationList, source.responsibilityCenter,
                source.crossReferenceNo, source.unitOfMeasureCrossRef, source.crossReferenceType,
                source.crossReferenceTypeNo, source.itemCategoryCode, source.nonstock, source.purchasingCode,
                source.productGroupCode, source.itemReferenceNo, source.itemReferenceUnitOfMeasure,
                source.itemReferenceType, source.itemReferenceTypeNo, source.applFromItemEntry, source.returnReceiptNo,
                source.returnReceiptLineNo, source.returnReasonCode, source.priceCalculationMethod,
                source.allowLineDisc, source.customerDiscGroup, source.statusBTR, source.colourBTR,
                source.sizeBTR, source.LinkedLineNo_SF, source.LinkedLineTypeSF,
                source.LinkedLineDescriptionSF, source.BasketOfferIdSF, source.BasketOfferUnitPriceSF,
                source.SalesLineUnitPriceSF, source.SalesLineDiscountSF, source.OriginalUnitPriceSF,
                source.PromotionDiscountSF, source.CustomerDiscountSF, source.PaymentDiscountSF,
                source.ItemDiscountSF, source.DiscountExclusionSF, source.Max_DiscountSF,
                source.PromoSPUnitPriceSF, source.PixelSubmitted, source.VoucherCodeKI,
                source.VoucherAmountKI, source.CustDisc_GroupSF, source.LSCCollectionItemNo_,
                source.LSCCollectionLineNo_, source.LSCRetailProductCode, source.LSCDivision,
                source.LSCOfferNo_, source.LSCBITimestamp, source.LSCMemberPointsType,
                source.LSCMemberPoints, source.systemId, source.systemCreatedAt, source.systemCreatedBy,
                source.systemModifiedAt, source.systemModifiedBy
            )

        -- Delete records from target that no longer exist in source
       ;
END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_SALESHEADER()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
MERGE INTO fco.silver.factSalesHeader AS target
USING fco.staging.stgSalesHeader AS source
ON target.CompanyName = source.CompanyName
   AND target.SystemRowVersion = source.SystemRowVersion
   AND target.documentType = source.documentType
   AND target.no = source.no
WHEN MATCHED THEN
    UPDATE SET
        sellToCustomerNo = source.sellToCustomerNo,
        billToCustomerNo = source.billToCustomerNo,
        billToName = source.billToName,
        billToName2 = source.billToName2,
        billToAddress = source.billToAddress,
        billToAddress2 = source.billToAddress2,
        billToCity = source.billToCity,
        billToContact = source.billToContact,
        yourReference = source.yourReference,
        shipToCode = source.shipToCode,
        shipToName = source.shipToName,
        shipToName2 = source.shipToName2,
        shipToAddress = source.shipToAddress,
        shipToAddress2 = source.shipToAddress2,
        shipToCity = source.shipToCity,
        shipToContact = source.shipToContact,
        orderDate = source.orderDate,
        postingDate = source.postingDate,
        shipmentDate = source.shipmentDate,
        postingDescription = source.postingDescription,
        paymentTermsCode = source.paymentTermsCode,
        dueDate = source.dueDate,
        paymentDiscount = source.paymentDiscount,
        pmtDiscountDate = source.pmtDiscountDate,
        shipmentMethodCode = source.shipmentMethodCode,
        locationCode = source.locationCode,
        shortcutDimension1Code = source.shortcutDimension1Code,
        shortcutDimension2Code = source.shortcutDimension2Code,
        customerPostingGroup = source.customerPostingGroup,
        currencyCode = source.currencyCode,
        currencyFactor = source.currencyFactor,
        customerPriceGroup = source.customerPriceGroup,
        pricesIncludingVAT = source.pricesIncludingVAT,
        invoiceDiscCode = source.invoiceDiscCode,
        customerDiscGroup = source.customerDiscGroup,
        languageCode = source.languageCode,
        formatRegion = source.formatRegion,
        salespersonCode = source.salespersonCode,
        orderClass = source.orderClass,
        noPrinted = source.noPrinted,
        onHold = source.onHold,
        appliesToDocType = source.appliesToDocType,
        appliesToDocNo = source.appliesToDocNo,
        balAccountNo = source.balAccountNo,
        ship = source.ship,
        invoice = source.invoice,
        printPostedDocuments = source.printPostedDocuments,
        shippingNo = source.shippingNo,
        postingNo = source.postingNo,
        lastShippingNo = source.lastShippingNo,
        lastPostingNo = source.lastPostingNo,
        prepaymentNo = source.prepaymentNo,
        lastPrepaymentNo = source.lastPrepaymentNo,
        prepmtCrMemoNo = source.prepmtCrMemoNo,
        lastPrepmtCrMemoNo = source.lastPrepmtCrMemoNo,
        vatRegistrationNo = source.vatRegistrationNo,
        combineShipments = source.combineShipments,
        registrationNumber = source.registrationNumber,
        reasonCode = source.reasonCode,
        genBusPostingGroup = source.genBusPostingGroup,
        eu3PartyTrade = source.eu3PartyTrade,
        transactionType = source.transactionType,
        transportMethod = source.transportMethod,
        vatCountryRegionCode = source.vatCountryRegionCode,
        sellToCustomerName = source.sellToCustomerName,
        sellToCustomerName2 = source.sellToCustomerName2,
        sellToAddress = source.sellToAddress,
        sellToAddress2 = source.sellToAddress2,
        sellToCity = source.sellToCity,
        sellToContact = source.sellToContact,
        billToPostCode = source.billToPostCode,
        billToCounty = source.billToCounty,
        billToCountryRegionCode = source.billToCountryRegionCode,
        sellToPostCode = source.sellToPostCode,
        sellToCounty = source.sellToCounty,
        sellToCountryRegionCode = source.sellToCountryRegionCode,
        shipToPostCode = source.shipToPostCode,
        shipToCounty = source.shipToCounty,
        shipToCountryRegionCode = source.shipToCountryRegionCode,
        balAccountType = source.balAccountType,
        exitPoint = source.exitPoint,
        correction = source.correction,
        documentDate = source.documentDate,
        externalDocumentNo = source.externalDocumentNo,
        area = source.area,
        transactionSpecification = source.transactionSpecification,
        paymentMethodCode = source.paymentMethodCode,
        shippingAgentCode = source.shippingAgentCode,
        packageTrackingNo = source.packageTrackingNo,
        noSeries = source.noSeries,
        postingNoSeries = source.postingNoSeries,
        shippingNoSeries = source.shippingNoSeries,
        taxAreaCode = source.taxAreaCode,
        taxLiable = source.taxLiable,
        vatBusPostingGroup = source.vatBusPostingGroup,
        reserve = source.reserve,
        appliesToID = source.appliesToID,
        vatBaseDiscount = source.vatBaseDiscount,
        status = source.status,
        invoiceDiscountCalculation = source.invoiceDiscountCalculation,
        invoiceDiscountValue = source.invoiceDiscountValue,
        sendICDocument = source.sendICDocument,
        icStatus = source.icStatus,
        sellToICPartnerCode = source.sellToICPartnerCode,
        billToICPartnerCode = source.billToICPartnerCode,
        icReferenceDocumentNo = source.icReferenceDocumentNo,
        icDirection = source.icDirection,
        prepayment = source.prepayment,
        prepaymentNoSeries = source.prepaymentNoSeries,
        compressPrepayment = source.compressPrepayment,
        prepaymentDueDate = source.prepaymentDueDate,
        prepmtCrMemoNoSeries = source.prepmtCrMemoNoSeries,
        prepmtPostingDescription = source.prepmtPostingDescription,
        prepmtPmtDiscountDate = source.prepmtPmtDiscountDate,
        prepmtPaymentTermsCode = source.prepmtPaymentTermsCode,
        prepmtPaymentDiscount = source.prepmtPaymentDiscount,
        quoteNo = source.quoteNo,
        quoteValidUntilDate = source.quoteValidUntilDate,
        quoteSentToCustomer = source.quoteSentToCustomer,
        quoteAccepted = source.quoteAccepted,
        quoteAcceptedDate = source.quoteAcceptedDate,
        jobQueueStatus = source.jobQueueStatus,
        jobQueueEntryID = source.jobQueueEntryID,
        companyBankAccountCode = source.companyBankAccountCode,
        incomingDocumentEntryNo = source.incomingDocumentEntryNo,
        altVATRegistrationNo = source.altVATRegistrationNo,
        altGenBusPostingGroup = source.altGenBusPostingGroup,
        altVATBusPostingGroup = source.altVATBusPostingGroup,
        isTest = source.isTest,
        sellToPhoneNo = source.sellToPhoneNo,
        sellToEMail = source.sellToEMail,
        PaymentInstructionsId = source.PaymentInstructionsId,
        journalTemplName = source.journalTemplName,
        vatReportingDate = source.vatReportingDate,
        rcvdFromCountRegionCode = source.rcvdFromCountRegionCode,
        RcvdfromCountryRegionCode = source.RcvdfromCountryRegionCode,
        workDescription = source.workDescription,
        shipToPhoneNo = source.shipToPhoneNo,
        dimensionSetID = source.dimensionSetID,
        paymentServiceSetID = source.paymentServiceSetID,
        coupledToDataverse = source.coupledToDataverse,
        directDebitMandateID = source.directDebitMandateID,
        docNoOccurrence = source.docNoOccurrence,
        campaignNo = source.campaignNo,
        sellToCustomerTemplCode = source.sellToCustomerTemplCode,
        sellToContactNo = source.sellToContactNo,
        billToContactNo = source.billToContactNo,
        billToCustomerTemplCode = source.billToCustomerTemplCode,
        opportunityNo = source.opportunityNo,
        SelltoCustomerTemplateCode = source.SelltoCustomerTemplateCode,
        BilltoCustomerTemplateCode = source.BilltoCustomerTemplateCode,
        responsibilityCenter = source.responsibilityCenter,
        shippingAdvice = source.shippingAdvice,
        postingFromWhseRef = source.postingFromWhseRef,
        requestedDeliveryDate = source.requestedDeliveryDate,
        promisedDeliveryDate = source.promisedDeliveryDate,
        shippingTime = source.shippingTime,
        outboundWhseHandlingTime = source.outboundWhseHandlingTime,
        shippingAgentServiceCode = source.shippingAgentServiceCode,
        receive = source.receive,
        returnReceiptNo = source.returnReceiptNo,
        returnReceiptNoSeries = source.returnReceiptNoSeries,
        lastReturnReceiptNo = source.lastReturnReceiptNo,
        priceCalculationMethod = source.priceCalculationMethod,
        allowLineDisc = source.allowLineDisc,
        getShipmentUsed = source.getShipmentUsed,
        Id = source.Id,
        assignedUserID = source.assignedUserID,
        reasonForExclusionBTR = source.reasonForExclusionBTR,
        excludeFromRoyaltyBTR = source.excludeFromRoyaltyBTR,
        overrideBlockShipmentBTR = source.overrideBlockShipmentBTR,
        discountCalculatedBTR = source.discountCalculatedBTR,
        skynamoCommentBTR = source.skynamoCommentBTR,
        brandBTR = source.brandBTR,
        wcUrlBTR = source.wcUrlBTR,
        gpAmount = source.gpAmount,
        slModified = source.slModified,
        slUpdated = source.slUpdated,
        sourceCreatedByUserBTR = source.sourceCreatedByUserBTR,
        sourceLastModifiedUserBTR = source.sourceLastModifiedUserBTR,
        autoApplyBTR = source.autoApplyBTR,
        sfOrderSplitBTR = source.sfOrderSplitBTR,
        wcStatusBTR = source.wcStatusBTR,
        wcDocumentBTR = source.wcDocumentBTR,
        wcDatePaidBTR = source.wcDatePaidBTR,
        wcDateCompletedBTR = source.wcDateCompletedBTR,
        shipToPhoneNoBTR = source.shipToPhoneNoBTR,
        wcIdBTR = source.wcIdBTR,
        wcTransIdBTR = source.wcTransIdBTR,
        wcPaymentPostedBTR = source.wcPaymentPostedBTR,
        wcDiscountTotalBTR = source.wcDiscountTotalBTR,
        wcDiscountTaxBTR = source.wcDiscountTaxBTR,
        sourceCodeBTR = source.sourceCodeBTR,
        wcVoucherNoBTR = source.wcVoucherNoBTR,
        wcVoucherAmountBTR = source.wcVoucherAmountBTR,
        wcVoucherProcessedBTR = source.wcVoucherProcessedBTR,
        brandActionRequired = source.brandActionRequired,
        releaseDateBTR = source.releaseDateBTR,
        whseReceiptDateBTR = source.whseReceiptDateBTR,
        totalShipmentAmountBTR = source.totalShipmentAmountBTR,
        RecurringBilling = source.RecurringBilling,
        ContractDetailOverview = source.ContractDetailOverview,
        lscBatchNo = source.lscBatchNo,
        lscStoreNo = source.lscStoreNo,
        lscPOSID = source.lscPOSID,
        lscPostingTime = source.lscPostingTime,
        lscNotShowDialog = source.lscNotShowDialog,
        lscSalesType = source.lscSalesType,
        lscPOSComment = source.lscPOSComment,
        lscRetailStatus = source.lscRetailStatus,
        lscReceivingPickingNo = source.lscReceivingPickingNo,
        lscCustomerOrderID = source.lscCustomerOrderID,
        lscStatementNo = source.lscStatementNo,
        lscMemberCardNo = source.lscMemberCardNo,
        lscActivityGroupNo = source.lscActivityGroupNo,
        lscActivityReservationNo = source.lscActivityReservationNo,
        lscActivityNo = source.lscActivityNo,
        lscFranchiseSingleShip = source.lscFranchiseSingleShip,
        lscCOShipOrder = source.lscCOShipOrder,
        ShpfyOrderId = source.ShpfyOrderId,
        ShpfyOrderNo_ = source.ShpfyOrderNo_,
        ShpfyRefundId = source.ShpfyRefundId,
        amount = source.amount,
        amountIncludingVAT = source.amountIncludingVAT,
        amtShipNotInvLCY = source.amtShipNotInvLCY,
        amtShipNotInvLCYBase = source.amtShipNotInvLCYBase,
        comment = source.comment,
        completelyShipped = source.completelyShipped,
        documentPostedDateBTR = source.documentPostedDateBTR,
        gp = source.gp,
        invDiscountAmountBTR = source.invDiscountAmountBTR,
        invoiceDiscountAmount = source.invoiceDiscountAmount,
        lastEmailSentMessageId = source.lastEmailSentMessageId,
        lastEmailSentTime = source.lastEmailSentTime,
        lastShipmentDate = source.lastShipmentDate,
        lateOrderShipping = source.lateOrderShipping,
        noOfArchivedVersions = source.noOfArchivedVersions,
        outstandingQuantityBTR = source.outstandingQuantityBTR,
        qtyPickedBTR = source.qtyPickedBTR,
        quantityBTR = source.quantityBTR,
        quantityInvoicedBTR = source.quantityInvoicedBTR,
        quantityShippedBTR = source.quantityShippedBTR,
        recalculateInvoiceDisc = source.recalculateInvoiceDisc,
        shipped = source.shipped,
        shippedNotInvoiced = source.shippedNotInvoiced,
        whseActivityNoBTR = source.whseActivityNoBTR,
        whseShipmentDateBTR = source.whseShipmentDateBTR,
        systemId = source.systemId,
        systemCreatedAt = source.systemCreatedAt,
        systemCreatedBy = source.systemCreatedBy,
        systemModifiedAt = source.systemModifiedAt,
        systemModifiedBy = source.systemModifiedBy
WHEN NOT MATCHED THEN
    INSERT (
        CompanyName, SystemRowVersion, documentType, no, sellToCustomerNo, billToCustomerNo, billToName, billToName2,
        billToAddress, billToAddress2, billToCity, billToContact, yourReference, shipToCode, shipToName, shipToName2,
        shipToAddress, shipToAddress2, shipToCity, shipToContact, orderDate, postingDate, shipmentDate, postingDescription,
        paymentTermsCode, dueDate, paymentDiscount, pmtDiscountDate, shipmentMethodCode, locationCode,
        shortcutDimension1Code, shortcutDimension2Code, customerPostingGroup, currencyCode, currencyFactor,
        customerPriceGroup, pricesIncludingVAT, invoiceDiscCode, customerDiscGroup, languageCode, formatRegion,
        salespersonCode, orderClass, noPrinted, onHold, appliesToDocType, appliesToDocNo, balAccountNo, ship, invoice,
        printPostedDocuments, shippingNo, postingNo, lastShippingNo, lastPostingNo, prepaymentNo, lastPrepaymentNo,
        prepmtCrMemoNo, lastPrepmtCrMemoNo, vatRegistrationNo, combineShipments, registrationNumber, reasonCode,
        genBusPostingGroup, eu3PartyTrade, transactionType, transportMethod, vatCountryRegionCode, sellToCustomerName,
        sellToCustomerName2, sellToAddress, sellToAddress2, sellToCity, sellToContact, billToPostCode, billToCounty,
        billToCountryRegionCode, sellToPostCode, sellToCounty, sellToCountryRegionCode, shipToPostCode, shipToCounty,
        shipToCountryRegionCode, balAccountType, exitPoint, correction, documentDate, externalDocumentNo, area,
        transactionSpecification, paymentMethodCode, shippingAgentCode, packageTrackingNo, noSeries, postingNoSeries,
        shippingNoSeries, taxAreaCode, taxLiable, vatBusPostingGroup, reserve, appliesToID, vatBaseDiscount, status,
        invoiceDiscountCalculation, invoiceDiscountValue, sendICDocument, icStatus, sellToICPartnerCode,
        billToICPartnerCode, icReferenceDocumentNo, icDirection, prepayment, prepaymentNoSeries, compressPrepayment,
        prepaymentDueDate, prepmtCrMemoNoSeries, prepmtPostingDescription, prepmtPmtDiscountDate,
        prepmtPaymentTermsCode, prepmtPaymentDiscount, quoteNo, quoteValidUntilDate, quoteSentToCustomer, quoteAccepted,
        quoteAcceptedDate, jobQueueStatus, jobQueueEntryID, companyBankAccountCode, incomingDocumentEntryNo,
        altVATRegistrationNo, altGenBusPostingGroup, altVATBusPostingGroup, isTest, sellToPhoneNo, sellToEMail,
        PaymentInstructionsId, journalTemplName, vatReportingDate, rcvdFromCountRegionCode, RcvdfromCountryRegionCode,
        workDescription, shipToPhoneNo, dimensionSetID, paymentServiceSetID, coupledToDataverse, directDebitMandateID,
        docNoOccurrence, campaignNo, sellToCustomerTemplCode, sellToContactNo, billToContactNo, billToCustomerTemplCode,
        opportunityNo, SelltoCustomerTemplateCode, BilltoCustomerTemplateCode, responsibilityCenter, shippingAdvice,
        postingFromWhseRef, requestedDeliveryDate, promisedDeliveryDate, shippingTime, outboundWhseHandlingTime,
        shippingAgentServiceCode, receive, returnReceiptNo, returnReceiptNoSeries, lastReturnReceiptNo,
        priceCalculationMethod, allowLineDisc, getShipmentUsed, Id, assignedUserID, reasonForExclusionBTR,
        excludeFromRoyaltyBTR, overrideBlockShipmentBTR, discountCalculatedBTR, skynamoCommentBTR, brandBTR, wcUrlBTR,
        gpAmount, slModified, slUpdated, sourceCreatedByUserBTR, sourceLastModifiedUserBTR, autoApplyBTR,
        sfOrderSplitBTR, wcStatusBTR, wcDocumentBTR, wcDatePaidBTR, wcDateCompletedBTR, shipToPhoneNoBTR, wcIdBTR,
        wcTransIdBTR, wcPaymentPostedBTR, wcDiscountTotalBTR, wcDiscountTaxBTR, sourceCodeBTR, wcVoucherNoBTR,
        wcVoucherAmountBTR, wcVoucherProcessedBTR, brandActionRequired, releaseDateBTR, whseReceiptDateBTR,
        totalShipmentAmountBTR, RecurringBilling, ContractDetailOverview, lscBatchNo, lscStoreNo, lscPOSID,
        lscPostingTime, lscNotShowDialog, lscSalesType, lscPOSComment, lscRetailStatus, lscReceivingPickingNo,
        lscCustomerOrderID, lscStatementNo, lscMemberCardNo, lscActivityGroupNo, lscActivityReservationNo, lscActivityNo,
        lscFranchiseSingleShip, lscCOShipOrder, ShpfyOrderId, ShpfyOrderNo_, ShpfyRefundId, amount, amountIncludingVAT,
        amtShipNotInvLCY, amtShipNotInvLCYBase, comment, completelyShipped, documentPostedDateBTR, gp,
        invDiscountAmountBTR, invoiceDiscountAmount, lastEmailSentMessageId, lastEmailSentTime, lastShipmentDate,
        lateOrderShipping, noOfArchivedVersions, outstandingQuantityBTR, qtyPickedBTR, quantityBTR,
        quantityInvoicedBTR, quantityShippedBTR, recalculateInvoiceDisc, shipped, shippedNotInvoiced,
        whseActivityNoBTR, whseShipmentDateBTR, systemId, systemCreatedAt, systemCreatedBy, systemModifiedAt,
        systemModifiedBy
    )
    VALUES (
        source.CompanyName, source.SystemRowVersion, source.documentType, source.no, source.sellToCustomerNo,
        source.billToCustomerNo, source.billToName, source.billToName2, source.billToAddress, source.billToAddress2,
        source.billToCity, source.billToContact, source.yourReference, source.shipToCode, source.shipToName,
        source.shipToName2, source.shipToAddress, source.shipToAddress2, source.shipToCity, source.shipToContact,
        source.orderDate, source.postingDate, source.shipmentDate, source.postingDescription, source.paymentTermsCode,
        source.dueDate, source.paymentDiscount, source.pmtDiscountDate, source.shipmentMethodCode, source.locationCode,
        source.shortcutDimension1Code, source.shortcutDimension2Code, source.customerPostingGroup, source.currencyCode,
        source.currencyFactor, source.customerPriceGroup, source.pricesIncludingVAT, source.invoiceDiscCode,
        source.customerDiscGroup, source.languageCode, source.formatRegion, source.salespersonCode, source.orderClass,
        source.noPrinted, source.onHold, source.appliesToDocType, source.appliesToDocNo, source.balAccountNo,
        source.ship, source.invoice, source.printPostedDocuments, source.shippingNo, source.postingNo,
        source.lastShippingNo, source.lastPostingNo, source.prepaymentNo, source.lastPrepaymentNo,
        source.prepmtCrMemoNo, source.lastPrepmtCrMemoNo, source.vatRegistrationNo, source.combineShipments,
        source.registrationNumber, source.reasonCode, source.genBusPostingGroup, source.eu3PartyTrade,
        source.transactionType, source.transportMethod, source.vatCountryRegionCode, source.sellToCustomerName,
        source.sellToCustomerName2, source.sellToAddress, source.sellToAddress2, source.sellToCity,
        source.sellToContact, source.billToPostCode, source.billToCounty, source.billToCountryRegionCode,
        source.sellToPostCode, source.sellToCounty, source.sellToCountryRegionCode, source.shipToPostCode,
        source.shipToCounty, source.shipToCountryRegionCode, source.balAccountType, source.exitPoint,
        source.correction, source.documentDate, source.externalDocumentNo, source.area,
        source.transactionSpecification, source.paymentMethodCode, source.shippingAgentCode, source.packageTrackingNo,
        source.noSeries, source.postingNoSeries, source.shippingNoSeries, source.taxAreaCode, source.taxLiable,
        source.vatBusPostingGroup, source.reserve, source.appliesToID, source.vatBaseDiscount, source.status,
        source.invoiceDiscountCalculation, source.invoiceDiscountValue, source.sendICDocument, source.icStatus,
        source.sellToICPartnerCode, source.billToICPartnerCode, source.icReferenceDocumentNo, source.icDirection,
        source.prepayment, source.prepaymentNoSeries, source.compressPrepayment, source.prepaymentDueDate,
        source.prepmtCrMemoNoSeries, source.prepmtPostingDescription, source.prepmtPmtDiscountDate,
        source.prepmtPaymentTermsCode, source.prepmtPaymentDiscount, source.quoteNo, source.quoteValidUntilDate,
        source.quoteSentToCustomer, source.quoteAccepted, source.quoteAcceptedDate, source.jobQueueStatus,
        source.jobQueueEntryID, source.companyBankAccountCode, source.incomingDocumentEntryNo,
        source.altVATRegistrationNo, source.altGenBusPostingGroup, source.altVATBusPostingGroup, source.isTest,
        source.sellToPhoneNo, source.sellToEMail, source.PaymentInstructionsId, source.journalTemplName,
        source.vatReportingDate, source.rcvdFromCountRegionCode, source.RcvdfromCountryRegionCode,
        source.workDescription, source.shipToPhoneNo, source.dimensionSetID, source.paymentServiceSetID,
        source.coupledToDataverse, source.directDebitMandateID, source.docNoOccurrence, source.campaignNo,
        source.sellToCustomerTemplCode, source.sellToContactNo, source.billToContactNo,
        source.billToCustomerTemplCode, source.opportunityNo, source.SelltoCustomerTemplateCode,
        source.BilltoCustomerTemplateCode, source.responsibilityCenter, source.shippingAdvice,
        source.postingFromWhseRef, source.requestedDeliveryDate, source.promisedDeliveryDate, source.shippingTime,
        source.outboundWhseHandlingTime, source.shippingAgentServiceCode, source.receive, source.returnReceiptNo,
        source.returnReceiptNoSeries, source.lastReturnReceiptNo, source.priceCalculationMethod, source.allowLineDisc,
        source.getShipmentUsed, source.Id, source.assignedUserID, source.reasonForExclusionBTR,
        source.excludeFromRoyaltyBTR, source.overrideBlockShipmentBTR, source.discountCalculatedBTR,
        source.skynamoCommentBTR, source.brandBTR, source.wcUrlBTR, source.gpAmount, source.slModified,
        source.slUpdated, source.sourceCreatedByUserBTR, source.sourceLastModifiedUserBTR, source.autoApplyBTR,
        source.sfOrderSplitBTR, source.wcStatusBTR, source.wcDocumentBTR, source.wcDatePaidBTR,
        source.wcDateCompletedBTR, source.shipToPhoneNoBTR, source.wcIdBTR, source.wcTransIdBTR,
        source.wcPaymentPostedBTR, source.wcDiscountTotalBTR, source.wcDiscountTaxBTR, source.sourceCodeBTR,
        source.wcVoucherNoBTR, source.wcVoucherAmountBTR, source.wcVoucherProcessedBTR, source.brandActionRequired,
        source.releaseDateBTR, source.whseReceiptDateBTR, source.totalShipmentAmountBTR, source.RecurringBilling,
        source.ContractDetailOverview, source.lscBatchNo, source.lscStoreNo, source.lscPOSID, source.lscPostingTime,
        source.lscNotShowDialog, source.lscSalesType, source.lscPOSComment, source.lscRetailStatus,
        source.lscReceivingPickingNo, source.lscCustomerOrderID, source.lscStatementNo, source.lscMemberCardNo,
        source.lscActivityGroupNo, source.lscActivityReservationNo, source.lscActivityNo,
        source.lscFranchiseSingleShip, source.lscCOShipOrder, source.ShpfyOrderId, source.ShpfyOrderNo_,
        source.ShpfyRefundId, source.amount, source.amountIncludingVAT, source.amtShipNotInvLCY,
        source.amtShipNotInvLCYBase, source.comment, source.completelyShipped, source.documentPostedDateBTR,
        source.gp, source.invDiscountAmountBTR, source.invoiceDiscountAmount, source.lastEmailSentMessageId,
        source.lastEmailSentTime, source.lastShipmentDate, source.lateOrderShipping, source.noOfArchivedVersions,
        source.outstandingQuantityBTR, source.qtyPickedBTR, source.quantityBTR, source.quantityInvoicedBTR,
        source.quantityShippedBTR, source.recalculateInvoiceDisc, source.shipped, source.shippedNotInvoiced,
        source.whseActivityNoBTR, source.whseShipmentDateBTR, source.systemId, source.systemCreatedAt,
        source.systemCreatedBy, source.systemModifiedAt, source.systemModifiedBy
    );
     END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_SALESLINE()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
    MERGE INTO fco.silver.factSalesLine AS target
    USING fco.staging.stgSalesLine AS source
    ON target.CompanyName = source.CompanyName
       AND target.documentType = source.documentType
       AND target.documentNo = source.documentNo
       AND target.lineNo = source.lineNo

    -- Update existing records
    WHEN MATCHED AND source.systemRowVersion > target.systemRowVersion THEN
        UPDATE SET
            target.systemRowVersion = source.systemRowVersion,
            target.sellToCustomerNo = source.sellToCustomerNo,
            target.type = source.type,
            target.no = source.no,
            target.locationCode = source.locationCode,
            target.postingGroup = source.postingGroup,
            target.shipmentDate = source.shipmentDate,
            target.description = source.description,
            target.description2 = source.description2,
            target.unitOfMeasure = source.unitOfMeasure,
            target.quantity = source.quantity,
            target.outstandingQuantity = source.outstandingQuantity,
            target.qtyToInvoice = source.qtyToInvoice,
            target.qtyToShip = source.qtyToShip,
            target.unitPrice = source.unitPrice,
            target.unitCostLCY = source.unitCostLCY,
            target.vat = source.vat,
            target.lineDiscount = source.lineDiscount,
            target.lineDiscountAmount = source.lineDiscountAmount,
            target.amount = source.amount,
            target.amountIncludingVAT = source.amountIncludingVAT,
            target.allowInvoiceDisc = source.allowInvoiceDisc,
            target.grossWeight = source.grossWeight,
            target.netWeight = source.netWeight,
            target.unitVolume = source.unitVolume,
            target.applToItemEntry = source.applToItemEntry,
            target.shortcutDimension1Code = source.shortcutDimension1Code,
            target.shortcutDimension2Code = source.shortcutDimension2Code,
            target.customerPriceGroup = source.customerPriceGroup,
            target.jobNo = source.jobNo,
            target.workTypeCode = source.workTypeCode,
            target.recalculateInvoiceDisc = source.recalculateInvoiceDisc,
            target.outstandingAmount = source.outstandingAmount,
            target.qtyShippedNotInvoiced = source.qtyShippedNotInvoiced,
            target.shippedNotInvoiced = source.shippedNotInvoiced,
            target.quantityShipped = source.quantityShipped,
            target.quantityInvoiced = source.quantityInvoiced,
            target.shipmentNo = source.shipmentNo,
            target.shipmentLineNo = source.shipmentLineNo,
            target.profit = source.profit,
            target.billToCustomerNo = source.billToCustomerNo,
            target.invDiscountAmount = source.invDiscountAmount,
            target.purchaseOrderNo = source.purchaseOrderNo,
            target.purchOrderLineNo = source.purchOrderLineNo,
            target.dropShipment = source.dropShipment,
            target.genBusPostingGroup = source.genBusPostingGroup,
            target.genProdPostingGroup = source.genProdPostingGroup,
            target.vatCalculationType = source.vatCalculationType,
            target.transactionType = source.transactionType,
            target.transportMethod = source.transportMethod,
            target.attachedToLineNo = source.attachedToLineNo,
            target.exitPoint = source.exitPoint,
            target.area = source.area,
            target.transactionSpecification = source.transactionSpecification,
            target.taxCategory = source.taxCategory,
            target.taxAreaCode = source.taxAreaCode,
            target.taxLiable = source.taxLiable,
            target.taxGroupCode = source.taxGroupCode,
            target.vatClauseCode = source.vatClauseCode,
            target.vatBusPostingGroup = source.vatBusPostingGroup,
            target.vatProdPostingGroup = source.vatProdPostingGroup,
            target.currencyCode = source.currencyCode,
            target.outstandingAmountLCY = source.outstandingAmountLCY,
            target.shippedNotInvoicedLCY = source.shippedNotInvoicedLCY,
            target.shippedNotInvLCYNoVAT = source.shippedNotInvLCYNoVAT,
            target.reserve = source.reserve,
            target.blanketOrderNo = source.blanketOrderNo,
            target.blanketOrderLineNo = source.blanketOrderLineNo,
            target.vatBaseAmount = source.vatBaseAmount,
            target.unitCost = source.unitCost,
            target.systemCreatedEntry = source.systemCreatedEntry,
            target.lineAmount = source.lineAmount,
            target.vatDifference = source.vatDifference,
            target.invDiscAmountToInvoice = source.invDiscAmountToInvoice,
            target.vatIdentifier = source.vatIdentifier,
            target.icPartnerRefType = source.icPartnerRefType,
            target.icPartnerReference = source.icPartnerReference,
            target.prepayment = source.prepayment,
            target.prepmtLineAmount = source.prepmtLineAmount,
            target.prepmtAmtInv = source.prepmtAmtInv,
            target.prepmtAmtInclVAT = source.prepmtAmtInclVAT,
            target.prepaymentAmount = source.prepaymentAmount,
            target.prepmtVATBaseAmt = source.prepmtVATBaseAmt,
            target.prepaymentVAT = source.prepaymentVAT,
            target.prepmtVATCalcType = source.prepmtVATCalcType,
            target.prepaymentVATIdentifier = source.prepaymentVATIdentifier,
            target.prepaymentTaxAreaCode = source.prepaymentTaxAreaCode,
            target.prepaymentTaxLiable = source.prepaymentTaxLiable,
            target.prepaymentTaxGroupCode = source.prepaymentTaxGroupCode,
            target.prepmtAmtToDeduct = source.prepmtAmtToDeduct,
            target.prepmtAmtDeducted = source.prepmtAmtDeducted,
            target.prepaymentLine = source.prepaymentLine,
            target.prepmtAmountInvInclVAT = source.prepmtAmountInvInclVAT,
            target.prepmtAmountInvLCY = source.prepmtAmountInvLCY,
            target.icPartnerCode = source.icPartnerCode,
            target.prepmtVATAmountInvLCY = source.prepmtVATAmountInvLCY,
            target.prepaymentVATDifference = source.prepaymentVATDifference,
            target.prepmtVATDiffToDeduct = source.prepmtVATDiffToDeduct,
            target.prepmtVATDiffDeducted = source.prepmtVATDiffDeducted,
            target.icItemReferenceNo = source.icItemReferenceNo,
            target.pmtDiscountAmount = source.pmtDiscountAmount,
            target.prepmtPmtDiscountAmount = source.prepmtPmtDiscountAmount,
            target.lineDiscountCalculation = source.lineDiscountCalculation,
            target.dimensionSetID = source.dimensionSetID,
            target.qtyToAssembleToOrder = source.qtyToAssembleToOrder,
            target.qtyToAsmToOrderBase = source.qtyToAsmToOrderBase,
            target.jobTaskNo = source.jobTaskNo,
            target.jobContractEntryNo = source.jobContractEntryNo,
            target.deferralCode = source.deferralCode,
            target.returnsDeferralStartDate = source.returnsDeferralStartDate,
            target.selectedAllocAccountNo = source.selectedAllocAccountNo,
            target.allocationAccountNo = source.allocationAccountNo,
            target.variantCode = source.variantCode,
            target.binCode = source.binCode,
            target.qtyPerUnitOfMeasure = source.qtyPerUnitOfMeasure,
            target.planned = source.planned,
            target.qtyRoundingPrecision = source.qtyRoundingPrecision,
            target.qtyRoundingPrecisionBase = source.qtyRoundingPrecisionBase,
            target.unitOfMeasureCode = source.unitOfMeasureCode,
            target.quantityBase = source.quantityBase,
            target.outstandingQtyBase = source.outstandingQtyBase,
            target.qtyToInvoiceBase = source.qtyToInvoiceBase,
            target.qtyToShipBase = source.qtyToShipBase,
            target.qtyShippedNotInvdBase = source.qtyShippedNotInvdBase,
            target.qtyShippedBase = source.qtyShippedBase,
            target.qtyInvoicedBase = source.qtyInvoicedBase,
            target.faPostingDate = source.faPostingDate,
            target.depreciationBookCode = source.depreciationBookCode,
            target.deprUntilFAPostingDate = source.deprUntilFAPostingDate,
            target.duplicateInDepreciationBook = source.duplicateInDepreciationBook,
            target.useDuplicationList = source.useDuplicationList,
            target.responsibilityCenter = source.responsibilityCenter,
            target.outOfStockSubstitution = source.outOfStockSubstitution,
            target.originallyOrderedNo = source.originallyOrderedNo,
            target.originallyOrderedVarCode = source.originallyOrderedVarCode,
            target.itemReferenceNo = source.itemReferenceNo,
            target.itemReferenceUnitOfMeasure = source.itemReferenceUnitOfMeasure,
            target.itemReferenceType = source.itemReferenceType,
            target.itemReferenceTypeNo = source.itemReferenceTypeNo,
            target.itemCategoryCode = source.itemCategoryCode,
            target.nonstock = source.nonstock,
            target.purchasingCode = source.purchasingCode,
            target.productGroupCode = source.productGroupCode,
            target.specialOrder = source.specialOrder,
            target.specialOrderPurchaseNo = source.specialOrderPurchaseNo,
            target.specialOrderPurchLineNo = source.specialOrderPurchLineNo,
            target.completelyShipped = source.completelyShipped,
            target.requestedDeliveryDate = source.requestedDeliveryDate,
            target.promisedDeliveryDate = source.promisedDeliveryDate,
            target.shippingTime = source.shippingTime,
            target.outboundWhseHandlingTime = source.outboundWhseHandlingTime,
            target.plannedDeliveryDate = source.plannedDeliveryDate,
            target.plannedShipmentDate = source.plannedShipmentDate,
            target.shippingAgentCode = source.shippingAgentCode,
            target.shippingAgentServiceCode = source.shippingAgentServiceCode,
            target.allowItemChargeAssignment = source.allowItemChargeAssignment,
            target.returnQtyToReceive = source.returnQtyToReceive,
            target.returnQtyToReceiveBase = source.returnQtyToReceiveBase,
            target.returnQtyRcdNotInvd = source.returnQtyRcdNotInvd,
            target.retQtyRcdNotInvdBase = source.retQtyRcdNotInvdBase,
            target.returnRcdNotInvd = source.returnRcdNotInvd,
            target.returnRcdNotInvdLCY = source.returnRcdNotInvdLCY,
            target.returnQtyReceived = source.returnQtyReceived,
            target.returnQtyReceivedBase = source.returnQtyReceivedBase,
            target.applFromItemEntry = source.applFromItemEntry,
            target.bomItemNo = source.bomItemNo,
            target.returnReceiptNo = source.returnReceiptNo,
            target.returnReceiptLineNo = source.returnReceiptLineNo,
            target.returnReasonCode = source.returnReasonCode,
            target.copiedFromPostedDoc = source.copiedFromPostedDoc,
            target.priceCalculationMethod = source.priceCalculationMethod,
            target.allowLineDisc = source.allowLineDisc,
            target.customerDiscGroup = source.customerDiscGroup,
            target.subtype = source.subtype,
            target.priceDescription = source.priceDescription,
            target.stockOnHandBTR = source.stockOnHandBTR,
            target.differenceBTR = source.differenceBTR,
            target.vendorItemNoBTR = source.vendorItemNoBTR,
            target.hasLinkedItem = source.hasLinkedItem,
            target.inQCBTR = source.inQCBTR,
            target.wcProductIdBTR = source.wcProductIdBTR,
            target.wcVariationIdBTR = source.wcVariationIdBTR,
            target.wcSkuBTR = source.wcSkuBTR,
            target.wcSubtotalBTR = source.wcSubtotalBTR,
            target.wcSubtotalTaxBTR = source.wcSubtotalTaxBTR,
            target.wcTotalBTR = source.wcTotalBTR,
            target.wcTotalTaxBTR = source.wcTotalTaxBTR,
            target.wcPriceBTR = source.wcPriceBTR,
            target.sourceLastModifiedUserBTR = source.sourceLastModifiedUserBTR,
            target.colourBTR = source.colourBTR,
            target.sizeBTR = source.sizeBTR,
            target.variantDimUpdatedBTR = source.variantDimUpdatedBTR,
            target.btrwfMarginPct = source.btrwfMarginPct,
            target.btrwfBelowMargin = source.btrwfBelowMargin,
            target.recurringBillingFrom = source.recurringBillingFrom,
            target.recurringBillingTo = source.recurringBillingTo,
            target.discount = source.discount,
            target.excludeFromDocTotal = source.excludeFromDocTotal,
            target.lscCollectionItemNo = source.lscCollectionItemNo,
            target.lscCollectionLineNo = source.lscCollectionLineNo,
            target.lscRetailProductCode = source.lscRetailProductCode,
            target.lscDivision = source.lscDivision,
            target.lscOfferNo = source.lscOfferNo,
            target.lscPromotionNo = source.lscPromotionNo,
            target.lscAllocPlanPurcOrderNo = source.lscAllocPlanPurcOrderNo,
            target.lscVendorNo = source.lscVendorNo,
            target.lscCustomerOrderID = source.lscCustomerOrderID,
            target.lscCustomerOrderLineNo = source.lscCustomerOrderLineNo,
            target.lscCustomerOrderDisc = source.lscCustomerOrderDisc,
            target.shpfyOrderLineId = source.shpfyOrderLineId,
            target.shpfyOrderNo = source.shpfyOrderNo,
            target.shpfyRefundId = source.shpfyRefundId,
            target.shpfyRefundLineId = source.shpfyRefundLineId,
            target.systemId = source.systemId,
            target.systemCreatedAt = source.systemCreatedAt,
            target.systemCreatedBy = source.systemCreatedBy,
            target.systemModifiedAt = source.systemModifiedAt,
            target.systemModifiedBy = source.systemModifiedBy,
            target.atoWhseOutstandingQty = source.atoWhseOutstandingQty,
            target.atoWhseOutstdQtyBase = source.atoWhseOutstdQtyBase,
            target.allocAccModifiedByUser = source.allocAccModifiedByUser,
            target.attachedDocCount = source.attachedDocCount,
            target.attachedLinesCount = source.attachedLinesCount,
            target.itemChargeQtyToHandle = source.itemChargeQtyToHandle,
            target.qtyAssigned = source.qtyAssigned,
            target.qtyToAssign = source.qtyToAssign,
            target.reservedQuantity = source.reservedQuantity,
            target.reservedQtyBase = source.reservedQtyBase,
            target.statusBTR = source.statusBTR,
            target.substitutionAvailable = source.substitutionAvailable,
            target.whseOutstandingQty = source.whseOutstandingQty,
            target.whseOutstandingQtyBase = source.whseOutstandingQtyBase,
            target.postingDate = source.postingDate,
            target.unitsPerParcel = source.unitsPerParcel

    -- Insert new records
    WHEN NOT MATCHED   THEN
        INSERT (
            CompanyName, systemRowVersion, documentType, documentNo, lineNo, sellToCustomerNo, type, no,
            locationCode, postingGroup, shipmentDate, description, description2, unitOfMeasure, quantity,
            outstandingQuantity, qtyToInvoice, qtyToShip, unitPrice, unitCostLCY, vat, lineDiscount,
            lineDiscountAmount, amount, amountIncludingVAT, allowInvoiceDisc, grossWeight, netWeight,
            unitVolume, applToItemEntry, shortcutDimension1Code, shortcutDimension2Code, customerPriceGroup,
            jobNo, workTypeCode, recalculateInvoiceDisc, outstandingAmount, qtyShippedNotInvoiced,
            shippedNotInvoiced, quantityShipped, quantityInvoiced, shipmentNo, shipmentLineNo, profit,
            billToCustomerNo, invDiscountAmount, purchaseOrderNo, purchOrderLineNo, dropShipment,
            genBusPostingGroup, genProdPostingGroup, vatCalculationType, transactionType, transportMethod,
            attachedToLineNo, exitPoint, area, transactionSpecification, taxCategory, taxAreaCode, taxLiable,
            taxGroupCode, vatClauseCode, vatBusPostingGroup, vatProdPostingGroup, currencyCode,
            outstandingAmountLCY, shippedNotInvoicedLCY, shippedNotInvLCYNoVAT, reserve, blanketOrderNo,
            blanketOrderLineNo, vatBaseAmount, unitCost, systemCreatedEntry, lineAmount, vatDifference,
            invDiscAmountToInvoice, vatIdentifier, icPartnerRefType, icPartnerReference, prepayment,
            prepmtLineAmount, prepmtAmtInv, prepmtAmtInclVAT, prepaymentAmount, prepmtVATBaseAmt,
            prepaymentVAT, prepmtVATCalcType, prepaymentVATIdentifier, prepaymentTaxAreaCode,
            prepaymentTaxLiable, prepaymentTaxGroupCode, prepmtAmtToDeduct, prepmtAmtDeducted,
            prepaymentLine, prepmtAmountInvInclVAT, prepmtAmountInvLCY, icPartnerCode,
            prepmtVATAmountInvLCY, prepaymentVATDifference, prepmtVATDiffToDeduct, prepmtVATDiffDeducted,
            icItemReferenceNo, pmtDiscountAmount, prepmtPmtDiscountAmount, lineDiscountCalculation,
            dimensionSetID, qtyToAssembleToOrder, qtyToAsmToOrderBase, jobTaskNo, jobContractEntryNo,
            deferralCode, returnsDeferralStartDate, selectedAllocAccountNo, allocationAccountNo, variantCode,
            binCode, qtyPerUnitOfMeasure, planned, qtyRoundingPrecision, qtyRoundingPrecisionBase,
            unitOfMeasureCode, quantityBase, outstandingQtyBase, qtyToInvoiceBase, qtyToShipBase,
            qtyShippedNotInvdBase, qtyShippedBase, qtyInvoicedBase, faPostingDate, depreciationBookCode,
            deprUntilFAPostingDate, duplicateInDepreciationBook, useDuplicationList, responsibilityCenter,
            outOfStockSubstitution, originallyOrderedNo, originallyOrderedVarCode, itemReferenceNo,
            itemReferenceUnitOfMeasure, itemReferenceType, itemReferenceTypeNo, itemCategoryCode, nonstock,
            purchasingCode, productGroupCode, specialOrder, specialOrderPurchaseNo, specialOrderPurchLineNo,
            completelyShipped, requestedDeliveryDate, promisedDeliveryDate, shippingTime,
            outboundWhseHandlingTime, plannedDeliveryDate, plannedShipmentDate, shippingAgentCode,
            shippingAgentServiceCode, allowItemChargeAssignment, returnQtyToReceive, returnQtyToReceiveBase,
            returnQtyRcdNotInvd, retQtyRcdNotInvdBase, returnRcdNotInvd, returnRcdNotInvdLCY,
            returnQtyReceived, returnQtyReceivedBase, applFromItemEntry, bomItemNo, returnReceiptNo,
            returnReceiptLineNo, returnReasonCode, copiedFromPostedDoc, priceCalculationMethod,
            allowLineDisc, customerDiscGroup, subtype, priceDescription, stockOnHandBTR, differenceBTR,
            vendorItemNoBTR, hasLinkedItem, inQCBTR, wcProductIdBTR, wcVariationIdBTR, wcSkuBTR,
            wcSubtotalBTR, wcSubtotalTaxBTR, wcTotalBTR, wcTotalTaxBTR, wcPriceBTR,
            sourceLastModifiedUserBTR, colourBTR, sizeBTR, variantDimUpdatedBTR, btrwfMarginPct,
            btrwfBelowMargin, recurringBillingFrom, recurringBillingTo, discount, excludeFromDocTotal,
            lscCollectionItemNo, lscCollectionLineNo, lscRetailProductCode, lscDivision, lscOfferNo,
            lscPromotionNo, lscAllocPlanPurcOrderNo, lscVendorNo, lscCustomerOrderID,
            lscCustomerOrderLineNo, lscCustomerOrderDisc, shpfyOrderLineId, shpfyOrderNo, shpfyRefundId,
            shpfyRefundLineId, systemId, systemCreatedAt, systemCreatedBy, systemModifiedAt,
            systemModifiedBy, atoWhseOutstandingQty, atoWhseOutstdQtyBase, allocAccModifiedByUser,
            attachedDocCount, attachedLinesCount, itemChargeQtyToHandle, qtyAssigned, qtyToAssign,
            reservedQuantity, reservedQtyBase, statusBTR, substitutionAvailable, whseOutstandingQty,
            whseOutstandingQtyBase, postingDate, unitsPerParcel
        )
        VALUES (
            source.CompanyName, source.systemRowVersion, source.documentType, source.documentNo, source.lineNo,
            source.sellToCustomerNo, source.type, source.no, source.locationCode, source.postingGroup,
            source.shipmentDate, source.description, source.description2, source.unitOfMeasure, source.quantity,
            source.outstandingQuantity, source.qtyToInvoice, source.qtyToShip, source.unitPrice, source.unitCostLCY,
            source.vat, source.lineDiscount, source.lineDiscountAmount, source.amount, source.amountIncludingVAT,
            source.allowInvoiceDisc, source.grossWeight, source.netWeight, source.unitVolume, source.applToItemEntry,
            source.shortcutDimension1Code, source.shortcutDimension2Code, source.customerPriceGroup, source.jobNo,
            source.workTypeCode, source.recalculateInvoiceDisc, source.outstandingAmount, source.qtyShippedNotInvoiced,
            source.shippedNotInvoiced, source.quantityShipped, source.quantityInvoiced, source.shipmentNo,
            source.shipmentLineNo, source.profit, source.billToCustomerNo, source.invDiscountAmount,
            source.purchaseOrderNo, source.purchOrderLineNo, source.dropShipment, source.genBusPostingGroup,
            source.genProdPostingGroup, source.vatCalculationType, source.transactionType, source.transportMethod,
            source.attachedToLineNo, source.exitPoint, source.area, source.transactionSpecification, source.taxCategory,
            source.taxAreaCode, source.taxLiable, source.taxGroupCode, source.vatClauseCode, source.vatBusPostingGroup,
            source.vatProdPostingGroup, source.currencyCode, source.outstandingAmountLCY, source.shippedNotInvoicedLCY,
            source.shippedNotInvLCYNoVAT, source.reserve, source.blanketOrderNo, source.blanketOrderLineNo,
            source.vatBaseAmount, source.unitCost, source.systemCreatedEntry, source.lineAmount, source.vatDifference,
            source.invDiscAmountToInvoice, source.vatIdentifier, source.icPartnerRefType, source.icPartnerReference,
            source.prepayment, source.prepmtLineAmount, source.prepmtAmtInv, source.prepmtAmtInclVAT,
            source.prepaymentAmount, source.prepmtVATBaseAmt, source.prepaymentVAT, source.prepmtVATCalcType,
            source.prepaymentVATIdentifier, source.prepaymentTaxAreaCode, source.prepaymentTaxLiable,
            source.prepaymentTaxGroupCode, source.prepmtAmtToDeduct, source.prepmtAmtDeducted, source.prepaymentLine,
            source.prepmtAmountInvInclVAT, source.prepmtAmountInvLCY, source.icPartnerCode, source.prepmtVATAmountInvLCY,
            source.prepaymentVATDifference, source.prepmtVATDiffToDeduct, source.prepmtVATDiffDeducted,
            source.icItemReferenceNo, source.pmtDiscountAmount, source.prepmtPmtDiscountAmount,
            source.lineDiscountCalculation, source.dimensionSetID, source.qtyToAssembleToOrder,
            source.qtyToAsmToOrderBase, source.jobTaskNo, source.jobContractEntryNo, source.deferralCode,
            source.returnsDeferralStartDate, source.selectedAllocAccountNo, source.allocationAccountNo,
            source.variantCode, source.binCode, source.qtyPerUnitOfMeasure, source.planned, source.qtyRoundingPrecision,
            source.qtyRoundingPrecisionBase, source.unitOfMeasureCode, source.quantityBase, source.outstandingQtyBase,
            source.qtyToInvoiceBase, source.qtyToShipBase, source.qtyShippedNotInvdBase, source.qtyShippedBase,
            source.qtyInvoicedBase, source.faPostingDate, source.depreciationBookCode, source.deprUntilFAPostingDate,
            source.duplicateInDepreciationBook, source.useDuplicationList, source.responsibilityCenter,
            source.outOfStockSubstitution, source.originallyOrderedNo, source.originallyOrderedVarCode,
            source.itemReferenceNo, source.itemReferenceUnitOfMeasure, source.itemReferenceType,
            source.itemReferenceTypeNo, source.itemCategoryCode, source.nonstock, source.purchasingCode,
            source.productGroupCode, source.specialOrder, source.specialOrderPurchaseNo, source.specialOrderPurchLineNo,
            source.completelyShipped, source.requestedDeliveryDate, source.promisedDeliveryDate, source.shippingTime,
            source.outboundWhseHandlingTime, source.plannedDeliveryDate, source.plannedShipmentDate,
            source.shippingAgentCode, source.shippingAgentServiceCode, source.allowItemChargeAssignment,
            source.returnQtyToReceive, source.returnQtyToReceiveBase, source.returnQtyRcdNotInvd,
            source.retQtyRcdNotInvdBase, source.returnRcdNotInvd, source.returnRcdNotInvdLCY,
            source.returnQtyReceived, source.returnQtyReceivedBase, source.applFromItemEntry, source.bomItemNo,
            source.returnReceiptNo, source.returnReceiptLineNo, source.returnReasonCode, source.copiedFromPostedDoc,
            source.priceCalculationMethod, source.allowLineDisc, source.customerDiscGroup, source.subtype,
            source.priceDescription, source.stockOnHandBTR, source.differenceBTR, source.vendorItemNoBTR,
            source.hasLinkedItem, source.inQCBTR, source.wcProductIdBTR, source.wcVariationIdBTR, source.wcSkuBTR,
            source.wcSubtotalBTR, source.wcSubtotalTaxBTR, source.wcTotalBTR, source.wcTotalTaxBTR,
            source.wcPriceBTR, source.sourceLastModifiedUserBTR, source.colourBTR, source.sizeBTR,
            source.variantDimUpdatedBTR, source.btrwfMarginPct, source.btrwfBelowMargin, source.recurringBillingFrom,
            source.recurringBillingTo, source.discount, source.excludeFromDocTotal, source.lscCollectionItemNo,
            source.lscCollectionLineNo, source.lscRetailProductCode, source.lscDivision, source.lscOfferNo,
            source.lscPromotionNo, source.lscAllocPlanPurcOrderNo, source.lscVendorNo, source.lscCustomerOrderID,
            source.lscCustomerOrderLineNo, source.lscCustomerOrderDisc, source.shpfyOrderLineId, source.shpfyOrderNo,
            source.shpfyRefundId, source.shpfyRefundLineId, source.systemId, source.systemCreatedAt,
            source.systemCreatedBy, source.systemModifiedAt, source.systemModifiedBy, source.atoWhseOutstandingQty,
            source.atoWhseOutstdQtyBase, source.allocAccModifiedByUser, source.attachedDocCount,
            source.attachedLinesCount, source.itemChargeQtyToHandle, source.qtyAssigned, source.qtyToAssign,
            source.reservedQuantity, source.reservedQtyBase, source.statusBTR, source.substitutionAvailable,
            source.whseOutstandingQty, source.whseOutstandingQtyBase, source.postingDate, source.unitsPerParcel
        )

    -- Delete records not in source
 ;     END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_SALESPRICE()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
   MERGE INTO fco.silver.factSalesPrice AS target
        USING fco.staging.stgSalesPrice AS source
        ON target.CompanyName = source.CompanyName
           AND target.itemNo = source.itemNo
           AND target.salesType = source.salesType
           AND target.salesCode = source.salesCode
           AND target.startingDate = source.startingDate
           AND target.currencyCode = source.currencyCode
           AND target.variantCode = source.variantCode
           AND target.unitOfMeasureCode = source.unitOfMeasureCode
           AND target.minimumQuantity = source.minimumQuantity
 
        -- Update existing records
        WHEN MATCHED THEN
            UPDATE SET
                target.SystemRowVersion = source.SystemRowVersion,
                target.unitPrice = source.unitPrice,
                target.priceIncludesVAT = source.priceIncludesVAT,
                target.allowInvoiceDisc = source.allowInvoiceDisc,
                target.vatBusPostingGrPrice = source.vatBusPostingGrPrice,
                target.endingDate = source.endingDate,
                target.allowLineDisc = source.allowLineDisc,
                target.coupledToDataverse = source.coupledToDataverse,
                target.onMarkdown = source.onMarkdown,
                target.OfferItemNo_ = source.OfferItemNo_,
                target.OfferQuantity = source.OfferQuantity,
                target.OfferUnitPrice = source.OfferUnitPrice,
                target.Min_OrderAmountExcl_ = source.Min_OrderAmountExcl_,
                target.lscMarkup = source.lscMarkup,
                target.lscProfit = source.lscProfit,
                target.LSCProfitLCY = source.LSCProfitLCY,
                target.lscUnitPriceIncludingVAT = source.lscUnitPriceIncludingVAT,
                target.markDownDate = source.markDownDate,
                target.systemId = source.systemId,
                target.systemCreatedAt = source.systemCreatedAt,
                target.systemCreatedBy = source.systemCreatedBy,
                target.systemModifiedAt = source.systemModifiedAt,
                target.systemModifiedBy = source.systemModifiedBy,
                target.CoupledtoCRM = source.CoupledtoCRM

        -- Insert new records
        WHEN NOT MATCHED  THEN
            INSERT (
                CompanyName, SystemRowVersion, itemNo, salesType, salesCode,
                startingDate, currencyCode, variantCode, unitOfMeasureCode,
                minimumQuantity, unitPrice, priceIncludesVAT, allowInvoiceDisc,
                vatBusPostingGrPrice, endingDate, allowLineDisc, coupledToDataverse,
                onMarkdown, OfferItemNo_, OfferQuantity, OfferUnitPrice,
                Min_OrderAmountExcl_, lscMarkup, lscProfit, LSCProfitLCY,
                lscUnitPriceIncludingVAT, markDownDate, systemId,
                systemCreatedAt, systemCreatedBy, systemModifiedAt, systemModifiedBy,
                CoupledtoCRM
            )
            VALUES (
                source.CompanyName, source.SystemRowVersion, source.itemNo,
                source.salesType, source.salesCode, source.startingDate,
                source.currencyCode, source.variantCode, source.unitOfMeasureCode,
                source.minimumQuantity, source.unitPrice, source.priceIncludesVAT,
                source.allowInvoiceDisc, source.vatBusPostingGrPrice, source.endingDate,
                source.allowLineDisc, source.coupledToDataverse, source.onMarkdown,
                source.OfferItemNo_, source.OfferQuantity, source.OfferUnitPrice,
                source.Min_OrderAmountExcl_, source.lscMarkup, source.lscProfit,
                source.LSCProfitLCY, source.lscUnitPriceIncludingVAT,
                source.markDownDate, source.systemId, source.systemCreatedAt,
                source.systemCreatedBy, source.systemModifiedAt, source.systemModifiedBy,
                source.CoupledtoCRM
            );
      END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_STORELOCATIONS()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN   
  MERGE INTO fco.silver.dimStoreLocation AS target
USING fco.staging.stgStoreLocation AS source
ON target.CompanyName = source.CompanyName
AND target.Store_No_ = source.Store_No_
AND target.Location_Code = source.Location_Code

WHEN MATCHED AND (
    target.SystemRowVersion <> source.SystemRowVersion
    OR target.Store_Name <> source.Store_Name
    OR target.Location_Name <> source.Location_Name
    OR ifnull(target.Sales_Location, '''') <> ifnull(source.Sales_Location, '''')
    OR ifnull(target.Special_Order_Location, '''') <> ifnull(source.Special_Order_Location, '''')
    OR ifnull(target.Layaway_Location, '''') <> ifnull(source.Layaway_Location, '''')
    OR ifnull(target.Claim_Location, '''') <> ifnull(source.Claim_Location, '''')
    OR ifnull(target.BTR_Laybuy_Location, '''') <> ifnull(source.BTR_Laybuy_Location, '''')
    OR ifnull(target.SystemId, ''00000000-0000-0000-0000-000000000000'') <> ifnull(source.SystemId, ''00000000-0000-0000-0000-000000000000'')
    OR ifnull(target.SystemCreatedAt, ''1900-01-01'') <> ifnull(source.SystemCreatedAt, ''1900-01-01'')
    OR ifnull(target.SystemCreatedBy, ''00000000-0000-0000-0000-000000000000'') <> ifnull(source.SystemCreatedBy, ''00000000-0000-0000-0000-000000000000'')
    OR ifnull(target.SystemModifiedAt, ''1900-01-01'') <> ifnull(source.SystemModifiedAt, ''1900-01-01'')
    OR ifnull(target.SystemModifiedBy, ''00000000-0000-0000-0000-000000000000'') <> ifnull(source.SystemModifiedBy, ''00000000-0000-0000-0000-000000000000'')
) THEN
    UPDATE SET
        target.SystemRowVersion = source.SystemRowVersion,
        target.Store_Name = source.Store_Name,
        target.Location_Name = source.Location_Name,
        target.Sales_Location = source.Sales_Location,
        target.Special_Order_Location = source.Special_Order_Location,
        target.Layaway_Location = source.Layaway_Location,
        target.Claim_Location = source.Claim_Location,
        target.BTR_Laybuy_Location = source.BTR_Laybuy_Location,
        target.SystemId = source.SystemId,
        target.SystemCreatedAt = source.SystemCreatedAt,
        target.SystemCreatedBy = source.SystemCreatedBy,
        target.SystemModifiedAt = source.SystemModifiedAt,
        target.SystemModifiedBy = source.SystemModifiedBy

WHEN NOT MATCHED   THEN
    INSERT (
        CompanyName,
        SystemRowVersion,
        Store_No_,
        Store_Name,
        Location_Code,
        Location_Name,
        Sales_Location,
        Special_Order_Location,
        Layaway_Location,
        Claim_Location,
        BTR_Laybuy_Location,
        SystemId,
        SystemCreatedAt,
        SystemCreatedBy,
        SystemModifiedAt,
        SystemModifiedBy
    )
    VALUES (
        source.CompanyName,
        source.SystemRowVersion,
        source.Store_No_,
        source.Store_Name,
        source.Location_Code,
        source.Location_Name,
        source.Sales_Location,
        source.Special_Order_Location,
        source.Layaway_Location,
        source.Claim_Location,
        source.BTR_Laybuy_Location,
        source.SystemId,
        source.SystemCreatedAt,
        source.SystemCreatedBy,
        source.SystemModifiedAt,
        source.SystemModifiedBy
    );
    END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_TRANSFERHEADERS()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
MERGE into fco.silver.factTransferHeader AS T
USING fco.staging.stgTransferHeader AS S
        ON T.CompanyName = S.CompanyName AND T.no = S.no

        WHEN MATCHED THEN
            UPDATE SET
                T.SystemRowVersion = S.SystemRowVersion,
                T.transferFromCode = S.transferFromCode,
                T.transferFromName = S.transferFromName,
                T.transferFromName2 = S.transferFromName2,
                T.transferFromAddress = S.transferFromAddress,
                T.transferFromAddress2 = S.transferFromAddress2,
                T.transferFromPostCode = S.transferFromPostCode,
                T.transferFromCity = S.transferFromCity,
                T.transferFromCounty = S.transferFromCounty,
                T.trsfFromCountryRegionCode = S.trsfFromCountryRegionCode,
                T.transferToCode = S.transferToCode,
                T.transferToName = S.transferToName,
                T.transferToName2 = S.transferToName2,
                T.transferToAddress = S.transferToAddress,
                T.transferToAddress2 = S.transferToAddress2,
                T.transferToPostCode = S.transferToPostCode,
                T.transferToCity = S.transferToCity,
                T.transferToCounty = S.transferToCounty,
                T.trsfToCountryRegionCode = S.trsfToCountryRegionCode,
                T.postingDate = S.postingDate,
                T.shipmentDate = S.shipmentDate,
                T.receiptDate = S.receiptDate,
                T.status = S.status,
                T.shortcutDimension1Code = S.shortcutDimension1Code,
                T.shortcutDimension2Code = S.shortcutDimension2Code,
                T.inTransitCode = S.inTransitCode,
                T.noSeries = S.noSeries,
                T.lastShipmentNo = S.lastShipmentNo,
                T.lastReceiptNo = S.lastReceiptNo,
                T.transferFromContact = S.transferFromContact,
                T.transferToContact = S.transferToContact,
                T.externalDocumentNo = S.externalDocumentNo,
                T.shippingAgentCode = S.shippingAgentCode,
                T.shippingAgentServiceCode = S.shippingAgentServiceCode,
                T.shippingTime = S.shippingTime,
                T.shipmentMethodCode = S.shipmentMethodCode,
                T.transactionType = S.transactionType,
                T.transportMethod = S.transportMethod,
                T.partnerVATID = S.partnerVATID,
                T.entryExitPoint = S.entryExitPoint,
                T.area = S.area,
                T.transactionSpecification = S.transactionSpecification,
                T.directTransfer = S.directTransfer,
                T.dimensionSetID = S.dimensionSetID,
                T.shippingAdvice = S.shippingAdvice,
                T.postingFromWhseRef = S.postingFromWhseRef,
                T.outboundWhseHandlingTime = S.outboundWhseHandlingTime,
                T.inboundWhseHandlingTime = S.inboundWhseHandlingTime,
                T.assignedUserID = S.assignedUserID,
                T.systemId = S.systemId,
                T.systemCreatedAt = S.systemCreatedAt,
                T.systemCreatedBy = S.systemCreatedBy,
                T.systemModifiedAt = S.systemModifiedAt,
                T.systemModifiedBy = S.systemModifiedBy,
                T.brandActionRequired = S.brandActionRequired,
                T.releaseDateBTR = S.releaseDateBTR,
                T.requestedShipDateBTR = S.requestedShipDateBTR,
                T.reasonForExclusionBTR = S.reasonForExclusionBTR,
                T.excludeFromRoyaltyBTR = S.excludeFromRoyaltyBTR,
                T.overrideBlockShipmentBTR = S.overrideBlockShipmentBTR,
                T.ApprovalStatusBTR = S.ApprovalStatusBTR,
                T.importedBTR = S.importedBTR,
                T.sourceCreatedByUserBTR = S.sourceCreatedByUserBTR,
                T.sourceLastModifiedUserBTR = S.sourceLastModifiedUserBTR,
                T.wmsTransactionTypeBTR = S.wmsTransactionTypeBTR,
                T.lscStoreTo = S.lscStoreTo,
                T.lscStoreFrom = S.lscStoreFrom,
                T.lscCustomerOrderID = S.lscCustomerOrderID,
                T.lscRetailStatus = S.lscRetailStatus,
                T.lscRecivingPickingNo = S.lscRecivingPickingNo,
                T.lscRTCFilteringType = S.lscRTCFilteringType,
                T.lscBuyerID = S.lscBuyerID,
                T.lscBuyerGroupCode = S.lscBuyerGroupCode,
                T.lscCreatedBySourceCode = S.lscCreatedBySourceCode,
                T.lscTransferType = S.lscTransferType,
                T.lscNewDimensionSetID = S.lscNewDimensionSetID,
                T.lscNewShortcutDim1Code = S.lscNewShortcutDim1Code,
                T.lscNewShortcutDim2Code = S.lscNewShortcutDim2Code,
                T.comment = S.comment,
                T.completelyReceived = S.completelyReceived,
                T.completelyShipped = S.completelyShipped,
                T.documentPostedDateBTR = S.documentPostedDateBTR,
                T.hasShippedLines = S.hasShippedLines,
                T.outstandingQuantityBTR = S.outstandingQuantityBTR,
                T.qtyPickedBTR = S.qtyPickedBTR,
                T.quantityBTR = S.quantityBTR,
                T.quantityReceivedBTR = S.quantityReceivedBTR,
                T.quantityShippedBTR = S.quantityShippedBTR,
                T.storeFromNameBTR = S.storeFromNameBTR,
                T.storeToNameBTR = S.storeToNameBTR,
                T.whseActivityNoBTR = S.whseActivityNoBTR,
                T.whseReceiptDateBTR = S.whseReceiptDateBTR,
                T.whseShipmentDateBTR = S.whseShipmentDateBTR

        WHEN NOT MATCHED   THEN
            INSERT (
                CompanyName,
                SystemRowVersion,
                no,
                transferFromCode,
                transferFromName,
                transferFromName2,
                transferFromAddress,
                transferFromAddress2,
                transferFromPostCode,
                transferFromCity,
                transferFromCounty,
                trsfFromCountryRegionCode,
                transferToCode,
                transferToName,
                transferToName2,
                transferToAddress,
                transferToAddress2,
                transferToPostCode,
                transferToCity,
                transferToCounty,
                trsfToCountryRegionCode,
                postingDate,
                shipmentDate,
                receiptDate,
                status,
                shortcutDimension1Code,
                shortcutDimension2Code,
                inTransitCode,
                noSeries,
                lastShipmentNo,
                lastReceiptNo,
                transferFromContact,
                transferToContact,
                externalDocumentNo,
                shippingAgentCode,
                shippingAgentServiceCode,
                shippingTime,
                shipmentMethodCode,
                transactionType,
                transportMethod,
                partnerVATID,
                entryExitPoint,
                area,
                transactionSpecification,
                directTransfer,
                dimensionSetID,
                shippingAdvice,
                postingFromWhseRef,
                outboundWhseHandlingTime,
                inboundWhseHandlingTime,
                assignedUserID,
                systemId,
                systemCreatedAt,
                systemCreatedBy,
                systemModifiedAt,
                systemModifiedBy,
                brandActionRequired,
                releaseDateBTR,
                requestedShipDateBTR,
                reasonForExclusionBTR,
                excludeFromRoyaltyBTR,
                overrideBlockShipmentBTR,
                ApprovalStatusBTR,
                importedBTR,
                sourceCreatedByUserBTR,
                sourceLastModifiedUserBTR,
                wmsTransactionTypeBTR,
                lscStoreTo,
                lscStoreFrom,
                lscCustomerOrderID,
                lscRetailStatus,
                lscRecivingPickingNo,
                lscRTCFilteringType,
                lscBuyerID,
                lscBuyerGroupCode,
                lscCreatedBySourceCode,
                lscTransferType,
                lscNewDimensionSetID,
                lscNewShortcutDim1Code,
                lscNewShortcutDim2Code,
                comment,
                completelyReceived,
                completelyShipped,
                documentPostedDateBTR,
                hasShippedLines,
                outstandingQuantityBTR,
                qtyPickedBTR,
                quantityBTR,
                quantityReceivedBTR,
                quantityShippedBTR,
                storeFromNameBTR,
                storeToNameBTR,
                whseActivityNoBTR,
                whseReceiptDateBTR,
                whseShipmentDateBTR
            )
            VALUES (
                S.CompanyName,
                S.SystemRowVersion,
                S.no,
                S.transferFromCode,
                S.transferFromName,
                S.transferFromName2,
                S.transferFromAddress,
                S.transferFromAddress2,
                S.transferFromPostCode,
                S.transferFromCity,
                S.transferFromCounty,
                S.trsfFromCountryRegionCode,
                S.transferToCode,
                S.transferToName,
                S.transferToName2,
                S.transferToAddress,
                S.transferToAddress2,
                S.transferToPostCode,
                S.transferToCity,
                S.transferToCounty,
                S.trsfToCountryRegionCode,
                S.postingDate,
                S.shipmentDate,
                S.receiptDate,
                S.status,
                S.shortcutDimension1Code,
                S.shortcutDimension2Code,
                S.inTransitCode,
                S.noSeries,
                S.lastShipmentNo,
                S.lastReceiptNo,
                S.transferFromContact,
                S.transferToContact,
                S.externalDocumentNo,
                S.shippingAgentCode,
                S.shippingAgentServiceCode,
                S.shippingTime,
                S.shipmentMethodCode,
                S.transactionType,
                S.transportMethod,
                S.partnerVATID,
                S.entryExitPoint,
                S.area,
                S.transactionSpecification,
                S.directTransfer,
                S.dimensionSetID,
                S.shippingAdvice,
                S.postingFromWhseRef,
                S.outboundWhseHandlingTime,
                S.inboundWhseHandlingTime,
                S.assignedUserID,
                S.systemId,
                S.systemCreatedAt,
                S.systemCreatedBy,
                S.systemModifiedAt,
                S.systemModifiedBy,
                S.brandActionRequired,
                S.releaseDateBTR,
                S.requestedShipDateBTR,
                S.reasonForExclusionBTR,
                S.excludeFromRoyaltyBTR,
                S.overrideBlockShipmentBTR,
                S.ApprovalStatusBTR,
                S.importedBTR,
                S.sourceCreatedByUserBTR,
                S.sourceLastModifiedUserBTR,
                S.wmsTransactionTypeBTR,
                S.lscStoreTo,
                S.lscStoreFrom,
                S.lscCustomerOrderID,
                S.lscRetailStatus,
                S.lscRecivingPickingNo,
                S.lscRTCFilteringType,
                S.lscBuyerID,
                S.lscBuyerGroupCode,
                S.lscCreatedBySourceCode,
                S.lscTransferType,
                S.lscNewDimensionSetID,
                S.lscNewShortcutDim1Code,
                S.lscNewShortcutDim2Code,
                S.comment,
                S.completelyReceived,
                S.completelyShipped,
                S.documentPostedDateBTR,
                S.hasShippedLines,
                S.outstandingQuantityBTR,
                S.qtyPickedBTR,
                S.quantityBTR,
                S.quantityReceivedBTR,
                S.quantityShippedBTR,
                S.storeFromNameBTR,
                S.storeToNameBTR,
                S.whseActivityNoBTR,
                S.whseReceiptDateBTR,
                S.whseShipmentDateBTR
            );
    END;
';

CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_TRANSFERLINES()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
    MERGE INTO fco.silver.factTransferLine AS target
    USING fco.staging.stgTransferLine AS source
    ON target.CompanyName = source.CompanyName
    AND target.documentNo = source.documentNo
    AND target.lineNo = source.lineNo

    -- Update existing records only if source has a higher systemRowVersion
    WHEN MATCHED AND source.systemRowVersion > target.systemRowVersion THEN
        UPDATE SET
            target.systemRowVersion = source.systemRowVersion,
            target.applToItemEntry = source.applToItemEntry,
            target.barcodeBTR = source.barcodeBTR,
            target.completelyReceived = source.completelyReceived,
            target.completelyShipped = source.completelyShipped,
            target.derivedFromLineNo = source.derivedFromLineNo,
            target.description = source.description,
            target.description2 = source.description2,
            target.differenceBTR = source.differenceBTR,
            target.dimensionSetID = source.dimensionSetID,
            target.directTransfer = source.directTransfer,
            target.genProdPostingGroup = source.genProdPostingGroup,
            target.grossWeight = source.grossWeight,
            target.inTransitCode = source.inTransitCode,
            target.inQCBTR = source.inQCBTR,
            target.inboundWhseHandlingTime = source.inboundWhseHandlingTime,
            target.inventoryPostingGroup = source.inventoryPostingGroup,
            target.itemCategoryCode = source.itemCategoryCode,
            target.itemNo = source.itemNo,
            target.lscCustomerOrderID = source.lscCustomerOrderID,
            target.lscCustomerOrderLineNo = source.lscCustomerOrderLineNo,
            target.lscDivision = source.lscDivision,
            target.lscFromDimensionSetID = source.lscFromDimensionSetID,
            target.lscFromShortcutDim1Code = source.lscFromShortcutDim1Code,
            target.lscFromShortcutDim2Code = source.lscFromShortcutDim2Code,
            target.lscPurchaseOrderNo = source.lscPurchaseOrderNo,
            target.lscReasonCode = source.lscReasonCode,
            target.lscReceivingFromPOS = source.lscReceivingFromPOS,
            target.lscRetailProductCode = source.lscRetailProductCode,
            target.lscTransferType = source.lscTransferType,
            target.netWeight = source.netWeight,
            target.outboundWhseHandlingTime = source.outboundWhseHandlingTime,
            target.outstandingQtyBase = source.outstandingQtyBase,
            target.outstandingQuantity = source.outstandingQuantity,
            target.planningFlexibility = source.planningFlexibility,
            target.qtyReceivedBase = source.qtyReceivedBase,
            target.qtyRoundingPrecision = source.qtyRoundingPrecision,
            target.qtyRoundingPrecisionBase = source.qtyRoundingPrecisionBase,
            target.qtyShippedBase = source.qtyShippedBase,
            target.qtyInTransit = source.qtyInTransit,
            target.qtyInTransitBase = source.qtyInTransitBase,
            target.qtyPerUnitOfMeasure = source.qtyPerUnitOfMeasure,
            target.qtyToReceive = source.qtyToReceive,
            target.qtyToReceiveBase = source.qtyToReceiveBase,
            target.qtyToShip = source.qtyToShip,
            target.qtyToShipBase = source.qtyToShipBase,
            target.quantity = source.quantity,
            target.quantityBase = source.quantityBase,
            target.quantityReceived = source.quantityReceived,
            target.quantityShipped = source.quantityShipped,
            target.receiptDate = source.receiptDate,
            target.reservedQtyInbndBase = source.reservedQtyInbndBase,
            target.reservedQtyOutbndBase = source.reservedQtyOutbndBase,
            target.reservedQtyShippedBase = source.reservedQtyShippedBase,
            target.reservedQuantityInbnd = source.reservedQuantityInbnd,
            target.reservedQuantityOutbnd = source.reservedQuantityOutbnd,
            target.reservedQuantityShipped = source.reservedQuantityShipped,
            target.shipmentDate = source.shipmentDate,
            target.shippingAgentCode = source.shippingAgentCode,
            target.shippingAgentServiceCode = source.shippingAgentServiceCode,
            target.shippingTime = source.shippingTime,
            target.shortcutDimension1Code = source.shortcutDimension1Code,
            target.shortcutDimension2Code = source.shortcutDimension2Code,
            target.sourceLastModifiedUserBTR = source.sourceLastModifiedUserBTR,
            target.status = source.status,
            target.stockOnHandBTR = source.stockOnHandBTR,
            target.transferToBinCode = source.transferToBinCode,
            target.transferFromBinCode = source.transferFromBinCode,
            target.transferFromCode = source.transferFromCode,
            target.transferToCode = source.transferToCode,
            target.unitVolume = source.unitVolume,
            target.unitOfMeasure = source.unitOfMeasure,
            target.unitOfMeasureCode = source.unitOfMeasureCode,
            target.unitsPerParcel = source.unitsPerParcel,
            target.variantCode = source.variantCode,
            target.whseOutbndOtsdgQtyBase = source.whseOutbndOtsdgQtyBase,
            target.whseInbndOtsdgQtyBase = source.whseInbndOtsdgQtyBase,
            target.systemCreatedAt = source.systemCreatedAt,
            target.systemCreatedBy = source.systemCreatedBy,
            target.systemId = source.systemId,
            target.systemModifiedAt = source.systemModifiedAt,
            target.systemModifiedBy = source.systemModifiedBy

    -- Insert new records
    WHEN NOT MATCHED  THEN
        INSERT (
            CompanyName, documentNo, lineNo, systemRowVersion, applToItemEntry, barcodeBTR, completelyReceived, completelyShipped,
            derivedFromLineNo, description, description2, differenceBTR, dimensionSetID, directTransfer, genProdPostingGroup,
            grossWeight, inTransitCode, inQCBTR, inboundWhseHandlingTime, inventoryPostingGroup, itemCategoryCode, itemNo,
            lscCustomerOrderID, lscCustomerOrderLineNo, lscDivision, lscFromDimensionSetID, lscFromShortcutDim1Code,
            lscFromShortcutDim2Code, lscPurchaseOrderNo, lscReasonCode, lscReceivingFromPOS, lscRetailProductCode,
            lscTransferType, netWeight, outboundWhseHandlingTime, outstandingQtyBase, outstandingQuantity, planningFlexibility,
            qtyReceivedBase, qtyRoundingPrecision, qtyRoundingPrecisionBase, qtyShippedBase, qtyInTransit, qtyInTransitBase,
            qtyPerUnitOfMeasure, qtyToReceive, qtyToReceiveBase, qtyToShip, qtyToShipBase, quantity, quantityBase,
            quantityReceived, quantityShipped, receiptDate, reservedQtyInbndBase, reservedQtyOutbndBase,
            reservedQtyShippedBase, reservedQuantityInbnd, reservedQuantityOutbnd, reservedQuantityShipped, shipmentDate,
            shippingAgentCode, shippingAgentServiceCode, shippingTime, shortcutDimension1Code, shortcutDimension2Code,
            sourceLastModifiedUserBTR, status, stockOnHandBTR, transferToBinCode, transferFromBinCode, transferFromCode,
            transferToCode, unitVolume, unitOfMeasure, unitOfMeasureCode, unitsPerParcel, variantCode, whseOutbndOtsdgQtyBase,
            whseInbndOtsdgQtyBase, systemCreatedAt, systemCreatedBy, systemId, systemModifiedAt, systemModifiedBy
        )
        VALUES (
            source.CompanyName, source.documentNo, source.lineNo, source.systemRowVersion, source.applToItemEntry,
            source.barcodeBTR, source.completelyReceived, source.completelyShipped, source.derivedFromLineNo,
            source.description, source.description2, source.differenceBTR, source.dimensionSetID, source.directTransfer,
            source.genProdPostingGroup, source.grossWeight, source.inTransitCode, source.inQCBTR,
            source.inboundWhseHandlingTime, source.inventoryPostingGroup, source.itemCategoryCode, source.itemNo,
            source.lscCustomerOrderID, source.lscCustomerOrderLineNo, source.lscDivision, source.lscFromDimensionSetID,
            source.lscFromShortcutDim1Code, source.lscFromShortcutDim2Code, source.lscPurchaseOrderNo,
            source.lscReasonCode, source.lscReceivingFromPOS, source.lscRetailProductCode, source.lscTransferType,
            source.netWeight, source.outboundWhseHandlingTime, source.outstandingQtyBase, source.outstandingQuantity,
            source.planningFlexibility, source.qtyReceivedBase, source.qtyRoundingPrecision,
            source.qtyRoundingPrecisionBase, source.qtyShippedBase, source.qtyInTransit, source.qtyInTransitBase,
            source.qtyPerUnitOfMeasure, source.qtyToReceive, source.qtyToReceiveBase, source.qtyToShip,
            source.qtyToShipBase, source.quantity, source.quantityBase, source.quantityReceived, source.quantityShipped,
            source.receiptDate, source.reservedQtyInbndBase, source.reservedQtyOutbndBase,
            source.reservedQtyShippedBase, source.reservedQuantityInbnd, source.reservedQuantityOutbnd,
            source.reservedQuantityShipped, source.shipmentDate, source.shippingAgentCode,
            source.shippingAgentServiceCode, source.shippingTime, source.shortcutDimension1Code,
            source.shortcutDimension2Code, source.sourceLastModifiedUserBTR, source.status, source.stockOnHandBTR,
            source.transferToBinCode, source.transferFromBinCode, source.transferFromCode, source.transferToCode,
            source.unitVolume, source.unitOfMeasure, source.unitOfMeasureCode, source.unitsPerParcel, source.variantCode,
            source.whseOutbndOtsdgQtyBase, source.whseInbndOtsdgQtyBase, source.systemCreatedAt, source.systemCreatedBy,
            source.systemId, source.systemModifiedAt, source.systemModifiedBy
        );
END;
';


CREATE OR REPLACE PROCEDURE FCO.SILVER.SP_MERGE_VALUEENTRY()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
  MERGE INTO fco.silver.factValueEntry AS target
  USING fco.staging.stgValueEntry AS source
  ON target.companyName = source.companyName
     AND target.entryNo = source.entryNo
  WHEN MATCHED THEN
      UPDATE SET
          target.systemRowVersion = source.systemRowVersion,
          target.itemNo = source.itemNo,
          target.postingDate = source.postingDate,
          target.itemLedgerEntryType = source.itemLedgerEntryType,
          target.sourceNo = source.sourceNo,
          target.documentNo = source.documentNo,
          target.description = source.description,
          target.locationCode = source.locationCode,
          target.inventoryPostingGroup = source.inventoryPostingGroup,
          target.sourcePostingGroup = source.sourcePostingGroup,
          target.itemLedgerEntryNo = source.itemLedgerEntryNo,
          target.valuedQuantity = source.valuedQuantity,
          target.itemLedgerEntryQuantity = source.itemLedgerEntryQuantity,
          target.invoicedQuantity = source.invoicedQuantity,
          target.costPerUnit = source.costPerUnit,
          target.salesAmountActual = source.salesAmountActual,
          target.salespersPurchCode = source.salespersPurchCode,
          target.discountAmount = source.discountAmount,
          target.userID = source.userID,
          target.sourceCode = source.sourceCode,
          target.appliesToEntry = source.appliesToEntry,
          target.globalDimension1Code = source.globalDimension1Code,
          target.globalDimension2Code = source.globalDimension2Code,
          target.sourceType = source.sourceType,
          target.costAmountActual = source.costAmountActual,
          target.costPostedToGL = source.costPostedToGL,
          target.reasonCode = source.reasonCode,
          target.dropShipment = source.dropShipment,
          target.journalBatchName = source.journalBatchName,
          target.genBusPostingGroup = source.genBusPostingGroup,
          target.genProdPostingGroup = source.genProdPostingGroup,
          target.documentDate = source.documentDate,
          target.externalDocumentNo = source.externalDocumentNo,
          target.costAmountActualACY = source.costAmountActualACY,
          target.costPostedToGLACY = source.costPostedToGLACY,
          target.costPerUnitACY = source.costPerUnitACY,
          target.documentType = source.documentType,
          target.documentLineNo = source.documentLineNo,
          target.vatReportingDate = source.vatReportingDate,
          target.orderType = source.orderType,
          target.orderNo = source.orderNo,
          target.orderLineNo = source.orderLineNo,
          target.expectedCost = source.expectedCost,
          target.itemChargeNo = source.itemChargeNo,
          target.valuedByAverageCost = source.valuedByAverageCost,
          target.partialRevaluation = source.partialRevaluation,
          target.inventoriable = source.inventoriable,
          target.valuationDate = source.valuationDate,
          target.entryType = source.entryType,
          target.varianceType = source.varianceType,
          target.purchaseAmountActual = source.purchaseAmountActual,
          target.purchaseAmountExpected = source.purchaseAmountExpected,
          target.salesAmountExpected = source.salesAmountExpected,
          target.costAmountExpected = source.costAmountExpected,
          target.costAmountNonInvtbl = source.costAmountNonInvtbl,
          target.costAmountExpectedACY = source.costAmountExpectedACY,
          target.costAmountNonInvtblACY = source.costAmountNonInvtblACY,
          target.expectedCostPostedToGL = source.expectedCostPostedToGL,
          target.expCostPostedToGLACY = source.expCostPostedToGLACY,
          target.dimensionSetID = source.dimensionSetID,
          target.jobNo = source.jobNo,
          target.jobTaskNo = source.jobTaskNo,
          target.jobLedgerEntryNo = source.jobLedgerEntryNo,
          target.variantCode = source.variantCode,
          target.adjustment = source.adjustment,
          target.averageCostException = source.averageCostException,
          target.capacityLedgerEntryNo = source.capacityLedgerEntryNo,
          target.type = source.type,
          target.no = source.no,
          target.returnReasonCode = source.returnReasonCode,
          target.lscOfferNo = source.lscOfferNo,
          target.lscRetailProductCode = source.lscRetailProductCode,
          target.lscItemCategory = source.lscItemCategory,
          target.lscBatchNo = source.lscBatchNo,
          target.lscInvAdjustGroup = source.lscInvAdjustGroup,
          target.lscDivision = source.lscDivision,
          target.lscVendorNo = source.lscVendorNo,
          target.lscPromotionNo = source.lscPromotionNo,
          target.lscBITimestamp = source.lscBITimestamp,
          target.lscItemNo = source.lscItemNo,
          target.lscPostingDate = source.lscPostingDate,
          target.lscItemLedgerEntryType = source.lscItemLedgerEntryType,
          target.lscLocationCode = source.lscLocationCode,
          target.lscValuedQuantity = source.lscValuedQuantity,
          target.lscInvoicedQuantity = source.lscInvoicedQuantity,
          target.lscSalesAmountActual = source.lscSalesAmountActual,
          target.lscSalespersPurchCode = source.lscSalespersPurchCode,
          target.lscDiscountAmount = source.lscDiscountAmount,
          target.lscGlobalDimension1Code = source.lscGlobalDimension1Code,
          target.lscGlobalDimension2Code = source.lscGlobalDimension2Code,
          target.lscCostAmountActual = source.lscCostAmountActual,
          target.lscVariantCode = source.lscVariantCode,
          target.shortcutDimension3Code = source.shortcutDimension3Code,
          target.shortcutDimension4Code = source.shortcutDimension4Code,
          target.shortcutDimension5Code = source.shortcutDimension5Code,
          target.shortcutDimension6Code = source.shortcutDimension6Code,
          target.shortcutDimension7Code = source.shortcutDimension7Code,
          target.shortcutDimension8Code = source.shortcutDimension8Code,
          target.systemId = source.systemId,
          target.systemCreatedAt = source.systemCreatedAt,
          target.systemCreatedBy = source.systemCreatedBy,
          target.systemModifiedAt = source.systemModifiedAt,
          target.systemModifiedBy = source.systemModifiedBy
  WHEN NOT MATCHED  THEN
      INSERT (
          companyName, systemRowVersion, entryNo, itemNo, postingDate, itemLedgerEntryType, sourceNo, documentNo, description, locationCode,
          inventoryPostingGroup, sourcePostingGroup, itemLedgerEntryNo, valuedQuantity, itemLedgerEntryQuantity, invoicedQuantity, costPerUnit,
          salesAmountActual, salespersPurchCode, discountAmount, userID, sourceCode, appliesToEntry, globalDimension1Code, globalDimension2Code,
          sourceType, costAmountActual, costPostedToGL, reasonCode, dropShipment, journalBatchName, genBusPostingGroup, genProdPostingGroup,
          documentDate, externalDocumentNo, costAmountActualACY, costPostedToGLACY, costPerUnitACY, documentType, documentLineNo, vatReportingDate,
          orderType, orderNo, orderLineNo, expectedCost, itemChargeNo, valuedByAverageCost, partialRevaluation, inventoriable, valuationDate,
          entryType, varianceType, purchaseAmountActual, purchaseAmountExpected, salesAmountExpected, costAmountExpected, costAmountNonInvtbl,
          costAmountExpectedACY, costAmountNonInvtblACY, expectedCostPostedToGL, expCostPostedToGLACY, dimensionSetID, jobNo, jobTaskNo,
          jobLedgerEntryNo, variantCode, adjustment, averageCostException, capacityLedgerEntryNo, type, no, returnReasonCode, lscOfferNo,
          lscRetailProductCode, lscItemCategory, lscBatchNo, lscInvAdjustGroup, lscDivision, lscVendorNo, lscPromotionNo, lscBITimestamp,
          lscItemNo, lscPostingDate, lscItemLedgerEntryType, lscLocationCode, lscValuedQuantity, lscInvoicedQuantity, lscSalesAmountActual,
          lscSalespersPurchCode, lscDiscountAmount, lscGlobalDimension1Code, lscGlobalDimension2Code, lscCostAmountActual, lscVariantCode,
          shortcutDimension3Code, shortcutDimension4Code, shortcutDimension5Code, shortcutDimension6Code, shortcutDimension7Code,
          shortcutDimension8Code, systemId, systemCreatedAt, systemCreatedBy, systemModifiedAt, systemModifiedBy
      )
      VALUES (
          source.companyName, source.systemRowVersion, source.entryNo, source.itemNo, source.postingDate, source.itemLedgerEntryType,
          source.sourceNo, source.documentNo, source.description, source.locationCode, source.inventoryPostingGroup, source.sourcePostingGroup,
          source.itemLedgerEntryNo, source.valuedQuantity, source.itemLedgerEntryQuantity, source.invoicedQuantity, source.costPerUnit,
          source.salesAmountActual, source.salespersPurchCode, source.discountAmount, source.userID, source.sourceCode, source.appliesToEntry,
          source.globalDimension1Code, source.globalDimension2Code, source.sourceType, source.costAmountActual, source.costPostedToGL,
          source.reasonCode, source.dropShipment, source.journalBatchName, source.genBusPostingGroup, source.genProdPostingGroup,
          source.documentDate, source.externalDocumentNo, source.costAmountActualACY, source.costPostedToGLACY, source.costPerUnitACY,
          source.documentType, source.documentLineNo, source.vatReportingDate, source.orderType, source.orderNo, source.orderLineNo,
          source.expectedCost, source.itemChargeNo, source.valuedByAverageCost, source.partialRevaluation, source.inventoriable,
          source.valuationDate, source.entryType, source.varianceType, source.purchaseAmountActual, source.purchaseAmountExpected,
          source.salesAmountExpected, source.costAmountExpected, source.costAmountNonInvtbl, source.costAmountExpectedACY,
          source.costAmountNonInvtblACY, source.expectedCostPostedToGL, source.expCostPostedToGLACY, source.dimensionSetID, source.jobNo,
          source.jobTaskNo, source.jobLedgerEntryNo, source.variantCode, source.adjustment, source.averageCostException,
          source.capacityLedgerEntryNo, source.type, source.no, source.returnReasonCode, source.lscOfferNo, source.lscRetailProductCode,
          source.lscItemCategory, source.lscBatchNo, source.lscInvAdjustGroup, source.lscDivision, source.lscVendorNo, source.lscPromotionNo,
          source.lscBITimestamp, source.lscItemNo, source.lscPostingDate, source.lscItemLedgerEntryType, source.lscLocationCode,
          source.lscValuedQuantity, source.lscInvoicedQuantity, source.lscSalesAmountActual, source.lscSalespersPurchCode,
          source.lscDiscountAmount, source.lscGlobalDimension1Code, source.lscGlobalDimension2Code, source.lscCostAmountActual,
          source.lscVariantCode, source.shortcutDimension3Code, source.shortcutDimension4Code, source.shortcutDimension5Code,
          source.shortcutDimension6Code, source.shortcutDimension7Code, source.shortcutDimension8Code, source.systemId, source.systemCreatedAt,
          source.systemCreatedBy, source.systemModifiedAt, source.systemModifiedBy
      );
      END;
';






